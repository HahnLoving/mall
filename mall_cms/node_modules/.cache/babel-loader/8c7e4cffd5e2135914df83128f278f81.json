{"ast":null,"code":"import { createElementVNode as _createElementVNode, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode, withCtx as _withCtx, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock, resolveDirective as _resolveDirective, withDirectives as _withDirectives, Transition as _Transition, vShow as _vShow, normalizeClass as _normalizeClass, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-60459530\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  class: \"log\"\n};\nvar _hoisted_2 = {\n  class: \"log-header\"\n};\n\nvar _hoisted_3 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"div\", {\n    class: \"header-left\"\n  }, [/*#__PURE__*/_createElementVNode(\"p\", {\n    class: \"title\"\n  }, \"日志信息\")], -1\n  /* HOISTED */\n  );\n});\n\nvar _hoisted_4 = {\n  class: \"header-right\"\n};\n\nvar _hoisted_5 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"i\", {\n    class: \"el-icon-arrow-down el-icon--right\"\n  }, null, -1\n  /* HOISTED */\n  );\n});\n\nvar _hoisted_6 = /*#__PURE__*/_createTextVNode(\"全部人员\");\n\nvar _hoisted_7 = {\n  key: 0,\n  class: \"search\"\n};\nvar _hoisted_8 = {\n  class: \"search-tip\"\n};\n\nvar _hoisted_9 = /*#__PURE__*/_createTextVNode(\" 搜索“\");\n\nvar _hoisted_10 = {\n  class: \"search-keyword\"\n};\n\nvar _hoisted_11 = /*#__PURE__*/_createTextVNode(\"”， 找到 \");\n\nvar _hoisted_12 = {\n  class: \"search-num\"\n};\n\nvar _hoisted_13 = /*#__PURE__*/_createTextVNode(\" 条日志信息 \");\n\nvar _hoisted_14 = {\n  class: \"content\"\n};\n\nvar _hoisted_15 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"span\", {\n    class: \"point-time\"\n  }, null, -1\n  /* HOISTED */\n  );\n});\n\nvar _hoisted_16 = [\"innerHTML\"];\nvar _hoisted_17 = {\n  class: \"brief\"\n};\nvar _hoisted_18 = {\n  class: \"text-yellow\"\n};\nvar _hoisted_19 = {\n  key: 0\n};\nvar _hoisted_20 = {\n  key: 0\n};\nvar _hoisted_21 = {\n  key: 0,\n  class: \"iconfont icon-loading\"\n};\n\nvar _hoisted_22 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"span\", null, \"查看更多\", -1\n  /* HOISTED */\n  );\n});\n\nvar _hoisted_23 = /*#__PURE__*/_createTextVNode();\n\nvar _hoisted_24 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"i\", {\n    class: \"iconfont icon-gengduo\",\n    style: {\n      \"font-size\": \"14px\"\n    }\n  }, null, -1\n  /* HOISTED */\n  );\n});\n\nvar _hoisted_25 = [_hoisted_22, _hoisted_23, _hoisted_24];\nvar _hoisted_26 = {\n  key: 1\n};\nvar _hoisted_27 = {\n  key: 1,\n  class: \"nothing\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _$setup$logs;\n\n  var _component_lin_search = _resolveComponent(\"lin-search\");\n\n  var _component_el_button = _resolveComponent(\"el-button\");\n\n  var _component_el_dropdown_item = _resolveComponent(\"el-dropdown-item\");\n\n  var _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n\n  var _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n\n  var _component_lin_date_picker = _resolveComponent(\"lin-date-picker\");\n\n  var _component_el_divider = _resolveComponent(\"el-divider\");\n\n  var _component_sticky_top = _resolveComponent(\"sticky-top\");\n\n  var _directive_permission = _resolveDirective(\"permission\");\n\n  var _directive_loading = _resolveDirective(\"loading\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_sticky_top, null, {\n    default: _withCtx(function () {\n      return [_createElementVNode(\"div\", _hoisted_2, [_hoisted_3, _createCommentVNode(\"<div class=\\\"header-right\\\" v-permission=\\\"'搜索日志'\\\">\"), _withDirectives(_createElementVNode(\"div\", _hoisted_4, [_createVNode(_component_lin_search, {\n        onQuery: $setup.onQueryChange,\n        ref: \"searchKeywordDom\"\n      }, null, 8\n      /* PROPS */\n      , [\"onQuery\"]), _createCommentVNode(\"<el-dropdown style=\\\"margin: 0 10px\\\" @command=\\\"handleCommand\\\" v-permission=\\\"'查询日志记录的用户'\\\">\"), _withDirectives(_createVNode(_component_el_dropdown, {\n        style: {\n          \"margin\": \"0 10px\"\n        },\n        onCommand: $setup.handleCommand\n      }, {\n        dropdown: _withCtx(function () {\n          return [_createVNode(_component_el_dropdown_menu, null, {\n            default: _withCtx(function () {\n              return [_createVNode(_component_el_dropdown_item, {\n                command: ['全部人员']\n              }, {\n                default: _withCtx(function () {\n                  return [_hoisted_6];\n                }),\n                _: 1\n                /* STABLE */\n\n              }), (_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.users.items, function (user, index) {\n                return _openBlock(), _createBlock(_component_el_dropdown_item, {\n                  icon: \"el-icon-user-solid\",\n                  key: index,\n                  command: [user]\n                }, {\n                  default: _withCtx(function () {\n                    return [_createTextVNode(_toDisplayString(user), 1\n                    /* TEXT */\n                    )];\n                  }),\n                  _: 2\n                  /* DYNAMIC */\n\n                }, 1032\n                /* PROPS, DYNAMIC_SLOTS */\n                , [\"command\"]);\n              }), 128\n              /* KEYED_FRAGMENT */\n              ))];\n            }),\n            _: 1\n            /* STABLE */\n\n          })];\n        }),\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_button, null, {\n            default: _withCtx(function () {\n              return [_createTextVNode(_toDisplayString(_ctx.searchUser ? _ctx.searchUser : '全部人员') + \" \", 1\n              /* TEXT */\n              ), _hoisted_5];\n            }),\n            _: 1\n            /* STABLE */\n\n          })];\n        }),\n        _: 1\n        /* STABLE */\n\n      }, 8\n      /* PROPS */\n      , [\"onCommand\"]), [[_directive_permission, '查询日志记录的用户']]), _createVNode(_component_lin_date_picker, {\n        onDateChange: $setup.handleDateChange,\n        ref: \"searchDateDom\",\n        class: \"date\"\n      }, null, 8\n      /* PROPS */\n      , [\"onDateChange\"])], 512\n      /* NEED_PATCH */\n      ), [[_directive_permission, '搜索日志']])]), !_ctx.keyword ? (_openBlock(), _createBlock(_component_el_divider, {\n        key: 0\n      })) : _createCommentVNode(\"v-if\", true)];\n    }),\n    _: 1\n    /* STABLE */\n\n  }), _createVNode(_Transition, {\n    name: \"fade\"\n  }, {\n    default: _withCtx(function () {\n      return [_ctx.keyword ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [_createElementVNode(\"p\", _hoisted_8, [_hoisted_9, _createElementVNode(\"span\", _hoisted_10, _toDisplayString(_ctx.keyword), 1\n      /* TEXT */\n      ), _hoisted_11, _createElementVNode(\"span\", _hoisted_12, _toDisplayString(_ctx.totalCount), 1\n      /* TEXT */\n      ), _hoisted_13]), _createElementVNode(\"button\", {\n        class: \"search-back\",\n        onClick: _cache[0] || (_cache[0] = function () {\n          return $setup.backInit && $setup.backInit.apply($setup, arguments);\n        })\n      }, \"返回全部日志\")])) : _createCommentVNode(\"v-if\", true)];\n    }),\n    _: 1\n    /* STABLE */\n\n  }), _withDirectives(_createElementVNode(\"div\", _hoisted_14, [_createElementVNode(\"article\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.logs, function (log) {\n    return _openBlock(), _createElementBlock(\"section\", {\n      key: log.id\n    }, [_hoisted_15, _createElementVNode(\"aside\", null, [_createElementVNode(\"p\", {\n      class: \"things\",\n      innerHTML: log.message\n    }, null, 8\n    /* PROPS */\n    , _hoisted_16), _createElementVNode(\"p\", _hoisted_17, [_createElementVNode(\"span\", _hoisted_18, _toDisplayString(log.username), 1\n    /* TEXT */\n    ), _createTextVNode(\" \" + _toDisplayString(_ctx.$filters.dateTimeFormatter(log.time)), 1\n    /* TEXT */\n    )])])]);\n  }), 128\n  /* KEYED_FRAGMENT */\n  ))]), _ctx.totalCount > $setup.count || _ctx.totalCount === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [(_$setup$logs = $setup.logs) !== null && _$setup$logs !== void 0 && _$setup$logs.length ? (_openBlock(), _createElementBlock(\"div\", _hoisted_20, [_createVNode(_component_el_divider), _createElementVNode(\"div\", {\n    class: _normalizeClass([\"more\", {\n      nothing: $setup.finished\n    }])\n  }, [$setup.more ? (_openBlock(), _createElementBlock(\"i\", _hoisted_21)) : _createCommentVNode(\"v-if\", true), _withDirectives(_createElementVNode(\"div\", {\n    onClick: _cache[1] || (_cache[1] = function () {\n      return $setup.nextPage && $setup.nextPage.apply($setup, arguments);\n    })\n  }, _hoisted_25, 512\n  /* NEED_PATCH */\n  ), [[_vShow, !$setup.more && !$setup.finished]]), $setup.finished ? (_openBlock(), _createElementBlock(\"div\", _hoisted_26, [_createElementVNode(\"span\", null, _toDisplayString(_ctx.totalCount === 0 ? '暂无数据' : '没有更多数据了'), 1\n  /* TEXT */\n  )])) : _createCommentVNode(\"v-if\", true)], 2\n  /* CLASS */\n  )])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_27, \"暂无日志信息\"))])) : _createCommentVNode(\"v-if\", true)], 512\n  /* NEED_PATCH */\n  ), [[_directive_loading, $setup.loading]])]);\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/log/log.vue"],"names":[],"mappings":";;;;;;;AACO,EAAA,KAAK,EAAC;;;AAEF,EAAA,KAAK,EAAC;;;;sBACT,mBAAA,CAAwD,KAAxD,EAAwD;AAAnD,IAAA,KAAK,EAAC;AAA6C,GAAxD,EAAwB,C,aAAC,mBAAA,CAAyB,GAAzB,EAAyB;AAAtB,IAAA,KAAK,EAAC;AAAgB,GAAzB,EAAiB,MAAjB,CAAD,CAAxB,E;;AAAA,G;;;;AAEK,EAAA,KAAK,EAAC;;;;sBAKkC,mBAAA,CAAiD,GAAjD,EAAiD;AAA9C,IAAA,KAAK,EAAC;AAAwC,GAAjD,EAA4C,IAA5C,EAA4C,CAAA;AAAA;AAA5C,G;;;+CAIC,M;;;;AAiB3C,EAAA,KAAK,EAAC;;;AACN,EAAA,KAAK,EAAC;;;+CAAa,M;;;AACX,EAAA,KAAK,EAAC;;;gDACd,Q;;;AAAY,EAAA,KAAK,EAAC;;;gDAAoC,S;;;AAKxD,EAAA,KAAK,EAAC;;;;sBAGL,mBAAA,CAAgC,MAAhC,EAAgC;AAA1B,IAAA,KAAK,EAAC;AAAoB,GAAhC,EAAwB,IAAxB,EAAwB,CAAA;AAAA;AAAxB,G;;;;;AAGK,EAAA,KAAK,EAAC;;;AACD,EAAA,KAAK,EAAC;;;;;;;;;;AAUC,EAAA,KAAK,EAAC;;;;sBAEnB,mBAAA,CAAiB,MAAjB,EAAiB,IAAjB,EAAM,MAAN,EAAU,CAAA;AAAA;AAAV,G;;;;;;sBAAkB,mBAAA,CAA6D,GAA7D,EAA6D;AAA1D,IAAA,KAAK,EAAC,uBAAoD;AAA5B,IAAA,KAAuB,EAAvB;AAAA,mBAAA;AAAA;AAA4B,GAA7D,E,IAAA,E;;AAAA,G;;;mBAAlB,W,eAAkB,W;;;;;;AAOnB,EAAA,KAAK,EAAC;;;;;;;;;;;;;;;;;;;;;;;;;uBAjEjB,mBAAA,CAoEM,KApEN,EAAA,UAAA,EAoEM,CAnEJ,YAAA,CA4Ba,qBA5Bb,EA4Ba,IA5Bb,EA4Ba;sBA3BX;AAAA,aAyBM,CAzBN,mBAAA,CAyBM,KAzBN,EAAA,UAAA,EAyBM,CAxBJ,UAwBI,EAvBJ,mBAAA,CAAA,sDAAA,CAuBI,E,gBAtBJ,mBAAA,CAqBM,KArBN,EAAA,UAAA,EAqBM,CApBJ,YAAA,CAA4D,qBAA5D,EAA4D;AAA/C,QAAA,OAAK,EAAE,MAAA,CAAA,aAAwC;AAAzB,QAAA,GAAG,EAAC;AAAqB,OAA5D,E,IAAA,E;;AAAA,Q,WAAA,CAoBI,EAnBJ,mBAAA,CAAA,gGAAA,CAmBI,E,gBAlBJ,YAAA,CAgBc,sBAhBd,EAgBc;AAhBD,QAAA,KAAsB,EAAtB;AAAA,oBAAA;AAAA,SAgBC;AAhBuB,QAAA,SAAO,EAAE,MAAA,CAAA;AAgBhC,OAhBd,E;AAIa,QAAA,QAAQ,EAAA,QAAA,CACjB;AAAA,iBASmB,CATnB,YAAA,CASmB,2BATnB,EASmB,IATnB,EASmB;8BARjB;AAAA,qBAA6D,CAA7D,YAAA,CAA6D,2BAA7D,EAA6D;AAA1C,gBAAA,OAAO,EAAE,CAAA,MAAA;AAAiC,eAA7D,EAAoC;kCAAE;AAAA,yBAAI,C,UAAA,CAAJ;AAAA,iB,CAAF;;;;AAAA,eAApC,CAA6D,G,kBAC7D,mBAAA,CAMmB,SANnB,EAMmB,IANnB,EAMmB,WAAA,CAJO,MAAA,CAAA,KAAA,CAAM,KAIb,EAJkB,UAA3B,IAA2B,EAArB,KAAqB,EAAhB;qCAFrB,YAAA,CAMmB,2BANnB,EAMmB;AALjB,kBAAA,IAAI,EAAC,oBAKY;AAHhB,kBAAA,GAAG,EAAE,KAGW;AAFhB,kBAAA,OAAO,EAAA,CAAG,IAAH;AAES,iBANnB,E;oCAKG;AAAA,2BAAU,C,kCAAP,I,GAAI;AAAA;qBAAG,CAAV;AAAA,mB;;;;iBALH,E;;AAAA,kB,WAAA,C;eAMmB,CANnB,E;;AAAA,eAD6D,EAA7D;AAAA,a,CAQiB;;;;AAAA,WATnB,CASmB,CATnB;AAAA,SADiB,C;0BAHnB;AAAA,iBAEY,CAFZ,YAAA,CAEY,oBAFZ,EAEY,IAFZ,EAEY;8BADV;AAAA,qBAAsC,C,kCAAnC,IAAA,CAAA,UAAA,GAAa,IAAA,CAAA,UAAb,GAAuB,M,IAAY,G,EAAC;AAAA;eAAD,EAAC,UAAD,CAAtC;AAAA,a,CACU;;;;AAAA,WAFZ,CAEY,CAFZ;AAAA,S;;;;OADF,E;;AAAA,Q,aAAA,C,2BAA2E,W,GAkBvE,EADJ,YAAA,CAAoG,0BAApG,EAAoG;AAAlF,QAAA,YAAU,EAAE,MAAA,CAAA,gBAAsE;AAApD,QAAA,GAAG,EAAC,eAAgD;AAAhC,QAAA,KAAK,EAAC;AAA0B,OAApG,E,IAAA,E;;AAAA,Q,gBAAA,CACI,CArBN,E;;AAAA,O,2BAAwC,M,GAsBpC,CAzBN,CAyBM,E,CACa,IAAA,CAAA,O,kBAAnB,YAAA,CAAyC,qBAAzC,EAAyC;AAAA,QAAA,GAAA,EAAA;AAAA,OAAzC,C,qCADM,CAzBN;AAAA,K,CA2BW;;;;AAAA,GA5Bb,CAmEI,EAtCJ,YAAA,CAQa,WARb,EAQa;AARD,IAAA,IAAI,EAAC;AAQJ,GARb,EAAuB;sBACrB;AAAA,aAMM,CANoB,IAAA,CAAA,O,kBAA1B,mBAAA,CAMM,KANN,EAAA,UAAA,EAMM,CALJ,mBAAA,CAGI,GAHJ,EAAA,UAAA,EAGI,C,UAAA,EAFC,mBAAA,CACF,MADE,EAAA,WAAA,EACF,gBAAA,CADkC,IAAA,CAAA,OAClC,CADE,EAAuC;AAAA;AAAvC,OAED,E,WAAA,EADK,mBAAA,CAAgD,MAAhD,EAAA,WAAA,EAAgD,gBAAA,CAApB,IAAA,CAAA,UAAoB,CAAhD,EAAsC;AAAA;AAAtC,OACL,E,WAAA,CAHJ,CAKI,EADJ,mBAAA,CAA6D,QAA7D,EAA6D;AAArD,QAAA,KAAK,EAAC,aAA+C;AAAhC,QAAA,OAAK,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA;AAAA,iBAAE,MAAA,CAAA,QAAA,IAAA,MAAA,CAAA,QAAA,OAAA,MAAA,YAAF;AAAA,SAAA;AAA2B,OAA7D,EAA8C,QAA9C,CACI,CANN,C,qCAMM,CANN;AAAA,K,CADqB;;;;AAAA,GAAvB,CAsCI,E,gBA7BJ,mBAAA,CA4BM,KA5BN,EAAA,WAAA,EA4BM,CA3BJ,mBAAA,CAUU,SAVV,EAUU,IAVV,EAUU,E,kBATR,mBAAA,CAQU,SARV,EAQU,IARV,EAQU,WAAA,CARa,MAAA,CAAA,IAQb,EARiB,UAAX,GAAW,EAAR;yBAAnB,mBAAA,CAQU,SARV,EAQU;AARoB,MAAA,GAAG,EAAE,GAAG,CAAC;AAQ7B,KARV,E,CACE,W,EACA,mBAAA,CAKQ,OALR,EAKQ,IALR,EAKQ,CAJN,mBAAA,CAA2C,GAA3C,EAA2C;AAAxC,MAAA,KAAK,EAAC,QAAkC;AAAzB,MAAA,SAAoB,EAAZ,GAAG,CAAC;AAAa,KAA3C,E,IAAA,E;;AAAA,M,WAAA,CAIM,EAHN,mBAAA,CAEI,GAFJ,EAAA,WAAA,EAEI,CADF,mBAAA,CAAmD,MAAnD,EAAA,WAAA,EAAmD,gBAAA,CAAtB,GAAG,CAAC,QAAkB,CAAnD,EAAyC;AAAA;AAAzC,KACE,E,iBADiD,MAAC,gBAAA,CAAG,IAAA,CAAA,QAAA,CAAS,iBAAT,CAA2B,GAAG,CAAC,IAA/B,CAAH,C,EAAsC;AAAA;KACxF,CAFJ,CAGM,CALR,C,CAFF,C;GAQU,CARV,E;;AAAA,GASQ,EAVV,CA2BI,EAfO,IAAA,CAAA,UAAA,GAAa,MAAA,CAAA,KAAb,IAAsB,IAAA,CAAA,UAAA,KAAU,C,kBAA3C,mBAAA,CAcM,KAdN,EAcM,WAdN,EAcM,C,gBAbO,MAAA,CAAA,I,yCAAA,aAAM,M,kBAAjB,mBAAA,CAWM,KAXN,EAWM,WAXN,EAWM,CAVJ,YAAA,CAAyB,qBAAzB,CAUI,EATJ,mBAAA,CAQM,KARN,EAQM;AARD,IAAA,KAAK,EAAA,eAAA,CAAA,CAAC,MAAD,EAAO;AAAA,MAAA,OAAA,EAAoB,MAAA,CAAA;AAApB,KAAP,CAAA;AAQJ,GARN,E,CACW,MAAA,CAAA,I,kBAAT,mBAAA,CAAiD,GAAjD,EAAA,WAAA,C,uDACA,mBAAA,CAEM,KAFN,EAEM;AAF4B,IAAA,OAAK,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA;AAAA,aAAE,MAAA,CAAA,QAAA,IAAA,MAAA,CAAA,QAAA,OAAA,MAAA,YAAF;AAAA,KAAA;AAEjC,GAFN,E,WAAA,E;;AAAA,G,aAAc,MAAA,CAAA,I,IAAI,CAAK,MAAA,CAAA,Q,KAGZ,MAAA,CAAA,Q,kBAAX,mBAAA,CAEM,KAFN,EAEM,WAFN,EAEM,CADJ,mBAAA,CAAwD,MAAxD,EAAwD,IAAxD,EAAwD,gBAAA,CAA/C,IAAA,CAAA,UAAA,KAAU,CAAV,GAAU,MAAV,GAAU,SAAqC,CAAxD,EAAmB;AAAA;AAAnB,GACI,CAFN,C,sCALF,E;;AAAA,GASI,CAXN,C,mBAYA,mBAAA,CAAwC,KAAxC,EAAA,WAAA,EAA4B,QAA5B,C,CACI,CAdN,C,qCAeI,CA5BN,E;;AAAA,G,wBAAgC,MAAA,CAAA,O,GA6B5B,CApEN,C","sourcesContent":["<template>\n  <div class=\"log\">\n    <sticky-top>\n      <div class=\"log-header\">\n        <div class=\"header-left\"><p class=\"title\">日志信息</p></div>\n        <!--<div class=\"header-right\" v-permission=\"'搜索日志'\">-->\n        <div class=\"header-right\" v-permission=\"'搜索日志'\">\n          <lin-search @query=\"onQueryChange\" ref=\"searchKeywordDom\" />\n          <!--<el-dropdown style=\"margin: 0 10px\" @command=\"handleCommand\" v-permission=\"'查询日志记录的用户'\">-->\n          <el-dropdown style=\"margin: 0 10px\" @command=\"handleCommand\" v-permission=\"'查询日志记录的用户'\">\n            <el-button>\n              {{ searchUser ? searchUser : '全部人员' }} <i class=\"el-icon-arrow-down el-icon--right\"></i>\n            </el-button>\n            <template #dropdown>\n              <el-dropdown-menu>\n                <el-dropdown-item :command=\"['全部人员']\">全部人员</el-dropdown-item>\n                <el-dropdown-item\n                  icon=\"el-icon-user-solid\"\n                  v-for=\"(user, index) in users.items\"\n                  :key=\"index\"\n                  :command=\"[user]\"\n                  >{{ user }}\n                </el-dropdown-item>\n              </el-dropdown-menu>\n            </template>\n          </el-dropdown>\n          <lin-date-picker @dateChange=\"handleDateChange\" ref=\"searchDateDom\" class=\"date\"> </lin-date-picker>\n        </div>\n      </div>\n      <el-divider v-if=\"!keyword\"></el-divider>\n    </sticky-top>\n    <transition name=\"fade\">\n      <div class=\"search\" v-if=\"keyword\">\n        <p class=\"search-tip\">\n          搜索“<span class=\"search-keyword\">{{ keyword }}</span\n          >”， 找到 <span class=\"search-num\">{{ totalCount }}</span> 条日志信息\n        </p>\n        <button class=\"search-back\" @click=\"backInit\">返回全部日志</button>\n      </div>\n    </transition>\n    <div class=\"content\" v-loading=\"loading\">\n      <article>\n        <section v-for=\"log in logs\" :key=\"log.id\">\n          <span class=\"point-time\"></span>\n          <aside>\n            <p class=\"things\" v-html=\"log.message\"></p>\n            <p class=\"brief\">\n              <span class=\"text-yellow\">{{ log.username }}</span> {{ $filters.dateTimeFormatter(log.time) }}\n            </p>\n          </aside>\n        </section>\n      </article>\n\n      <div v-if=\"totalCount > count || totalCount === 0\">\n        <div v-if=\"logs?.length\">\n          <el-divider></el-divider>\n          <div class=\"more\" :class=\"{ nothing: finished }\">\n            <i v-if=\"more\" class=\"iconfont icon-loading\"></i>\n            <div v-show=\"!more && !finished\" @click=\"nextPage\">\n              <span>查看更多</span> <i class=\"iconfont icon-gengduo\" style=\"font-size: 14px\"></i>\n            </div>\n            <div v-if=\"finished\">\n              <span>{{ totalCount === 0 ? '暂无数据' : '没有更多数据了' }}</span>\n            </div>\n          </div>\n        </div>\n        <div class=\"nothing\" v-else>暂无日志信息</div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { useStore } from 'vuex'\nimport { computed, ref, reactive, watch, onMounted, toRefs } from 'vue'\n\nimport logModel from 'lin/model/log'\nimport { searchLogKeyword } from 'lin/util/search'\nimport LinSearch from '@/component/base/search/lin-search'\nimport LinDatePicker from '@/component/base/date-picker/lin-date-picker'\n\nexport default {\n  components: {\n    LinSearch,\n    LinDatePicker,\n  },\n  setup() {\n    // originally data properties\n    const store = useStore()\n    const user = computed(() => store.getters.user)\n    const permissions = computed(() => store.getters.permissions)\n\n    const count = 10\n    const logs = ref([])\n    const users = ref([])\n    const loading = ref(false)\n    const isSearch = ref(false)\n    const finished = ref(false)\n    const searchDateDom = ref()\n    const searchKeywordDom = ref()\n\n    /**\n     * Part 1\n     * 日志页面初始化\n     */\n    const initPage = async () => {\n      try {\n        loading.value = true\n        if (user.value.admin || permissions.value.includes('查询日志记录的用户')) {\n          users.value = await logModel.getLoggedUsers({})\n        }\n        const res = await logModel.getLogs({ page: 0, count })\n        logs.value = res.items\n        loading.value = false\n      } catch (err) {\n        loading.value = false\n        console.error(err.data)\n      }\n    }\n    onMounted(async () => {\n      await initPage()\n    })\n\n    /**\n     * Part 2\n     * 根据调解筛选查询日志\n     */\n    const search = reactive({\n      keyword: '',\n      searchUser: '',\n      searchKeyword: '',\n      searchDate: [],\n      totalCount: 0,\n    })\n\n    const onQueryChange = query => {\n      search.searchKeyword = query.trim()\n    }\n    const handleDateChange = date => {\n      search.searchDate = date\n    }\n    const handleCommand = currentUser => {\n      search.searchUser = currentUser[0] // eslint-disable-line\n    }\n    // 条件检索\n    const searchPage = async () => {\n      logs.value = []\n      loading.value = true\n      search.totalCount = 0\n      finished.value = false\n      const name = search.searchUser === '全部人员' ? '' : search.searchUser\n\n      const res = await logModel.searchLogs({\n        page: 0, // 初始化\n        keyword: search.searchKeyword,\n        name,\n        start: search.searchDate[0],\n        end: search.searchDate[1],\n      })\n      if (res) {\n        let searchLogs = res.items\n        search.totalCount = res.total\n        if (search.searchKeyword) {\n          searchLogs = searchLogKeyword(search.searchKeyword, searchLogs)\n        }\n        logs.value = searchLogs\n      } else {\n        finished.value = true\n      }\n      isSearch.value = true\n      loading.value = false\n    }\n\n    watch(\n      () => search.searchKeyword,\n      newKeyword => {\n        // 关键字搜索\n        if (newKeyword) {\n          search.keyword = newKeyword\n          if (search.searchUser) {\n            search.keyword = `${search.searchUser} ${newKeyword}`\n          }\n          if (search.searchDate.length) {\n            search.keyword = `${search.searchUser} ${newKeyword} ${search.searchDate[0]}至${search.searchDate[1]}`\n          }\n        } else {\n          search.keyword = ''\n          if (search.searchUser) {\n            search.keyword = `${search.searchUser}`\n          }\n          if (search.searchDate.length) {\n            search.keyword = `${search.searchUser} ${search.searchDate[0]}至${search.searchDate[1]}`\n          }\n          searchKeywordDom.value.clear()\n        }\n        searchPage()\n      },\n      { lazy: true },\n    )\n\n    watch(\n      () => search.searchUser,\n      newUser => {\n        // 用户搜索\n        search.keyword = newUser\n        if (search.searchKeyword) {\n          search.keyword = `${newUser} ${search.searchKeyword}`\n        }\n        if (search.searchDate.length) {\n          search.keyword = `${newUser} ${search.searchKeyword} ${search.searchDate[0]}至${search.searchDate[1]}`\n        }\n        searchPage()\n      },\n      { lazy: true },\n    )\n\n    watch(\n      () => search.searchDate,\n      newDate => {\n        if (newDate?.length) {\n          search.keyword = `${newDate[0]}至${newDate[1]}`\n          if (search.searchUser) {\n            search.keyword = `${search.searchUser} ${newDate[0]}至${newDate[1]}`\n          }\n          if (search.searchKeyword) {\n            search.keyword = `${search.searchUser} ${search.searchKeyword} ${newDate[0]}至${newDate[1]}`\n          }\n        } else {\n          search.keyword = ''\n          isSearch.value = false\n          if (search.searchUser) {\n            search.keyword = `${search.searchUser}`\n          }\n          if (search.searchKeyword) {\n            search.keyword = `${search.searchUser} ${search.searchKeyword}`\n          }\n          searchDateDom.value.clear()\n        }\n        searchPage()\n      },\n      { lazy: true },\n    )\n\n    const backInit = async () => {\n      search.searchUser = ''\n      search.searchKeyword = ''\n      search.searchDate = []\n      search.keyword = ''\n      search.totalCount = 0\n      logs.value = []\n      isSearch.value = false\n      await initPage()\n    }\n\n    /**\n     * Part 3\n     * 翻页处理\n     */\n    const more = ref(false)\n    const nextPage = async () => {\n      more.value = true\n      let res\n      try {\n        if (isSearch.value) {\n          res = await logModel.moreSearchPage()\n        } else {\n          res = await logModel.moreLogPage()\n        }\n\n        let moreLogs = res.items\n        if (!moreLogs.length) {\n          finished.value = true\n        } else {\n          if (isSearch.value && search.searchKeyword) {\n            moreLogs = await searchLogKeyword(search.searchKeyword, moreLogs)\n          }\n          logs.value = logs.value.concat(moreLogs)\n        }\n\n        more.value = false\n      } catch (error) {\n        console.error('error', error)\n\n        if (error.data.code === 10020) {\n          finished.value = true\n        }\n        more.value = false\n      }\n    }\n\n    return {\n      users,\n      logs,\n      more,\n      count,\n      loading,\n      finished,\n      backInit,\n      nextPage,\n      isSearch,\n      onQueryChange,\n      handleCommand,\n      searchDateDom,\n      handleDateChange,\n      searchKeywordDom,\n      ...toRefs(search),\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.log :v-deep(.el-button) {\n  padding-top: 10px;\n  padding-bottom: 10px;\n}\n.log {\n  .log-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 20px;\n    margin-bottom: -24px;\n\n    .header-left {\n      float: left;\n\n      .title {\n        height: 59px;\n        line-height: 59px;\n        color: #4c76af;\n        font-size: 16px;\n        font-weight: 500;\n      }\n    }\n\n    .header-right {\n      float: right;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    }\n  }\n\n  .search {\n    height: 52px;\n    width: 100%;\n    background: rgba(57, 99, 188, 0.1);\n    display: flex;\n    flex-direction: row;\n    justify-content: space-between;\n    margin-top: 24px;\n\n    .search-tip {\n      margin-left: 40px;\n      height: 52px;\n      line-height: 52px;\n      color: #354058;\n      font-size: 14px;\n\n      .search-keyword {\n        color: $theme;\n      }\n\n      .search-num {\n        color: #f4516c;\n      }\n    }\n\n    .search-back {\n      margin: 8px 20px;\n      height: 32px;\n      background: #f4516c;\n      border: none;\n      border-radius: 2px;\n      color: #fff;\n      padding: 0 13px;\n      font-size: 14px;\n      cursor: pointer;\n    }\n  }\n\n  .content {\n    padding: 40px 60px;\n\n    article {\n      position: relative;\n      margin-bottom: -24px;\n\n      section {\n        padding: 0 0 36px;\n        position: relative;\n\n        &:before {\n          content: '';\n          width: 1px;\n          top: 7px;\n          bottom: -17px;\n          left: 10.5px;\n          background: #f3f3f3;\n          position: absolute;\n        }\n\n        &:last-child:before {\n          display: none;\n        }\n\n        .point-time {\n          content: '';\n          position: absolute;\n          width: 10px;\n          height: 10px;\n          top: 2px;\n          left: 10px;\n          background: $theme;\n          margin-left: -4px;\n          border-radius: 50%;\n        }\n\n        time {\n          width: 15%;\n          display: block;\n          position: absolute;\n\n          span {\n            display: block;\n            text-align: right;\n          }\n        }\n\n        aside {\n          color: #45526b;\n          margin-left: 30px;\n\n          .things {\n            font-size: 14px;\n            color: #45526b;\n            margin-bottom: 15px;\n          }\n        }\n\n        .text-yellow {\n          color: #8c98ae;\n          font-size: 14px;\n          line-height: 20px;\n          padding-right: 30px;\n          float: left;\n        }\n\n        .brief {\n          font-size: 14px;\n          color: #c4c9d2;\n          height: 20px;\n          line-height: 20px;\n        }\n      }\n    }\n  }\n\n  .more {\n    height: 40px;\n    line-height: 40px;\n    color: $theme;\n    font-size: 14px;\n    margin-left: 28px;\n    cursor: pointer;\n    &.nothing {\n      cursor: text;\n    }\n\n    .icon-gengduo {\n      display: inline;\n      margin-left: 6px;\n    }\n\n    .icon-loading {\n      &:before {\n        display: inline-block;\n        animation: spin 1s linear infinite;\n      }\n    }\n  }\n}\n.nothing {\n  color: #45526b;\n  font-size: 14px;\n}\n\n@keyframes spin {\n  from {\n    transform: rotate(0deg);\n  }\n\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n@media screen and (max-width: 1000px) {\n  .date {\n    display: none;\n  }\n}\n</style>\n<style>\n.strong {\n  color: #464dd5;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}