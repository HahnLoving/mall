{"ast":null,"code":"import _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport dayjs from 'dayjs';\nimport Activity from '@/model/activity';\nimport Category from '@/model/category';\nimport coupon from '@/model/coupon';\nimport UploadImgs from '@/component/base/upload-image';\nimport CouponList from '../coupon/coupon-list';\nexport default {\n  components: {\n    UploadImgs: UploadImgs,\n    CouponList: CouponList\n  },\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    activityId: {\n      type: String,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      form: {\n        id: null,\n        name: '',\n        title: '',\n        description: '',\n        online: 1,\n        remark: '',\n        coupon_ids: []\n      },\n      types: ['下线', '上线'],\n      range: '',\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近三个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n            picker.$emit('pick', [start, end]);\n          }\n        }]\n      },\n      rules: {\n        minWidth: 10,\n        minHeight: 10,\n        maxSize: 5\n      },\n      initCoverData: [],\n      initTopData: [],\n      categoryIds: [],\n      couponIds: [],\n      maxNum: 1,\n      cascaderCategoryProps: {\n        lazy: true,\n        multiple: true,\n        lazyLoad: function lazyLoad(node, resolve) {\n          var _this = this;\n\n          return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n            var level, suggestions, nodes;\n            return regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    level = node.level;\n                    _context.prev = 1;\n                    _context.next = 4;\n                    return Category.getList();\n\n                  case 4:\n                    suggestions = _context.sent;\n                    nodes = suggestions.map(function (item) {\n                      return {\n                        value: item.id,\n                        label: \"\".concat(item.id, \"-\").concat(item.name),\n                        leaf: level >= 0\n                      };\n                    });\n                    resolve(nodes);\n                    _context.next = 12;\n                    break;\n\n                  case 9:\n                    _context.prev = 9;\n                    _context.t0 = _context[\"catch\"](1);\n\n                    _this.$message.error('获取分类信息失败，请检查网络');\n\n                  case 12:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee, null, [[1, 9]]);\n          }))();\n        }\n      },\n      cascaderCouponProps: {\n        lazy: true,\n        multiple: true,\n        lazyLoad: function lazyLoad(node, resolve) {\n          var _this2 = this;\n\n          return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n            var level, suggestions, nodes;\n            return regeneratorRuntime.wrap(function _callee2$(_context2) {\n              while (1) {\n                switch (_context2.prev = _context2.next) {\n                  case 0:\n                    level = node.level;\n                    _context2.prev = 1;\n                    _context2.next = 4;\n                    return coupon.getSuggestions(null);\n\n                  case 4:\n                    suggestions = _context2.sent;\n                    nodes = suggestions.map(function (item) {\n                      return {\n                        value: item.id,\n                        label: \"\".concat(item.id, \"-\").concat(item.name),\n                        leaf: level >= 0\n                      };\n                    });\n                    resolve(nodes);\n                    _context2.next = 12;\n                    break;\n\n                  case 9:\n                    _context2.prev = 9;\n                    _context2.t0 = _context2[\"catch\"](1);\n\n                    _this2.$message.error('获取优惠卷信息失败，请检查网络');\n\n                  case 12:\n                  case \"end\":\n                    return _context2.stop();\n                }\n              }\n            }, _callee2, null, [[1, 9]]);\n          }))();\n        }\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this3 = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n      var res, end, start;\n      return regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              if (_this3.isCreate) {\n                _context3.next = 12;\n                break;\n              }\n\n              _context3.next = 3;\n              return Activity.getActivityDetail(_this3.activityId);\n\n            case 3:\n              res = _context3.sent;\n              _this3.form = res;\n              end = new Date(res.end_time);\n              start = new Date(res.start_time);\n              _this3.range = [start, end];\n              _this3.initCoverData = [{\n                id: res.id,\n                display: res.entrance_img\n              }];\n              _this3.initTopData = [{\n                id: res.id,\n                display: res.internal_top_img\n              }];\n              _this3.couponIds = res.coupon_ids.map(function (it) {\n                return [it];\n              });\n              _this3.form.coupon_ids = res.coupon_ids;\n\n            case 12:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }))();\n  },\n  methods: {\n    // eslint-disable-next-line\n    submitForm: function submitForm(formName) {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {\n        var postData, res;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return _this4.getValue();\n\n              case 2:\n                _context5.prev = 2;\n                postData = _objectSpread({}, _this4.form);\n\n                if (_this4.form.activity_cover_id === 0) {\n                  _this4.form.activity_cover_id = null;\n                }\n\n                postData.coupon_ids = _this4.couponIds.map(function (it) {\n                  return it[0];\n                });\n                postData.start_time = _this4.dateFormat(_this4.range[0]);\n                postData.end_time = _this4.dateFormat(_this4.range[1]);\n\n                if (!_this4.isCreate) {\n                  _context5.next = 14;\n                  break;\n                }\n\n                _context5.next = 11;\n                return Activity.addActivity(postData);\n\n              case 11:\n                res = _context5.sent;\n                _context5.next = 17;\n                break;\n\n              case 14:\n                _context5.next = 16;\n                return Activity.editActivity(_this4.activityId, // eslint-disable-next-line\n                postData);\n\n              case 16:\n                res = _context5.sent;\n\n              case 17:\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this4.$message.success(\"\".concat(res.message));\n\n                  _this4.$confirm('是否返回上一页?', '提示', {\n                    confirmButtonText: '是',\n                    cancelButtonText: '否',\n                    type: 'info'\n                  }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n                    return regeneratorRuntime.wrap(function _callee4$(_context4) {\n                      while (1) {\n                        switch (_context4.prev = _context4.next) {\n                          case 0:\n                            _this4.$emit('editClose');\n\n                          case 1:\n                          case \"end\":\n                            return _context4.stop();\n                        }\n                      }\n                    }, _callee4);\n                  })));\n                }\n\n                _context5.next = 23;\n                break;\n\n              case 20:\n                _context5.prev = 20;\n                _context5.t0 = _context5[\"catch\"](2);\n                console.error(_context5.t0);\n\n              case 23:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, null, [[2, 20]]);\n      }))();\n    },\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    back: function back() {\n      this.$emit('editClose');\n    },\n    dateFormat: function dateFormat(val) {\n      return dayjs(val).format('YYYY-MM-DD HH:mm:ss');\n    },\n    getValue: function getValue() {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {\n        var val, val1;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return _this5.$refs.uploadTopEle.getValue();\n\n              case 2:\n                val = _context6.sent;\n\n                if (val && val.length > 0) {\n                  _this5.form.internal_top_img = val[0].display;\n                }\n\n                _context6.next = 6;\n                return _this5.$refs.uploadCoverEle.getValue();\n\n              case 6:\n                val1 = _context6.sent;\n\n                if (val1 && val1.length > 0) {\n                  _this5.form.entrance_img = val1[0].display;\n                }\n\n              case 8:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }))();\n    }\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/activity/activity-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <sticky-top>\n      <div class=\"title\">\n        <span>{{ isCreate ? '创建优惠卷' : '更新优惠卷' }}</span>\n        <span class=\"back\" @click=\"back\"> <i class=\"iconfont icon-fanhui\"></i> 返回 </span>\n        <el-divider></el-divider>\n      </div>\n    </sticky-top>\n    <div class=\"container\">\n      <div class=\"wrap\">\n        <el-row>\n          <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n            <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" @submit.native.prevent>\n              <el-form-item label=\"标题\" prop=\"title\">\n                <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写优惠卷标题\"></el-input>\n              </el-form-item>\n\n              <el-form-item label=\"名称\" prop=\"name\">\n                <el-input size=\"medium\" v-model=\"form.name\" placeholder=\"请填写优惠卷名称\"></el-input>\n              </el-form-item>\n\n              <el-form-item label=\"提示\" prop=\"remark\">\n                <el-input size=\"medium\" v-model=\"form.remark\" placeholder=\"请填写优惠卷提示\"></el-input>\n              </el-form-item>\n\n              <el-form-item label=\"状态\" prop=\"online\">\n                <el-select v-model=\"form.online\" placeholder=\"请填写状态\">\n                  <el-option v-for=\"(item, index) in types\" :key=\"item\" :label=\"item\" :value=\"index\"></el-option>\n                </el-select>\n              </el-form-item>\n\n              <el-form-item label=\"时间\">\n                <el-date-picker\n                  v-model=\"range\"\n                  type=\"daterange\"\n                  align=\"right\"\n                  unlink-panels\n                  range-separator=\"至\"\n                  start-placeholder=\"开始日期\"\n                  end-placeholder=\"结束日期\"\n                  :picker-options=\"pickerOptions\"\n                ></el-date-picker>\n              </el-form-item>\n\n              <!-- <el-form-item label=\"选择分类\" prop=\"categoryIds\">\n                <el-cascader placeholder=\"选择分类\" v-model=\"categoryIds\" :props=\"cascaderCategoryProps\"></el-cascader>\n              </el-form-item>-->\n\n              <!-- <el-form-item label=\"选择优惠卷\" prop=\"couponIds\">\n                <el-cascader placeholder=\"选择优惠卷\" v-model=\"couponIds\" :props=\"cascaderCouponProps\"></el-cascader>\n              </el-form-item>-->\n\n              <el-form-item label=\"主图\" prop=\"cover_img\">\n                <upload-imgs :max-num=\"maxNum\" ref=\"uploadCoverEle\" :rules=\"rules\" :value=\"initCoverData\" />\n              </el-form-item>\n\n              <el-form-item label=\"顶部图\" prop=\"internal_top_img\">\n                <upload-imgs :max-num=\"maxNum\" ref=\"uploadTopEle\" :rules=\"rules\" :value=\"initTopData\" />\n              </el-form-item>\n\n              <el-form-item label=\"描述\" prop=\"description\">\n                <el-input size=\"medium\" v-model=\"form.description\" placeholder=\"请填写优惠卷描述\"></el-input>\n              </el-form-item>\n\n              <el-form-item class=\"submit\">\n                <el-button\n                  v-permission=\"{ permission: ['创建活动', '更新活动'], type: 'disabled' }\"\n                  type=\"primary\"\n                  @click=\"submitForm('form')\"\n                  >保 存</el-button\n                >\n                <el-button @click=\"resetForm('form')\">重 置</el-button>\n              </el-form-item>\n            </el-form>\n          </el-col>\n        </el-row>\n      </div>\n      <coupon-list v-if=\"!isCreate\" :activityId=\"activityId\"></coupon-list>\n    </div>\n  </div>\n</template>\n\n<script>\nimport dayjs from 'dayjs'\nimport Activity from '@/model/activity'\nimport Category from '@/model/category'\nimport coupon from '@/model/coupon'\nimport UploadImgs from '@/component/base/upload-image'\nimport CouponList from '../coupon/coupon-list'\n\nexport default {\n  components: { UploadImgs, CouponList },\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false,\n    },\n    activityId: {\n      type: String,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      form: {\n        id: null,\n        name: '',\n        title: '',\n        description: '',\n        online: 1,\n        remark: '',\n        coupon_ids: [],\n      },\n      types: ['下线', '上线'],\n      range: '',\n      pickerOptions: {\n        shortcuts: [\n          {\n            text: '最近一周',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 7)\n              picker.$emit('pick', [start, end])\n            },\n          },\n          {\n            text: '最近一个月',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 30)\n              picker.$emit('pick', [start, end])\n            },\n          },\n          {\n            text: '最近三个月',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 90)\n              picker.$emit('pick', [start, end])\n            },\n          },\n        ],\n      },\n      rules: {\n        minWidth: 10,\n        minHeight: 10,\n        maxSize: 5,\n      },\n      initCoverData: [],\n      initTopData: [],\n      categoryIds: [],\n      couponIds: [],\n      maxNum: 1,\n      cascaderCategoryProps: {\n        lazy: true,\n        multiple: true,\n        async lazyLoad(node, resolve) {\n          const { level } = node\n          try {\n            const suggestions = await Category.getList()\n            const nodes = suggestions.map(item => ({\n              value: item.id,\n              label: `${item.id}-${item.name}`,\n              leaf: level >= 0,\n            }))\n            resolve(nodes)\n          } catch (error) {\n            this.$message.error('获取分类信息失败，请检查网络')\n          }\n        },\n      },\n      cascaderCouponProps: {\n        lazy: true,\n        multiple: true,\n        async lazyLoad(node, resolve) {\n          const { level } = node\n          try {\n            const suggestions = await coupon.getSuggestions(null)\n            const nodes = suggestions.map(item => ({\n              value: item.id,\n              label: `${item.id}-${item.name}`,\n              leaf: level >= 0,\n            }))\n            resolve(nodes)\n          } catch (error) {\n            this.$message.error('获取优惠卷信息失败，请检查网络')\n          }\n        },\n      },\n    }\n  },\n  async mounted() {\n    if (!this.isCreate) {\n      const res = await Activity.getActivityDetail(this.activityId)\n      this.form = res\n      const end = new Date(res.end_time)\n      const start = new Date(res.start_time)\n      this.range = [start, end]\n      this.initCoverData = [\n        {\n          id: res.id,\n          display: res.entrance_img,\n        },\n      ]\n\n      this.initTopData = [\n        {\n          id: res.id,\n          display: res.internal_top_img,\n        },\n      ]\n      this.couponIds = res.coupon_ids.map(it => [it])\n      this.form.coupon_ids = res.coupon_ids\n    }\n  },\n  methods: {\n    // eslint-disable-next-line\n    async submitForm(formName) {\n      await this.getValue()\n      try {\n        const postData = { ...this.form }\n        if (this.form.activity_cover_id === 0) {\n          this.form.activity_cover_id = null\n        }\n        postData.coupon_ids = this.couponIds.map(it => it[0])\n        postData.start_time = this.dateFormat(this.range[0])\n        postData.end_time = this.dateFormat(this.range[1])\n        let res\n        if (this.isCreate) {\n          res = await Activity.addActivity(postData)\n        } else {\n          res = await Activity.editActivity(\n            this.activityId,\n            // eslint-disable-next-line\n            postData,\n          )\n        }\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.$message.success(`${res.message}`)\n          this.$confirm('是否返回上一页?', '提示', {\n            confirmButtonText: '是',\n            cancelButtonText: '否',\n            type: 'info',\n          }).then(async () => {\n            this.$emit('editClose')\n          })\n        }\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    back() {\n      this.$emit('editClose')\n    },\n    dateFormat(val) {\n      return dayjs(val).format('YYYY-MM-DD HH:mm:ss')\n    },\n    async getValue() {\n      const val = await this.$refs.uploadTopEle.getValue()\n      if (val && val.length > 0) {\n        this.form.internal_top_img = val[0].display\n      }\n      const val1 = await this.$refs.uploadCoverEle.getValue()\n      if (val1 && val1.length > 0) {\n        this.form.entrance_img = val1[0].display\n      }\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.el-divider--horizontal {\n  margin: 0;\n}\n\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n\n    .back {\n      float: right;\n      margin-right: 40px;\n      cursor: pointer;\n    }\n  }\n\n  .wrap {\n    padding: 20px;\n  }\n\n  .submit {\n    float: left;\n  }\n}\n\n.my-autocomplete {\n  li {\n    line-height: normal;\n    padding: 7px;\n    display: inline-flex;\n    align-content: space-around;\n    .name {\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n    .id {\n      margin-right: 15px;\n      font-size: 12px;\n      color: #b4b4b4;\n    }\n\n    .highlighted .addr {\n      color: #ddd;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}