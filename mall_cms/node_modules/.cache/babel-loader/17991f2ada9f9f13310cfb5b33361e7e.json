{"ast":null,"code":"import _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport GridCategory from '@/model/grid-category';\nimport Category from '@/model/category';\nimport UploadImgs from '@/component/base/upload-image';\nexport default {\n  name: \"grid-category-edit\",\n  components: {\n    UploadImgs: UploadImgs\n  },\n  props: {\n    dialogFormVisible: {\n      type: Boolean,\n      default: false\n    },\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    gridCategoryId: {\n      type: Number,\n      default: 0\n    }\n  },\n  computed: {\n    visible: {\n      get: function get() {\n        return this.dialogFormVisible;\n      },\n      set: function set() {}\n    }\n  },\n  data: function data() {\n    return {\n      state: '',\n      suggestions: [],\n      display: true,\n      initData: [],\n      maxNum: 1,\n      form: {\n        name: '',\n        title: '',\n        category_id: null,\n        root_category_id: null\n      }\n    };\n  },\n  watch: {\n    display: function display(val) {\n      this.form.online = val ? 1 : 0;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var res;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.isCreate) {\n                _context.next = 6;\n                break;\n              }\n\n              _context.next = 3;\n              return GridCategory.getGridCategory(_this.gridCategoryId);\n\n            case 3:\n              res = _context.sent;\n              _this.form = res;\n              _this.initData = [{\n                display: res.img\n              }];\n\n            case 6:\n              _this.loadSuggestions();\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    submitForm: function submitForm() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var form, res;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this2.getValue();\n\n              case 2:\n                form = _objectSpread({}, _this2.form);\n\n                if (!_this2.isCreate) {\n                  _context2.next = 9;\n                  break;\n                }\n\n                _context2.next = 6;\n                return GridCategory.addGridCategory(form);\n\n              case 6:\n                res = _context2.sent;\n                _context2.next = 12;\n                break;\n\n              case 9:\n                _context2.next = 11;\n                return GridCategory.editGridCategory(_this2.gridCategoryId, form);\n\n              case 11:\n                res = _context2.sent;\n\n              case 12:\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this2.$message.success(\"\".concat(res.message));\n\n                  _this2.$emit('dialogClose');\n                }\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    querySearch: function querySearch(queryString, cb) {\n      // eslint-disable-next-line\n      var suggestions = this.suggestions;\n      var results = queryString ? suggestions.filter(this.createFilter(queryString)) : suggestions;\n      cb(results);\n    },\n    createFilter: function createFilter(queryString) {\n      // eslint-disable-next-line\n      return function (suggestion) {\n        return suggestion.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0;\n      };\n    },\n    handleSelect: function handleSelect(item) {\n      this.state = item.name;\n      this.form.category_id = item.id;\n    },\n    getValue: function getValue() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var val;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _this3.$refs.uploadEle.getValue();\n\n              case 2:\n                val = _context3.sent;\n\n                if (val && val.length > 0) {\n                  _this3.form.img = val[0].display;\n                }\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    loadSuggestions: function loadSuggestions() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var inlineId, hit;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                _context4.next = 3;\n                return Category.getList();\n\n              case 3:\n                _this4.suggestions = _context4.sent;\n\n                if (_this4.suggestions.length === 0) {\n                  _this4.$message.error('未找到宫格建议，请先添加宫格');\n                }\n\n                _context4.next = 11;\n                break;\n\n              case 7:\n                _context4.prev = 7;\n                _context4.t0 = _context4[\"catch\"](0);\n\n                _this4.$message.error('获取宫格建议信息失败');\n\n                console.error(_context4.t0);\n\n              case 11:\n                inlineId = _this4.getInlineId(); // eslint-disable-next-line\n\n                hit = _this4.suggestions.filter(function (val) {\n                  return val.id === inlineId;\n                });\n\n                if (hit.length > 0) {\n                  _this4.state = hit[0].name;\n                }\n\n              case 14:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[0, 7]]);\n      }))();\n    },\n    getInlineId: function getInlineId() {\n      if (this.form.category_id) {\n        return this.form.category_id;\n      }\n\n      if (this.form.root_category_id) {\n        return this.form.root_category_id;\n      }\n\n      return null;\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    handleClose: function handleClose(done) {\n      done();\n      this.$emit('dialogClose');\n    }\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/grid-category/grid-category-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <!-- <el-dialog :append-to-body=\"true\" :before-close=\"handleClose\" :visible.sync=\"visible\" v-model=\"dialogFormVisible\"> -->\n    <div style=\"margin-top:-25px;\">\n      <div class=\"dialog-title\">\n        <span>{{ isCreate ? '创建六宫格' : '更新六宫格' }}</span>\n      </div>\n      <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" @submit.native.prevent>\n        <el-form-item label=\"标题\" prop=\"title\">\n          <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写宫格标题\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"名称\" prop=\"name\">\n          <el-input size=\"medium\" v-model=\"form.name\" placeholder=\"请填写宫格名\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"分类\" prop=\"category_id\">\n          <el-autocomplete\n            @focus=\"loadSuggestions\"\n            popper-class=\"my-autocomplete\"\n            class=\"inline-input\"\n            v-model=\"state\"\n            :fetch-suggestions=\"querySearch\"\n            placeholder=\"请填写所属分类\"\n            @select=\"handleSelect\"\n          >\n            <template #default=\"scope\">\n              <!-- <span class=\"id\">{{ item.id }}</span> -->\n              <span class=\"name\">{{ item.name }}</span>\n            </template>\n          </el-autocomplete>\n        </el-form-item>\n        <el-form-item label=\"图片\" prop=\"img\">\n          <upload-imgs ref=\"uploadEle\" :max-num=\"maxNum\" :value=\"initData\" />\n        </el-form-item>\n      </el-form>\n    </div>\n    <!-- <div slot=\"footer\" class=\"dialog-footer\" style=\"padding-left:5px;\">\n      <el-button type=\"primary\" @click=\"submitForm\" v-permission=\"{ permission: '更新六宫格', type: 'disabled' }\"\n        >确 定</el-button\n      >\n      <el-button @click=\"resetForm('form')\">重 置</el-button>\n    </div> -->\n  <!-- </el-dialog> -->\n</template>\n<script>\nimport GridCategory from '@/model/grid-category'\nimport Category from '@/model/category'\nimport UploadImgs from '@/component/base/upload-image'\n\nexport default {\n  name:\"grid-category-edit\",\n  components: {\n    UploadImgs,\n  },\n  props: {\n    dialogFormVisible: {\n      type: Boolean,\n      default: false,\n    },\n    isCreate: {\n      type: Boolean,\n      default: false,\n    },\n    gridCategoryId: {\n      type: Number,\n      default: 0,\n    },\n  },\n  computed: {\n    visible: {\n      get() {\n        return this.dialogFormVisible\n      },\n      set() {},\n    },\n  },\n  data() {\n    return {\n      state: '',\n      suggestions: [],\n      display: true,\n      initData: [],\n      maxNum: 1,\n      form: {\n        name: '',\n        title: '',\n        category_id: null,\n        root_category_id: null,\n      },\n    }\n  },\n  watch: {\n    display(val) {\n      this.form.online = val ? 1 : 0\n    },\n  },\n  async mounted() {\n    if (!this.isCreate) {\n      const res = await GridCategory.getGridCategory(this.gridCategoryId)\n      this.form = res\n      this.initData = [{ display: res.img }]\n    }\n    this.loadSuggestions()\n  },\n  methods: {\n    async submitForm() {\n      await this.getValue()\n      const form = { ...this.form }\n      let res\n      if (this.isCreate) {\n        res = await GridCategory.addGridCategory(form)\n      } else {\n        res = await GridCategory.editGridCategory(this.gridCategoryId, form)\n      }\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(`${res.message}`)\n        this.$emit('dialogClose')\n      }\n    },\n    querySearch(queryString, cb) {\n      // eslint-disable-next-line\n      const suggestions = this.suggestions\n      const results = queryString ? suggestions.filter(this.createFilter(queryString)) : suggestions\n      cb(results)\n    },\n    createFilter(queryString) {\n      // eslint-disable-next-line\n      return suggestion => {\n        return suggestion.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0\n      }\n    },\n    handleSelect(item) {\n      this.state = item.name\n      this.form.category_id = item.id\n    },\n    async getValue() {\n      const val = await this.$refs.uploadEle.getValue()\n      if (val && val.length > 0) {\n        this.form.img = val[0].display\n      }\n    },\n    async loadSuggestions() {\n      try {\n        this.suggestions = await Category.getList()\n        if (this.suggestions.length === 0) {\n          this.$message.error('未找到宫格建议，请先添加宫格')\n        }\n      } catch (error) {\n        this.$message.error('获取宫格建议信息失败')\n        console.error(error)\n      }\n      const inlineId = this.getInlineId()\n      // eslint-disable-next-line\n      const hit = this.suggestions.filter(val => {\n        return val.id === inlineId\n      })\n      if (hit.length > 0) {\n        this.state = hit[0].name\n      }\n    },\n    getInlineId() {\n      if (this.form.category_id) {\n        return this.form.category_id\n      }\n      if (this.form.root_category_id) {\n        return this.form.root_category_id\n      }\n      return null\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    handleClose(done) {\n      done()\n      this.$emit('dialogClose')\n    },\n  },\n}\n</script>\n<style lang=\"scss\" scoped>\n.dialog-title {\n  color: $parent-title-color;\n  font-size: 16px;\n  margin-bottom: 20px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}