{"ast":null,"code":"import _typeof from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/mall/mall_cms/node_modules/@babel/runtime/helpers/esm/typeof.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.object.seal.js\";\n\n/* Author: https://github.com/nathantsoi/vue-native-websocket */\nimport Notify from './notify.vue';\nimport Observer from './observer';\nimport Emitter from './emitter';\nexport default {\n  install: function install(app, connection) {\n    var opts = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n\n    if (_typeof(connection) === 'object') {\n      // eslint-disable-next-line no-param-reassign\n      opts = connection; // eslint-disable-next-line no-param-reassign\n\n      connection = '';\n    }\n\n    var observer = null;\n\n    opts.$setInstance = function (wsInstance) {\n      app.config.globalProperties.$socket = wsInstance;\n    };\n\n    app.config.globalProperties.$connect = function () {\n      var connectionUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : connection;\n      var connectionOpts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : opts;\n      connectionOpts.$setInstance = opts.$setInstance;\n      observer = new Observer(connectionUrl, connectionOpts);\n      app.config.globalProperties.$socket = observer.WebSocket;\n    };\n\n    app.config.globalProperties.$disconnect = function () {\n      var _observer;\n\n      if ((_observer = observer) !== null && _observer !== void 0 && _observer.reconnection) {\n        observer.reconnection = false;\n      }\n\n      if (app.config.globalProperties.$socket) {\n        app.config.globalProperties.$socket.close();\n        delete app.config.globalProperties.$socket;\n      }\n    };\n\n    var hasProxy = typeof Proxy !== 'undefined' && typeof Proxy === 'function' && /native code/.test(Proxy.toString());\n    app.component('LinNotify', Notify);\n    app.mixin({\n      created: function created() {\n        var _this = this;\n\n        var vm = this;\n        var sockets = this.$options.sockets;\n\n        if (hasProxy) {\n          this.$options.sockets = new Proxy({}, {\n            set: function set(target, key, value) {\n              Emitter.addListener(key, value, vm);\n              target[key] = value;\n              return true;\n            },\n            deleteProperty: function deleteProperty(target, key) {\n              Emitter.removeListener(key, vm.$options.sockets[key], vm);\n              delete target.key;\n              return true;\n            }\n          });\n\n          if (sockets) {\n            Object.keys(sockets).forEach(function (key) {\n              _this.$options.sockets[key] = sockets[key];\n            });\n          }\n        } else {\n          Object.seal(this.$options.sockets); // if !hasProxy need addListener\n\n          if (sockets) {\n            Object.keys(sockets).forEach(function (key) {\n              Emitter.addListener(key, sockets[key], vm);\n            });\n          }\n        }\n      },\n      beforeUnmount: function beforeUnmount() {\n        var _this2 = this;\n\n        if (hasProxy) {\n          var sockets = this.$options.sockets;\n\n          if (sockets) {\n            Object.keys(sockets).forEach(function (key) {\n              delete _this2.$options.sockets[key];\n            });\n          }\n        }\n      }\n    });\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/component/notify/index.js"],"names":["Notify","Observer","Emitter","install","app","connection","opts","observer","$setInstance","wsInstance","config","globalProperties","$socket","$connect","connectionUrl","connectionOpts","WebSocket","$disconnect","reconnection","close","hasProxy","Proxy","test","toString","component","mixin","created","vm","sockets","$options","set","target","key","value","addListener","deleteProperty","removeListener","Object","keys","forEach","seal","beforeUnmount"],"mappings":"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","sourcesContent":["/* Author: https://github.com/nathantsoi/vue-native-websocket */\nimport Notify from './notify.vue'\nimport Observer from './observer'\nimport Emitter from './emitter'\n\nexport default {\n  install(app, connection, opts = {}) {\n    if (typeof connection === 'object') {\n      // eslint-disable-next-line no-param-reassign\n      opts = connection\n      // eslint-disable-next-line no-param-reassign\n      connection = ''\n    }\n    let observer = null\n\n    opts.$setInstance = wsInstance => {\n      app.config.globalProperties.$socket = wsInstance\n    }\n    app.config.globalProperties.$connect = (connectionUrl = connection, connectionOpts = opts) => {\n      connectionOpts.$setInstance = opts.$setInstance\n      observer = new Observer(connectionUrl, connectionOpts)\n      app.config.globalProperties.$socket = observer.WebSocket\n    }\n\n    app.config.globalProperties.$disconnect = () => {\n      if (observer?.reconnection) {\n        observer.reconnection = false\n      }\n      if (app.config.globalProperties.$socket) {\n        app.config.globalProperties.$socket.close()\n        delete app.config.globalProperties.$socket\n      }\n    }\n    const hasProxy = typeof Proxy !== 'undefined' && typeof Proxy === 'function' && /native code/.test(Proxy.toString())\n    app.component('LinNotify', Notify)\n    app.mixin({\n      created() {\n        const vm = this\n        const { sockets } = this.$options\n\n        if (hasProxy) {\n          this.$options.sockets = new Proxy(\n            {},\n            {\n              set(target, key, value) {\n                Emitter.addListener(key, value, vm)\n                target[key] = value\n                return true\n              },\n              deleteProperty(target, key) {\n                Emitter.removeListener(key, vm.$options.sockets[key], vm)\n                delete target.key\n                return true\n              },\n            },\n          )\n          if (sockets) {\n            Object.keys(sockets).forEach(key => {\n              this.$options.sockets[key] = sockets[key]\n            })\n          }\n        } else {\n          Object.seal(this.$options.sockets)\n\n          // if !hasProxy need addListener\n          if (sockets) {\n            Object.keys(sockets).forEach(key => {\n              Emitter.addListener(key, sockets[key], vm)\n            })\n          }\n        }\n      },\n      beforeUnmount() {\n        if (hasProxy) {\n          const { sockets } = this.$options\n\n          if (sockets) {\n            Object.keys(sockets).forEach(key => {\n              delete this.$options.sockets[key]\n            })\n          }\n        }\n      },\n    })\n  },\n}\n"]},"metadata":{},"sourceType":"module"}