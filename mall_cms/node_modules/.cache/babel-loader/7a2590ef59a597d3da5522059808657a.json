{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport { toDisplayString as _toDisplayString, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, withModifiers as _withModifiers, createTextVNode as _createTextVNode, resolveDirective as _resolveDirective, withDirectives as _withDirectives, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-05b47606\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  style: {\n    \"margin-top\": \"-25px\"\n  }\n};\nvar _hoisted_2 = {\n  class: \"dialog-title\"\n};\nvar _hoisted_3 = {\n  class: \"id\"\n};\nvar _hoisted_4 = {\n  class: \"name\"\n};\nvar _hoisted_5 = {\n  slot: \"footer\",\n  class: \"dialog-footer\",\n  style: {\n    \"padding-left\": \"5px\"\n  }\n};\n\nvar _hoisted_6 = /*#__PURE__*/_createTextVNode(\"确 定\");\n\nvar _hoisted_7 = /*#__PURE__*/_createTextVNode(\"重 置\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_input = _resolveComponent(\"el-input\");\n\n  var _component_el_form_item = _resolveComponent(\"el-form-item\");\n\n  var _component_el_autocomplete = _resolveComponent(\"el-autocomplete\");\n\n  var _component_upload_imgs = _resolveComponent(\"upload-imgs\");\n\n  var _component_el_form = _resolveComponent(\"el-form\");\n\n  var _component_el_button = _resolveComponent(\"el-button\");\n\n  var _directive_permission = _resolveDirective(\"permission\");\n\n  return _openBlock(), _createElementBlock(_Fragment, null, [_createTextVNode(_toDisplayString($options.isCreate), 1\n  /* TEXT */\n  ), _createCommentVNode(\" <el-dialog :append-to-body=\\\"true\\\" :before-close=\\\"handleClose\\\" :visible.sync=\\\"visible\\\" v-model=\\\"dialogFormVisible\\\"> \"), _createElementVNode(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"span\", null, _toDisplayString($options.isCreate ? '创建六宫格' : '更新六宫格'), 1\n  /* TEXT */\n  )]), _createVNode(_component_el_form, {\n    model: $data.form,\n    \"status-icon\": \"\",\n    ref: \"form\",\n    \"label-width\": \"100px\",\n    onSubmit: _cache[3] || (_cache[3] = _withModifiers(function () {}, [\"prevent\"]))\n  }, {\n    default: _withCtx(function () {\n      return [_createVNode(_component_el_form_item, {\n        label: \"标题\",\n        prop: \"title\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            size: \"medium\",\n            modelValue: $data.form.title,\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n              return $data.form.title = $event;\n            }),\n            placeholder: \"请填写宫格标题\"\n          }, null, 8\n          /* PROPS */\n          , [\"modelValue\"])];\n        }),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        label: \"名称\",\n        prop: \"name\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            size: \"medium\",\n            modelValue: $data.form.name,\n            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n              return $data.form.name = $event;\n            }),\n            placeholder: \"请填写宫格名\"\n          }, null, 8\n          /* PROPS */\n          , [\"modelValue\"])];\n        }),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        label: \"分类\",\n        prop: \"category_id\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_autocomplete, {\n            onFocus: $options.loadSuggestions,\n            \"popper-class\": \"my-autocomplete\",\n            class: \"inline-input\",\n            modelValue: $data.state,\n            \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n              return $data.state = $event;\n            }),\n            \"fetch-suggestions\": $options.querySearch,\n            placeholder: \"请填写所属分类\",\n            onSelect: $options.handleSelect\n          }, {\n            default: _withCtx(function (_ref) {\n              var item = _ref.item;\n              return [_createElementVNode(\"span\", _hoisted_3, _toDisplayString(item.id), 1\n              /* TEXT */\n              ), _createElementVNode(\"span\", _hoisted_4, _toDisplayString(item.name), 1\n              /* TEXT */\n              )];\n            }),\n            _: 1\n            /* STABLE */\n\n          }, 8\n          /* PROPS */\n          , [\"onFocus\", \"modelValue\", \"fetch-suggestions\", \"onSelect\"])];\n        }),\n        _: 1\n        /* STABLE */\n\n      }), _createVNode(_component_el_form_item, {\n        label: \"图片\",\n        prop: \"img\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_upload_imgs, {\n            ref: \"uploadEle\",\n            \"max-num\": $data.maxNum,\n            value: $data.initData\n          }, null, 8\n          /* PROPS */\n          , [\"max-num\", \"value\"])];\n        }),\n        _: 1\n        /* STABLE */\n\n      })];\n    }),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"model\"])]), _createElementVNode(\"div\", _hoisted_5, [_withDirectives(_createVNode(_component_el_button, {\n    type: \"primary\",\n    onClick: $options.submitForm\n  }, {\n    default: _withCtx(function () {\n      return [_hoisted_6];\n    }),\n    _: 1\n    /* STABLE */\n\n  }, 8\n  /* PROPS */\n  , [\"onClick\"]), [[_directive_permission, {\n    permission: '更新六宫格',\n    type: 'disabled'\n  }]]), _createVNode(_component_el_button, {\n    onClick: _cache[4] || (_cache[4] = function ($event) {\n      return $options.resetForm('form');\n    })\n  }, {\n    default: _withCtx(function () {\n      return [_hoisted_7];\n    }),\n    _: 1\n    /* STABLE */\n\n  })]), _createCommentVNode(\" </el-dialog> \")], 64\n  /* STABLE_FRAGMENT */\n  );\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/grid-category/grid-category-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    {{isCreate}}\n  <!-- <el-dialog :append-to-body=\"true\" :before-close=\"handleClose\" :visible.sync=\"visible\" v-model=\"dialogFormVisible\"> -->\n    <div style=\"margin-top:-25px;\">\n      <div class=\"dialog-title\">\n        <span>{{ isCreate ? '创建六宫格' : '更新六宫格' }}</span>\n      </div>\n      <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" @submit.native.prevent>\n        <el-form-item label=\"标题\" prop=\"title\">\n          <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写宫格标题\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"名称\" prop=\"name\">\n          <el-input size=\"medium\" v-model=\"form.name\" placeholder=\"请填写宫格名\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"分类\" prop=\"category_id\">\n          <el-autocomplete\n            @focus=\"loadSuggestions\"\n            popper-class=\"my-autocomplete\"\n            class=\"inline-input\"\n            v-model=\"state\"\n            :fetch-suggestions=\"querySearch\"\n            placeholder=\"请填写所属分类\"\n            @select=\"handleSelect\"\n          >\n            <template #default=\"{ item }\">\n              <span class=\"id\">{{ item.id }}</span>\n              <span class=\"name\">{{ item.name }}</span>\n            </template>\n          </el-autocomplete>\n        </el-form-item>\n        <el-form-item label=\"图片\" prop=\"img\">\n          <upload-imgs ref=\"uploadEle\" :max-num=\"maxNum\" :value=\"initData\" />\n        </el-form-item>\n      </el-form>\n    </div>\n    <div slot=\"footer\" class=\"dialog-footer\" style=\"padding-left:5px;\">\n      <el-button type=\"primary\" @click=\"submitForm\" v-permission=\"{ permission: '更新六宫格', type: 'disabled' }\"\n        >确 定</el-button\n      >\n      <el-button @click=\"resetForm('form')\">重 置</el-button>\n    </div>\n  <!-- </el-dialog> -->\n</template>\n<script>\nimport GridCategory from '@/model/grid-category'\nimport Category from '@/model/category'\nimport UploadImgs from '@/component/base/upload-image'\n\nexport default {\n  name:\"grid-category-edit\",\n  components: {\n    UploadImgs,\n  },\n  props: {\n    dialogFormVisible: {\n      type: Boolean,\n      default: false,\n    },\n    isCreate: {\n      type: Boolean,\n      default: false,\n    },\n    gridCategoryId: {\n      type: Number,\n      default: 0,\n    },\n  },\n  computed: {\n    visible: {\n      get() {\n        return this.dialogFormVisible\n      },\n      set() {},\n    },\n    isCreate: {\n      get() {\n        return this.isCreate\n      },\n      set() {\n        // if (!this.isCreate) {\n        //   const res = await GridCategory.getGridCategory(this.gridCategoryId)\n        //   this.form = res\n        //   this.initData = [{ display: res.img }]\n        // }\n        this.loadSuggestions()\n      },\n    },\n  },\n  data() {\n    return {\n      state: '',\n      suggestions: [],\n      display: true,\n      initData: [],\n      maxNum: 1,\n      form: {\n        name: '',\n        title: '',\n        category_id: null,\n        root_category_id: null,\n      },\n    }\n  },\n  watch: {\n    display(val) {\n      this.form.online = val ? 1 : 0\n    },\n  },\n  async mounted() {\n    if (!this.isCreate) {\n      const res = await GridCategory.getGridCategory(this.gridCategoryId)\n      this.form = res\n      this.initData = [{ display: res.img }]\n    }\n    this.loadSuggestions()\n  },\n  // async updated() {\n  //   if (!this.isCreate) {\n  //     const res = await GridCategory.getGridCategory(this.gridCategoryId)\n  //     this.form = res\n  //     this.initData = [{ display: res.img }]\n  //   }\n  //   this.loadSuggestions()\n  // },\n  methods: {\n    async submitForm() {\n      await this.getValue()\n      const form = { ...this.form }\n      let res\n      if (this.isCreate) {\n        res = await GridCategory.addGridCategory(form)\n      } else {\n        res = await GridCategory.editGridCategory(this.gridCategoryId, form)\n      }\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(`${res.message}`)\n        this.$emit('dialogClose')\n      }\n    },\n    querySearch(queryString, cb) {\n      // eslint-disable-next-line\n      const suggestions = this.suggestions\n      const results = queryString ? suggestions.filter(this.createFilter(queryString)) : suggestions\n      cb(results)\n    },\n    createFilter(queryString) {\n      // eslint-disable-next-line\n      return suggestion => {\n        return suggestion.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0\n      }\n    },\n    handleSelect(item) {\n      this.state = item.name\n      this.form.category_id = item.id\n    },\n    async getValue() {\n      const val = await this.$refs.uploadEle.getValue()\n      if (val && val.length > 0) {\n        this.form.img = val[0].display\n      }\n    },\n    async loadSuggestions() {\n      try {\n        this.suggestions = await Category.getList()\n        if (this.suggestions.length === 0) {\n          this.$message.error('未找到宫格建议，请先添加宫格')\n        }\n      } catch (error) {\n        this.$message.error('获取宫格建议信息失败')\n        console.error(error)\n      }\n      const inlineId = this.getInlineId()\n      // eslint-disable-next-line\n      const hit = this.suggestions.filter(val => {\n        return val.id === inlineId\n      })\n      if (hit.length > 0) {\n        this.state = hit[0].name\n      }\n    },\n    getInlineId() {\n      if (this.form.category_id) {\n        return this.form.category_id\n      }\n      if (this.form.root_category_id) {\n        return this.form.root_category_id\n      }\n      return null\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    handleClose(done) {\n      done()\n      this.$emit('dialogClose')\n    },\n  },\n}\n</script>\n<style lang=\"scss\" scoped>\n.dialog-title {\n  color: $parent-title-color;\n  font-size: 16px;\n  margin-bottom: 20px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}