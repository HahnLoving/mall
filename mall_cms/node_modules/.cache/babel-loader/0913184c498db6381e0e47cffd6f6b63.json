{"ast":null,"code":"import _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport dayjs from 'dayjs';\nimport Coupon from '@/model/coupon';\nexport default {\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    couponId: {\n      type: String,\n      default: null\n    },\n    activityId: {\n      type: String,\n      default: null\n    },\n    templateData: {\n      type: Object,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      form: {\n        name: '',\n        title: '',\n        full_money: null,\n        minus: null,\n        discount: null,\n        type: null,\n        activity_id: null\n      },\n      types: [],\n      range: '',\n      pickerOptions: {\n        shortcuts: [{\n          text: '最近一周',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近一个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n            picker.$emit('pick', [start, end]);\n          }\n        }, {\n          text: '最近三个月',\n          onClick: function onClick(picker) {\n            var end = new Date();\n            var start = new Date();\n            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n            picker.$emit('pick', [start, end]);\n          }\n        }]\n      }\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var res, end, start;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.types = Coupon.types;\n\n              if (_this.isCreate) {\n                _context.next = 11;\n                break;\n              }\n\n              _context.next = 4;\n              return Coupon.getCoupon(_this.couponId);\n\n            case 4:\n              res = _context.sent;\n              _this.form = res;\n              end = new Date(res.end_time);\n              start = new Date(res.start_time);\n              _this.range = [start, end];\n              _context.next = 12;\n              break;\n\n            case 11:\n              _this.form = _this.templateData;\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var postData, res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _this2.form.activity_id = _this2.activityId;\n                _context3.prev = 1;\n                postData = _objectSpread({}, _this2.form);\n\n                if (postData.discount === 0) {\n                  postData.discount = null;\n                }\n\n                if (postData.minus === 0) {\n                  postData.minus = null;\n                }\n\n                if (postData.full_money === 0) {\n                  postData.full_money = null;\n                }\n\n                postData.start_time = _this2.dateFormat(_this2.range[0]);\n                postData.end_time = _this2.dateFormat(_this2.range[1]);\n\n                if (!_this2.isCreate) {\n                  _context3.next = 14;\n                  break;\n                }\n\n                _context3.next = 11;\n                return Coupon.addCoupon(postData);\n\n              case 11:\n                res = _context3.sent;\n                _context3.next = 17;\n                break;\n\n              case 14:\n                _context3.next = 16;\n                return Coupon.editCoupon(_this2.couponId, // eslint-disable-next-line\n                postData);\n\n              case 16:\n                res = _context3.sent;\n\n              case 17:\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this2.$message.success(\"\".concat(res.message));\n\n                  _this2.resetForm(formName);\n\n                  _this2.$confirm('是否返回上一页?', '提示', {\n                    confirmButtonText: '是',\n                    cancelButtonText: '否',\n                    type: 'info'\n                  }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n                    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            _this2.$emit('editClose');\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  })));\n                }\n\n                _context3.next = 23;\n                break;\n\n              case 20:\n                _context3.prev = 20;\n                _context3.t0 = _context3[\"catch\"](1);\n                console.error(_context3.t0);\n\n              case 23:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[1, 20]]);\n      }))();\n    },\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    back: function back() {\n      this.$emit('editClose');\n    },\n    dateFormat: function dateFormat(val) {\n      return dayjs(val).format('YYYY-MM-DD HH:mm:ss');\n    }\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/coupon/CouponEdit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"title\">\n      <span>{{ isCreate ? '创建优惠卷' : '更新优惠卷' }}</span>\n      <span class=\"back\" @click=\"back\"> <i class=\"iconfont icon-fanhui\"></i> 返回 </span>\n    </div>\n    <div class=\"wrap\">\n      <el-row>\n        <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n          <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" @submit.native.prevent>\n            <el-form-item label=\"标题\" prop=\"title\">\n              <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写优惠卷标题\"></el-input>\n            </el-form-item>\n\n            <el-form-item label=\"满减额\" prop=\"full_money\">\n              <el-input-number v-model=\"form.full_money\" :precision=\"2\" :step=\"1\"></el-input-number>\n            </el-form-item>\n\n            <el-form-item label=\"优惠额\" prop=\"minus\">\n              <el-input-number v-model=\"form.minus\" :precision=\"2\" :step=\"1\"></el-input-number>\n            </el-form-item>\n\n            <el-form-item label=\"折扣\" prop=\"discount\">\n              <el-input-number v-model=\"form.discount\" :precision=\"2\" :step=\"0.1\" :max=\"1\"></el-input-number>\n            </el-form-item>\n\n            <el-form-item label=\"类型\" prop=\"type\">\n              <!-- <el-input size=\"medium\" v-model=\"form.type\" placeholder=\"请填写优惠卷类型\"></el-input> -->\n              <el-select v-model=\"form.type\" placeholder=\"请填写类型\">\n                <el-option v-for=\"(item, index) in types\" :key=\"item\" :label=\"item\" :value=\"index + 1\"></el-option>\n              </el-select>\n            </el-form-item>\n\n            <el-form-item label=\"时间\">\n              <el-date-picker\n                v-model=\"range\"\n                type=\"daterange\"\n                align=\"right\"\n                unlink-panels\n                range-separator=\"至\"\n                start-placeholder=\"开始日期\"\n                end-placeholder=\"结束日期\"\n                :picker-options=\"pickerOptions\"\n              ></el-date-picker>\n            </el-form-item>\n\n            <el-form-item label=\"描述\" prop=\"description\">\n              <el-input size=\"medium\" v-model=\"form.description\" placeholder=\"请填写优惠卷描述\"></el-input>\n            </el-form-item>\n\n            <el-form-item class=\"submit\">\n              <el-button\n                v-permission=\"{ permission: ['创建优惠卷', '更新优惠卷'], type: 'disabled' }\"\n                type=\"primary\"\n                @click=\"submitForm('form')\"\n                >保 存</el-button\n              >\n              <el-button @click=\"resetForm('form')\">重 置</el-button>\n            </el-form-item>\n          </el-form>\n        </el-col>\n      </el-row>\n    </div>\n  </div>\n</template>\n\n<script>\nimport dayjs from 'dayjs'\nimport Coupon from '@/model/coupon'\n\nexport default {\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false,\n    },\n    couponId: {\n      type: String,\n      default: null,\n    },\n    activityId: {\n      type: String,\n      default: null,\n    },\n    templateData: {\n      type: Object,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      form: {\n        name: '',\n        title: '',\n        full_money: null,\n        minus: null,\n        discount: null,\n        type: null,\n        activity_id: null,\n      },\n      types: [],\n      range: '',\n      pickerOptions: {\n        shortcuts: [\n          {\n            text: '最近一周',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 7)\n              picker.$emit('pick', [start, end])\n            },\n          },\n          {\n            text: '最近一个月',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 30)\n              picker.$emit('pick', [start, end])\n            },\n          },\n          {\n            text: '最近三个月',\n            onClick(picker) {\n              const end = new Date()\n              const start = new Date()\n              start.setTime(start.getTime() - 3600 * 1000 * 24 * 90)\n              picker.$emit('pick', [start, end])\n            },\n          },\n        ],\n      },\n    }\n  },\n  async mounted() {\n    this.types = Coupon.types\n    if (!this.isCreate) {\n      const res = await Coupon.getCoupon(this.couponId)\n      this.form = res\n      const end = new Date(res.end_time)\n      const start = new Date(res.start_time)\n      this.range = [start, end]\n    } else {\n      this.form = this.templateData\n    }\n  },\n  methods: {\n    async submitForm(formName) {\n      this.form.activity_id = this.activityId\n      try {\n        const postData = { ...this.form }\n        if (postData.discount === 0) {\n          postData.discount = null\n        }\n        if (postData.minus === 0) {\n          postData.minus = null\n        }\n        if (postData.full_money === 0) {\n          postData.full_money = null\n        }\n        postData.start_time = this.dateFormat(this.range[0])\n        postData.end_time = this.dateFormat(this.range[1])\n        let res\n        if (this.isCreate) {\n          res = await Coupon.addCoupon(postData)\n        } else {\n          res = await Coupon.editCoupon(\n            this.couponId,\n            // eslint-disable-next-line\n            postData,\n          )\n        }\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.$message.success(`${res.message}`)\n          this.resetForm(formName)\n          this.$confirm('是否返回上一页?', '提示', {\n            confirmButtonText: '是',\n            cancelButtonText: '否',\n            type: 'info',\n          }).then(async () => {\n            this.$emit('editClose')\n          })\n        }\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    back() {\n      this.$emit('editClose')\n    },\n    dateFormat(val) {\n      return dayjs(val).format('YYYY-MM-DD HH:mm:ss')\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.el-divider--horizontal {\n  margin: 0;\n}\n\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n\n    .back {\n      float: right;\n      margin-right: 40px;\n      cursor: pointer;\n    }\n  }\n\n  .wrap {\n    padding: 20px;\n  }\n\n  .submit {\n    float: left;\n  }\n}\n\n.my-autocomplete {\n  li {\n    line-height: normal;\n    padding: 7px;\n    display: inline-flex;\n    align-content: space-around;\n    .name {\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n    .id {\n      margin-right: 15px;\n      font-size: 12px;\n      color: #b4b4b4;\n    }\n\n    .highlighted .addr {\n      color: #ddd;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}