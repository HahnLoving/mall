{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport { onMounted, ref } from 'vue';\nimport { ElMessageBox, ElMessage } from 'element-plus';\nimport bookModel from '@/model/book';\nimport GridCategory from '@/model/grid-category';\nimport GridCategoryEdit from './grid-category-edit';\nexport default {\n  components: {\n    GridCategoryEdit: GridCategoryEdit\n  },\n  setup: function setup() {\n    var books = ref([]);\n    var editBookId = ref(1);\n    var loading = ref(false);\n    var showEdit = ref(false);\n    var tableData = ref([]);\n    onMounted(function () {\n      // getBooks()\n      getGridCategories();\n    });\n\n    var getBooks = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                loading.value = true;\n                _context.next = 4;\n                return bookModel.getBooks();\n\n              case 4:\n                books.value = _context.sent;\n                loading.value = false;\n                _context.next = 12;\n                break;\n\n              case 8:\n                _context.prev = 8;\n                _context.t0 = _context[\"catch\"](0);\n                loading.value = false;\n\n                if (_context.t0.code === 10020) {\n                  books.value = [];\n                }\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 8]]);\n      }));\n\n      return function getBooks() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    var getGridCategories = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                // const gridCategories = await GridCategory.getGridCategories()\n                // console.log(\"zzr123 = \",gridCategories)\n                // this.tableData = gridCategories\n                // this.initImgSrcList()\n                console.log('zzr123');\n                _context2.prev = 1;\n                loading.value = true;\n                _context2.next = 5;\n                return GridCategory.getBooks();\n\n              case 5:\n                tableData.value = _context2.sent;\n                loading.value = false;\n                _context2.next = 13;\n                break;\n\n              case 9:\n                _context2.prev = 9;\n                _context2.t0 = _context2[\"catch\"](1);\n                loading.value = false;\n\n                if (_context2.t0.code === 10020) {\n                  tableData.value = [];\n                }\n\n              case 13:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[1, 9]]);\n      }));\n\n      return function getGridCategories() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    var handleEdit = function handleEdit(id) {\n      showEdit.value = true;\n      editBookId.value = id;\n    };\n\n    var handleDelete = function handleDelete(id) {\n      ElMessageBox.confirm('此操作将永久删除该图书, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return bookModel.deleteBook(id);\n\n              case 2:\n                res = _context3.sent;\n\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  getBooks();\n                  ElMessage.success(\"\".concat(res.message));\n                }\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      })));\n    };\n\n    var editClose = function editClose() {\n      showEdit.value = false;\n      getBooks();\n    };\n\n    var indexMethod = function indexMethod(index) {\n      return index + 1;\n    };\n\n    return {\n      books: books,\n      loading: loading,\n      showEdit: showEdit,\n      editClose: editClose,\n      handleEdit: handleEdit,\n      editBookId: editBookId,\n      indexMethod: indexMethod,\n      handleDelete: handleDelete\n    };\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/grid-category/grid-category-list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"header\">\n      <div class=\"title\">六宫格列表</div>\n      <el-button\n        style=\"margin-left: 30px;\"\n        @click.prevent=\"handleAdd\"\n        type=\"primary\"\n        plain\n        size=\"medium\"\n        v-permission=\"{ permission: '创建六宫格', type: 'disabled' }\"\n        >创建六宫格</el-button\n      >\n    </div>\n    <el-table stripe v-loading=\"loading\" :data=\"tableData\">\n      <el-table-column prop=\"id\" label=\"id\" width=\"100\"></el-table-column>\n      <el-table-column prop=\"img\" label=\"图片\" width=\"200\">\n        <template v-if=\"scope.row.img\" slot-scope=\"scope\">\n          <el-image :src=\"scope.row.img\" :preview-src-list=\"imgSrcList\" style=\"max-height: 50px; max-width: 100px;\">\n          </el-image>\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"title\" label=\"标题\" width=\"200\"></el-table-column>\n      <el-table-column prop=\"category_id\" label=\"分类id\" width=\"150\"></el-table-column>\n      <el-table-column prop=\"root_category_id\" label=\"父分类id\" width=\"150\"></el-table-column>\n      <el-table-column prop=\"index\" label=\"排序\" width=\"150\"></el-table-column>\n      <el-table-column fixed=\"right\" width=\"150\" label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button @click.prevent=\"handleEdit(scope.row)\" type=\"primary\" plain size=\"mini\">编辑</el-button>\n          <el-button\n            @click.prevent=\"handleDelete(scope.row)\"\n            type=\"danger\"\n            plain\n            size=\"mini\"\n            v-permission=\"{ permission: '删除六宫格', type: 'disabled' }\"\n            >删除</el-button\n          >\n        </template>\n      </el-table-column>\n    </el-table>\n    <!--  创建/编辑分类弹窗  -->\n    <grid-category-edit\n      v-if=\"dialogFormVisible\"\n      :isCreate=\"isCreate\"\n      :dialogFormVisible=\"dialogFormVisible\"\n      :grid-category-id=\"gridCategoryId\"\n      @dialogClose=\"dialogClose\"\n    ></grid-category-edit>\n  </div>\n</template>\n\n<script>\nimport { onMounted, ref } from 'vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport bookModel from '@/model/book'\nimport GridCategory from '@/model/grid-category'\nimport GridCategoryEdit from './grid-category-edit'\n\nexport default {\n  components: {\n    GridCategoryEdit,\n  },\n  setup() {\n    const books = ref([])\n    const editBookId = ref(1)\n    const loading = ref(false)\n    const showEdit = ref(false)\n    const tableData = ref([])\n\n    onMounted(() => {\n      // getBooks()\n      getGridCategories()\n    })\n\n    const getBooks = async () => {\n      try {\n        loading.value = true\n        books.value = await bookModel.getBooks()\n        loading.value = false\n      } catch (error) {\n        loading.value = false\n        if (error.code === 10020) {\n          books.value = []\n        }\n      }\n    }\n\n    const getGridCategories = async () =>  {\n      // const gridCategories = await GridCategory.getGridCategories()\n      // console.log(\"zzr123 = \",gridCategories)\n      // this.tableData = gridCategories\n      // this.initImgSrcList()\n      console.log('zzr123')\n      try {\n        loading.value = true\n        tableData.value = await GridCategory.getBooks()\n        loading.value = false\n      } catch (error) {\n        loading.value = false\n        if (error.code === 10020) {\n          tableData.value = []\n        }\n      }\n    }\n\n    const handleEdit = id => {\n      showEdit.value = true\n      editBookId.value = id\n    }\n\n    const handleDelete = id => {\n      ElMessageBox.confirm('此操作将永久删除该图书, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        const res = await bookModel.deleteBook(id)\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          getBooks()\n          ElMessage.success(`${res.message}`)\n        }\n      })\n    }\n\n    const editClose = () => {\n      showEdit.value = false\n      getBooks()\n    }\n\n    const indexMethod = index => index + 1\n\n    return {\n      books,\n      loading,\n      showEdit,\n      editClose,\n      handleEdit,\n      editBookId,\n      indexMethod,\n      handleDelete,\n    }\n  },\n}\n</script>\n\n<!-- <script>\nimport GridCategory from '@/model/grid-category'\nimport GridCategoryEdit from './grid-category-edit'\n\nexport default {\n  components: {\n    GridCategoryEdit,\n  },\n  data() {\n    return {\n      display: true,\n      tableData: [],\n      imgSrcList: [], // 用于大图预览\n      dialogFormVisible: false, // 展示弹窗\n      isCreate: false,\n      gridCategoryId: 0,\n      form: {\n        name: '',\n        title: 0,\n        parent_id: null,\n        description: '',\n        online: 1,\n        index: null,\n      },\n    }\n  },\n  async created() {\n    this.loading = true\n    this.getGridCategories()\n    this.loading = false\n  },\n  methods: {\n    async getGridCategories() {\n      const gridCategories = await GridCategory.getGridCategories()\n      console.log(\"zzr123 = \",gridCategories)\n      this.tableData = gridCategories\n      this.initImgSrcList()\n    },\n    initImgSrcList() {\n      this.tableData.forEach(item => {\n        if (!item.img) {\n          return\n        }\n        this.imgSrcList.push(item.img)\n      })\n    },\n    // 获取所拥有的权限并渲染  由子组件提供\n    handleAdd() {\n      this.dialogFormVisible = true\n      this.isCreate = true\n    },\n    handleEdit(val) {\n      this.gridCategoryId = val.id\n      this.isCreate = false\n      this.dialogFormVisible = true\n    },\n    handleDelete(val) {\n      let res\n      this.$confirm('此操作将永久删除该六宫格，是否继续？', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        try {\n          this.loading = true\n          res = await GridCategory.deleteGridCategory(val.id)\n        } catch (e) {\n          this.loading = false\n        }\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.loading = false\n          if (this.totalNums % this.pageCount === 1 && this.currentPage !== 1) {\n            this.currentPage--\n          }\n          this.getSubCategories()\n          this.$message({\n            type: 'success',\n            message: `${res.message}`,\n          })\n        } else {\n          this.loading = false\n          this.$message.error(`${res.message}`)\n        }\n      })\n    },\n    dialogClose() {\n      this.dialogFormVisible = false\n      this.loading = true\n      this.getGridCategories()\n      this.loading = false\n    },\n  },\n}\n</script> -->\n\n<style lang=\"scss\" scoped>\n.container {\n  padding: 0 30px;\n\n  .header {\n    display: flex;\n    align-items: center;\n\n    .title {\n      height: 59px;\n      line-height: 59px;\n      color: $parent-title-color;\n      font-size: 16px;\n      font-weight: 500;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}