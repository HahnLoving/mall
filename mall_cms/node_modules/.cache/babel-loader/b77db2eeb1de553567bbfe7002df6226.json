{"ast":null,"code":"import _defineProperty from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _methods;\n\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport Banner from '@/model/banner';\nimport BannerItem from '@/model/banner-item';\nimport UploadImgs from '@/component/base/upload-image';\nimport BannerItemEdit from './banner-item-edit';\nimport GridCategory from '@/model/grid-category';\nimport Category from '@/model/category';\nexport default {\n  components: {\n    UploadImgs: UploadImgs,\n    BannerItemEdit: BannerItemEdit\n  },\n  props: {\n    bannerId: {\n      type: Number\n    }\n  },\n  data: function data() {\n    return {\n      loading: false,\n      form: {\n        name: '',\n        title: '',\n        description: ''\n      },\n      bannerItems: [],\n      imgSrcList: [],\n      mainMaxNum: 1,\n      initData: [],\n      isCreate: false,\n      showEdit: false,\n      editID: 0,\n      suggestions: []\n    };\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _this.loading = true;\n\n              _this.getDetail();\n\n              _this.loading = false;\n\n              _this.loadSuggestions();\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: (_methods = {\n    getValue: function getValue() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var val;\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return _this2.$refs.uploadEle.getValue();\n\n              case 2:\n                val = _context2.sent;\n\n                if (val && val.length > 0) {\n                  _this2.form.img = val[0].display;\n                }\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    getDetail: function getDetail() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return Banner.getBanner(_this3.bannerId);\n\n              case 2:\n                res = _context3.sent;\n                _this3.form = res;\n                _this3.initData = [{\n                  id: res.id,\n                  display: res.img\n                }];\n                _this3.bannerItems = res.items;\n\n                _this3.initImgSrcList();\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    initImgSrcList: function initImgSrcList() {\n      var _this4 = this;\n\n      this.bannerItems.forEach(function (item) {\n        if (!item.img) {\n          return;\n        }\n\n        _this4.imgSrcList.push(item.img);\n      });\n    },\n    submitForm: function submitForm() {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var form, res;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return _this5.getValue();\n\n              case 2:\n                form = _objectSpread({}, _this5.form);\n                _context4.next = 5;\n                return Banner.editBanner(_this5.bannerId, form);\n\n              case 5:\n                res = _context4.sent;\n\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this5.$message.success(\"\".concat(res.message));\n\n                  _this5.$emit('detailClose');\n                }\n\n              case 7:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    },\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    back: function back() {\n      this.$emit('detailClose');\n    },\n    addBannerItem: function addBannerItem() {\n      this.isCreate = true;\n      this.editID = 0;\n      this.showEdit = true;\n    },\n    editClose: function editClose() {\n      this.showEdit = false;\n      this.getDetail();\n    },\n    handleEdit: function handleEdit(row) {\n      this.isCreate = false;\n      this.editID = row.id;\n      this.showEdit = true;\n    },\n    handleDelete: function handleDelete(row) {\n      var _this6 = this;\n\n      this.$confirm('此操作将永久删除该项, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return BannerItem.deleteBannerItem(row.id);\n\n              case 2:\n                res = _context5.sent;\n\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this6.getDetail();\n\n                  _this6.$message({\n                    type: 'success',\n                    message: \"\".concat(res.message)\n                  });\n                }\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      })));\n    },\n    querySearch: function querySearch(queryString, cb) {\n      // eslint-disable-next-line\n      var suggestions = this.suggestions;\n      var results = queryString ? suggestions.filter(this.createFilter(queryString)) : suggestions;\n      cb(results);\n    },\n    createFilter: function createFilter(queryString) {\n      // eslint-disable-next-line\n      return function (suggestion) {\n        return suggestion.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0;\n      };\n    },\n    handleSelect: function handleSelect(item) {\n      this.state = item.name;\n      this.form.category_id = item.id;\n    }\n  }, _defineProperty(_methods, \"getValue\", function getValue() {\n    var _this7 = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {\n      var val;\n      return regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return _this7.$refs.uploadEle.getValue();\n\n            case 2:\n              val = _context6.sent;\n\n              if (val && val.length > 0) {\n                _this7.form.img = val[0].display;\n              }\n\n            case 4:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }))();\n  }), _defineProperty(_methods, \"loadSuggestions\", function loadSuggestions() {\n    var _this8 = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {\n      var inlineId, hit;\n      return regeneratorRuntime.wrap(function _callee7$(_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.prev = 0;\n              _context7.next = 3;\n              return Category.getList();\n\n            case 3:\n              _this8.suggestions = _context7.sent;\n\n              if (_this8.suggestions.length === 0) {\n                _this8.$message.error('未找到宫格建议，请先添加宫格');\n              }\n\n              _context7.next = 11;\n              break;\n\n            case 7:\n              _context7.prev = 7;\n              _context7.t0 = _context7[\"catch\"](0);\n\n              _this8.$message.error('获取宫格建议信息失败');\n\n              console.error(_context7.t0);\n\n            case 11:\n              inlineId = _this8.getInlineId(); // eslint-disable-next-line\n\n              hit = _this8.suggestions.filter(function (val) {\n                return val.id === inlineId;\n              });\n\n              if (hit.length > 0) {\n                _this8.state = hit[0].name;\n              }\n\n            case 14:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee7, null, [[0, 7]]);\n    }))();\n  }), _defineProperty(_methods, \"getInlineId\", function getInlineId() {\n    if (this.form.category_id) {\n      return this.form.category_id;\n    }\n\n    if (this.form.root_category_id) {\n      return this.form.root_category_id;\n    }\n\n    return null;\n  }), _methods)\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/banner/banner-with-items.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\" v-if=\"!showEdit\">\n    <div class=\"title\">\n      <span>修改Banner</span> <span class=\"back\" @click=\"back\"> <i class=\"iconfont icon-fanhui\"></i> 返回 </span>\n    </div>\n    <el-divider></el-divider>\n    <div class=\"wrap\">\n      <el-row>\n        <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n          <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" v-loading=\"loading\" @submit.native.prevent>\n            <el-form-item label=\"名称\" prop=\"name\">\n              <el-input size=\"medium\" v-model=\"form.name\" placeholder=\"请填写名称\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"标题\" prop=\"title\">\n              <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写标题\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"主图\" prop=\"img\">\n              <upload-imgs ref=\"uploadEle\" :value=\"initData\" :max-num=\"mainMaxNum\" />\n            </el-form-item>\n            <el-form-item label=\"描述\" prop=\"description\">\n              <el-input size=\"medium\" v-model=\"form.description\" type=\"textarea\" :rows=\"4\" placeholder=\"请填写描述\">\n              </el-input>\n            </el-form-item>\n            <el-form-item class=\"submit\">\n              <el-button\n                type=\"primary\"\n                v-permission=\"{ permission: '更新Banner', type: 'disabled' }\"\n                @click=\"submitForm('form')\"\n                >保 存</el-button\n              >\n              <el-button @click=\"resetForm('form')\">重 置</el-button>\n            </el-form-item>\n          </el-form>\n        </el-col>\n      </el-row>\n    </div>\n    <div>\n      <el-divider></el-divider>\n      <div class=\"header\">\n        <div class=\"title\">\n          <span>Banner-Item列表</span>\n          <el-button @click.prevent=\"addBannerItem\" class=\"add-btn\" type=\"primary\" plain>新增Banner-Item</el-button>\n        </div>\n      </div>\n      <el-row class=\"inner-container\">\n        <el-table stripe v-loading=\"loading\" :data=\"bannerItems\">\n          <el-table-column prop=\"id\" label=\"id\" width=\"100\"></el-table-column>\n          <el-table-column prop=\"img\" label=\"图片\" width=\"200\">\n            <template #default=\"scope\">\n              <el-image :src=\"scope.row.img\" :preview-src-list=\"imgSrcList\" style=\"max-height: 50px; max-width: 100px;\">\n              </el-image>\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"name\" label=\"名称\" width=\"150\"></el-table-column>\n          <el-table-column prop=\"keyword\" label=\"关键字\" min-width=\"200\"></el-table-column>\n          <!-- <el-table-column prop=\"type\" label=\"类型\" width=\"150\"></el-table-column> -->\n          <el-table-column  label=\"分类\" prop=\"type\">\n            <el-autocomplete\n              @focus=\"loadSuggestions\"\n              popper-class=\"my-autocomplete\"\n              class=\"inline-input\"\n              v-model=\"state\"\n              :fetch-suggestions=\"querySearch\"\n              placeholder=\"请填写所属分类\"\n              @select=\"handleSelect\"\n            >\n              <template #default=\"{ item }\">\n                <span class=\"id\">{{ item.id }}</span>\n                <span class=\"name\">{{ item.name }}</span>\n              </template>\n            </el-autocomplete>\n          </el-table-column >\n          <el-table-column fixed=\"right\" width=\"150\" label=\"操作\">\n            <template #default=\"scope\">\n              <el-button @click.prevent=\"handleEdit(scope.row)\" type=\"primary\" plain size=\"mini\">编辑</el-button>\n              <el-button\n                @click.prevent=\"handleDelete(scope.row)\"\n                type=\"danger\"\n                plain\n                size=\"mini\"\n                v-permission=\"{ permission: '删除Banner item', type: 'disabled' }\"\n                >删除</el-button\n              >\n            </template>\n          </el-table-column>\n        </el-table>\n      </el-row>\n    </div>\n  </div>\n  <banner-item-edit\n    v-else\n    @editClose=\"editClose\"\n    :bannerId=\"bannerId\"\n    :isCreate=\"isCreate\"\n    :editID=\"editID\"\n  ></banner-item-edit>\n</template>\n\n<script>\nimport Banner from '@/model/banner'\nimport BannerItem from '@/model/banner-item'\nimport UploadImgs from '@/component/base/upload-image'\nimport BannerItemEdit from './banner-item-edit'\nimport GridCategory from '@/model/grid-category'\nimport Category from '@/model/category'\n\nexport default {\n  components: {\n    UploadImgs,\n    BannerItemEdit,\n  },\n  props: {\n    bannerId: {\n      type: Number,\n    },\n  },\n  data() {\n    return {\n      loading: false,\n      form: {\n        name: '',\n        title: '',\n        description: '',\n      },\n      bannerItems: [],\n      imgSrcList: [],\n      mainMaxNum: 1,\n      initData: [],\n      isCreate: false,\n      showEdit: false,\n      editID: 0,\n      suggestions:[],\n    }\n  },\n  async mounted() {\n    this.loading = true\n    this.getDetail()\n    this.loading = false\n    this.loadSuggestions()\n  },\n  methods: {\n    async getValue() {\n      const val = await this.$refs.uploadEle.getValue()\n      if (val && val.length > 0) {\n        this.form.img = val[0].display\n      }\n    },\n    async getDetail() {\n      const res = await Banner.getBanner(this.bannerId)\n      this.form = res\n      this.initData = [{ id: res.id, display: res.img }]\n      this.bannerItems = res.items\n      this.initImgSrcList()\n    },\n    initImgSrcList() {\n      this.bannerItems.forEach(item => {\n        if (!item.img) {\n          return\n        }\n        this.imgSrcList.push(item.img)\n      })\n    },\n    async submitForm() {\n      await this.getValue()\n      const form = { ...this.form }\n      const res = await Banner.editBanner(this.bannerId, form)\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        this.$message.success(`${res.message}`)\n        this.$emit('detailClose')\n      }\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    back() {\n      this.$emit('detailClose')\n    },\n    addBannerItem() {\n      this.isCreate = true\n      this.editID = 0\n      this.showEdit = true\n    },\n    editClose() {\n      this.showEdit = false\n      this.getDetail()\n    },\n    handleEdit(row) {\n      this.isCreate = false\n      this.editID = row.id\n      this.showEdit = true\n    },\n    handleDelete(row) {\n      this.$confirm('此操作将永久删除该项, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        const res = await BannerItem.deleteBannerItem(row.id)\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.getDetail()\n          this.$message({\n            type: 'success',\n            message: `${res.message}`,\n          })\n        }\n      })\n    },\n        querySearch(queryString, cb) {\n      // eslint-disable-next-line\n      const suggestions = this.suggestions\n      const results = queryString ? suggestions.filter(this.createFilter(queryString)) : suggestions\n      cb(results)\n    },\n    createFilter(queryString) {\n      // eslint-disable-next-line\n      return suggestion => {\n        return suggestion.name.toLowerCase().indexOf(queryString.toLowerCase()) === 0\n      }\n    },\n    handleSelect(item) {\n      this.state = item.name\n      this.form.category_id = item.id\n    },\n    async getValue() {\n      const val = await this.$refs.uploadEle.getValue()\n      if (val && val.length > 0) {\n        this.form.img = val[0].display\n      }\n    },\n    async loadSuggestions() {\n      try {\n        this.suggestions = await Category.getList()\n        if (this.suggestions.length === 0) {\n          this.$message.error('未找到宫格建议，请先添加宫格')\n        }\n      } catch (error) {\n        this.$message.error('获取宫格建议信息失败')\n        console.error(error)\n      }\n      const inlineId = this.getInlineId()\n      // eslint-disable-next-line\n      const hit = this.suggestions.filter(val => {\n        return val.id === inlineId\n      })\n      if (hit.length > 0) {\n        this.state = hit[0].name\n      }\n    },\n    getInlineId() {\n      if (this.form.category_id) {\n        return this.form.category_id\n      }\n      if (this.form.root_category_id) {\n        return this.form.root_category_id\n      }\n      return null\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.el-divider--horizontal {\n  margin: 0;\n}\n\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n    .add-btn {\n      margin-left: 30px;\n    }\n\n    .back {\n      float: right;\n      margin-right: 40px;\n      cursor: pointer;\n    }\n  }\n\n  .wrap {\n    padding: 20px;\n  }\n\n  .submit {\n    float: left;\n  }\n\n  .inner-container {\n    margin-bottom: 50px;\n  }\n}\n.col {\n  display: flex;\n  justify-content: space-between;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}