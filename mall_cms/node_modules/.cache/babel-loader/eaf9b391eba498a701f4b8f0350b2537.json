{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, withModifiers as _withModifiers, resolveDirective as _resolveDirective } from \"vue\";\nimport _imports_0 from '@/assets/image/login/team-name.png';\nvar _hoisted_1 = {\n  class: \"login\"\n};\n\nvar _hoisted_2 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"team-name hidden-sm-and-down\"\n}, [/*#__PURE__*/_createElementVNode(\"img\", {\n  src: _imports_0,\n  alt: \"logo\"\n})], -1\n/* HOISTED */\n);\n\nvar _hoisted_3 = {\n  class: \"form-box\",\n  \"element-loading-background\": \"rgba(0, 0, 0, 0)\"\n};\n\nvar _hoisted_4 = /*#__PURE__*/_createElementVNode(\"div\", {\n  class: \"title\"\n}, [/*#__PURE__*/_createElementVNode(\"h1\", {\n  title: \"Lin\"\n}, \"吾家衣帽 CMS\")], -1\n/* HOISTED */\n);\n\nvar _hoisted_5 = {\n  class: \"form-item nickname\"\n};\n\nvar _hoisted_6 = /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"icon account-icon\"\n}, null, -1\n/* HOISTED */\n);\n\nvar _hoisted_7 = {\n  class: \"form-item password\"\n};\n\nvar _hoisted_8 = /*#__PURE__*/_createElementVNode(\"span\", {\n  class: \"icon secret-icon\"\n}, null, -1\n/* HOISTED */\n);\n\nvar _hoisted_9 = {\n  key: 0,\n  class: \"form-item password\"\n};\nvar _hoisted_10 = [\"src\"];\n\nvar _hoisted_11 = /*#__PURE__*/_createElementVNode(\"button\", {\n  class: \"submit-btn\",\n  type: \"submit\"\n}, \"登录\", -1\n/* HOISTED */\n);\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _directive_loading = _resolveDirective(\"loading\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_hoisted_2, _withDirectives(_createElementVNode(\"div\", _hoisted_3, [_hoisted_4, _createElementVNode(\"form\", {\n    class: \"login-form\",\n    autocomplete: \"off\",\n    onSubmit: _cache[3] || (_cache[3] = _withModifiers(function ($event) {\n      return $setup.throttleLogin();\n    }, [\"prevent\"]))\n  }, [_createElementVNode(\"div\", _hoisted_5, [_hoisted_6, _withDirectives(_createElementVNode(\"input\", {\n    type: \"text\",\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $setup.account.username = $event;\n    }),\n    autocomplete: \"off\",\n    placeholder: \"请填写用户名\"\n  }, null, 512\n  /* NEED_PATCH */\n  ), [[_vModelText, $setup.account.username]])]), _createElementVNode(\"div\", _hoisted_7, [_hoisted_8, _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n      return $setup.account.password = $event;\n    }),\n    autocomplete: \"off\",\n    placeholder: \"请填写用户登录密码\"\n  }, null, 512\n  /* NEED_PATCH */\n  ), [[_vModelText, $setup.account.password]])]), $setup.captchaImage ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_createElementVNode(\"img\", {\n    class: \"captcha\",\n    src: $setup.captchaImage\n  }, null, 8\n  /* PROPS */\n  , _hoisted_10), _withDirectives(_createElementVNode(\"input\", {\n    type: \"password\",\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.account.captcha = $event;\n    }),\n    autocomplete: \"off\",\n    placeholder: \"请填写验证码\"\n  }, null, 512\n  /* NEED_PATCH */\n  ), [[_vModelText, $setup.account.captcha]])])) : _createCommentVNode(\"v-if\", true), _hoisted_11], 32\n  /* HYDRATE_EVENTS */\n  )], 512\n  /* NEED_PATCH */\n  ), [[_directive_loading, $setup.loading]])]);\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/view/login/login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"login\">\n    <div class=\"team-name hidden-sm-and-down\"><img src=\"@/assets/image/login/team-name.png\" alt=\"logo\" /></div>\n    <div class=\"form-box\" v-loading=\"loading\" element-loading-background=\"rgba(0, 0, 0, 0)\">\n      <div class=\"title\"><h1 title=\"Lin\">吾家衣帽 CMS</h1></div>\n      <form class=\"login-form\" autocomplete=\"off\" @submit.prevent=\"throttleLogin()\">\n        <div class=\"form-item nickname\">\n          <span class=\"icon account-icon\"></span>\n          <input type=\"text\" v-model=\"account.username\" autocomplete=\"off\" placeholder=\"请填写用户名\" />\n        </div>\n        <div class=\"form-item password\">\n          <span class=\"icon secret-icon\"></span>\n          <input type=\"password\" v-model=\"account.password\" autocomplete=\"off\" placeholder=\"请填写用户登录密码\" />\n        </div>\n        <div class=\"form-item password\" v-if=\"captchaImage\">\n          <img class=\"captcha\" :src=\"captchaImage\" />\n          <input type=\"password\" v-model=\"account.captcha\" autocomplete=\"off\" placeholder=\"请填写验证码\" />\n        </div>\n        <button class=\"submit-btn\" type=\"submit\">登录</button>\n      </form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { reactive, ref, onMounted, getCurrentInstance } from 'vue'\nimport { useStore } from 'vuex'\nimport { useRouter } from 'vue-router'\nimport axios from 'lin/plugin/axios'\nimport UserModel from '@/lin/model/user'\nimport Utils from '@/lin/util/util'\nimport Config from '@/config'\n\nexport default {\n  setup() {\n    let tag = ''\n    const wait = 2000 // 2000ms之内不能重复发起请求\n    const loading = ref(false)\n    const captchaImage = ref('')\n    const store = useStore()\n    const router = useRouter()\n    const throttleLogin = ref(null)\n    const { ctx } = getCurrentInstance()\n\n    const account = reactive({\n      username: '',\n      password: '',\n      captcha: '',\n    })\n\n    /**\n     * 根据账号密码登录，拿到 token 并储存\n     */\n    const login = async () => {\n      const { username, password, captcha } = account\n      try {\n        loading.value = true\n        await UserModel.getToken(username, password, captcha, tag)\n        await getInformation()\n        loading.value = false\n        router.push(Config.defaultRoute)\n        ctx.$message({\n          message: '登录成功',\n          type: 'success',\n        })\n      } catch (e) {\n        loading.value = false\n      }\n    }\n\n    const getCaptcha = async () => {\n      // axios({\n      //   method: 'POST',\n      //   url: 'cms/user/captcha',\n      // }).then(result => {\n      //   ;({ tag } = result)\n      //   captchaImage.value = result.image\n      // })\n    }\n\n    /**\n     * 获取并更新当前管理员信息\n     */\n    const getInformation = async () => {\n      try {\n        // 尝试获取当前用户信息\n        const user = await UserModel.getPermissions()\n        store.dispatch('setUserAndState', user)\n        store.commit('SET_USER_PERMISSIONS', user.permissions)\n      } catch (e) {\n        console.error(e)\n      }\n    }\n\n    /**\n     * 节流登录\n     */\n    onMounted(() => {\n      getCaptcha()\n      throttleLogin.value = Utils.throttle(login, wait)\n    })\n\n    return {\n      account,\n      loading,\n      captchaImage,\n      throttleLogin,\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\">\n.login {\n  width: 100%;\n  height: 100%;\n  background-size: auto;\n  background: #1b2c5f url('../../assets/image/login/login-ba.png') no-repeat center center;\n\n  .team-name {\n    position: fixed;\n    left: 40px;\n    top: 50%;\n    width: 50px;\n    transform: translateY(-50%);\n  }\n\n  .form-box {\n    position: fixed;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n    width: 445px;\n\n    .title {\n      height: 37px;\n      font-size: 30px;\n      line-height: 37px;\n      margin-bottom: 15%;\n\n      h1 {\n        padding-left: 74px;\n        box-sizing: border-box;\n        text-align: left;\n        color: #8c98ae;\n      }\n    }\n\n    .login-form {\n      width: 100%;\n\n      .form-item {\n        position: relative;\n        width: 100%;\n        height: 40px;\n        box-sizing: border-box;\n        padding-bottom: 13px;\n        margin-bottom: 34px;\n\n        input {\n          width: 100%;\n          height: 100%;\n          background: transparent;\n          color: #c4c9d2;\n          font-size: 14px;\n          padding-left: 74px;\n          box-sizing: border-box;\n        }\n\n        .captcha {\n          position: absolute;\n          width: 80px;\n          right: 30px;\n          top: -22px;\n        }\n      }\n\n      .form-item.nickname {\n        background: url('../../assets/image/login/nickname.png') no-repeat;\n        background-size: 100% auto;\n        background-position: left bottom;\n      }\n\n      .form-item.password {\n        background: url('../../assets/image/login/password.png') no-repeat;\n        background-size: 100% auto;\n        background-position: left bottom;\n      }\n\n      .submit-btn {\n        width: 100%;\n        height: 70px;\n        color: #c4c9d2;\n        font-size: 16px;\n        text-align: left;\n        box-sizing: border-box;\n        padding: 0 10px;\n        padding-left: 74px;\n        background: url('../../assets/image/login/login-btn.png') no-repeat;\n        background-size: 90% auto;\n        background-position: center bottom;\n        border: none;\n        cursor: pointer;\n      }\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}