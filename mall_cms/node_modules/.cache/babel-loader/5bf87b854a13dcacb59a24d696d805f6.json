{"ast":null,"code":"import \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.string.split.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport store from '@/store';\nimport Config from '@/config';\nimport { getToken } from '@/lin/util/token';\nimport User from './user';\nimport ClearTab from './clear-tab';\nimport Breadcrumb from './breadcrumb';\nimport Screenfull from './screen-full';\nexport default {\n  name: 'NavBar',\n  data: function data() {\n    return {\n      value: 0,\n      hidden: false,\n      messages: [],\n      path: \"//api.s.colorful3.com/ws/message?token=\".concat(getToken('access_token').split(' ')[1])\n    };\n  },\n  created: function created() {\n    var _this = this;\n\n    if (Config.websocketEnable) {\n      this.$connect(this.path, {\n        format: 'json'\n      });\n\n      this.$options.sockets.onmessage = function (data) {\n        console.log(JSON.parse(data.data));\n\n        _this.messages.push(JSON.parse(data.data));\n      };\n\n      this.$options.sockets.onerror = function (err) {\n        console.error(err);\n\n        _this.$message.error('token已过期,请重新登录');\n\n        store.dispatch('loginOut');\n        var origin = window.location.origin;\n        window.location.href = origin;\n      };\n    }\n  },\n  watch: {\n    messages: {\n      handler: function handler() {\n        this.value = this.messages.filter(function (msg) {\n          return msg.is_read === false;\n        }).length;\n\n        if (this.value === 0) {\n          this.hidden = true;\n        } else {\n          this.hidden = false;\n        }\n      },\n      immediate: true\n    }\n  },\n  methods: {\n    readAll: function readAll() {\n      console.log('点击了readAll');\n    },\n    viewAll: function viewAll() {\n      console.log('点击了viewAll');\n    },\n    readMessages: function readMessages(msg, index) {\n      this.messages[index].is_read = true;\n    }\n  },\n  components: {\n    Breadcrumb: Breadcrumb,\n    User: User,\n    Screenfull: Screenfull,\n    ClearTab: ClearTab\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/component/layout/nav-bar.vue"],"names":[],"mappings":";;;;AAwBA,OAAO,KAAP,MAAkB,SAAlB;AACA,OAAO,MAAP,MAAmB,UAAnB;AACA,SAAS,QAAT,QAAyB,kBAAzB;AACA,OAAO,IAAP,MAAiB,QAAjB;AACA,OAAO,QAAP,MAAqB,aAArB;AACA,OAAO,UAAP,MAAuB,cAAvB;AACA,OAAO,UAAP,MAAuB,eAAvB;AAEA,eAAe;AACb,EAAA,IAAI,EAAE,QADO;AAEb,EAAA,IAFa,kBAEN;AACL,WAAO;AACL,MAAA,KAAK,EAAE,CADF;AAEL,MAAA,MAAM,EAAE,KAFH;AAGL,MAAA,QAAQ,EAAE,EAHL;AAIL,MAAA,IAAI,mDAA4C,QAAQ,CAAC,cAAD,CAAR,CAAyB,KAAzB,CAA+B,GAA/B,EAAoC,CAApC,CAA5C;AAJC,KAAP;AAMD,GATY;AAUb,EAAA,OAVa,qBAUH;AAAA;;AACR,QAAI,MAAM,CAAC,eAAX,EAA4B;AAC1B,WAAK,QAAL,CAAc,KAAK,IAAnB,EAAyB;AAAE,QAAA,MAAM,EAAE;AAAV,OAAzB;;AACA,WAAK,QAAL,CAAc,OAAd,CAAsB,SAAtB,GAAkC,UAAA,IAAG,EAAK;AACxC,QAAA,OAAO,CAAC,GAAR,CAAY,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,IAAhB,CAAZ;;AACA,QAAA,KAAI,CAAC,QAAL,CAAc,IAAd,CAAmB,IAAI,CAAC,KAAL,CAAW,IAAI,CAAC,IAAhB,CAAnB;AACF,OAHA;;AAIA,WAAK,QAAL,CAAc,OAAd,CAAsB,OAAtB,GAAgC,UAAA,GAAE,EAAK;AACrC,QAAA,OAAO,CAAC,KAAR,CAAc,GAAd;;AACA,QAAA,KAAI,CAAC,QAAL,CAAc,KAAd,CAAoB,gBAApB;;AACA,QAAA,KAAK,CAAC,QAAN,CAAe,UAAf;AACA,YAAQ,MAAR,GAAmB,MAAM,CAAC,QAA1B,CAAQ,MAAR;AACA,QAAA,MAAM,CAAC,QAAP,CAAgB,IAAhB,GAAuB,MAAvB;AACF,OANA;AAOF;AACD,GAzBY;AA0Bb,EAAA,KAAK,EAAE;AACL,IAAA,QAAQ,EAAE;AACR,MAAA,OADQ,qBACE;AACR,aAAK,KAAL,GAAa,KAAK,QAAL,CAAc,MAAd,CAAqB,UAAA,GAAE;AAAA,iBAAK,GAAG,CAAC,OAAJ,KAAgB,KAArB;AAAA,SAAvB,EAAmD,MAAhE;;AACA,YAAI,KAAK,KAAL,KAAe,CAAnB,EAAsB;AACpB,eAAK,MAAL,GAAc,IAAd;AACF,SAFA,MAEO;AACL,eAAK,MAAL,GAAc,KAAd;AACF;AACD,OARO;AASR,MAAA,SAAS,EAAE;AATH;AADL,GA1BM;AAuCb,EAAA,OAAO,EAAE;AACP,IAAA,OADO,qBACG;AACR,MAAA,OAAO,CAAC,GAAR,CAAY,YAAZ;AACD,KAHM;AAIP,IAAA,OAJO,qBAIG;AACR,MAAA,OAAO,CAAC,GAAR,CAAY,YAAZ;AACD,KANM;AAOP,IAAA,YAPO,wBAOM,GAPN,EAOW,KAPX,EAOkB;AACvB,WAAK,QAAL,CAAc,KAAd,EAAqB,OAArB,GAA+B,IAA/B;AACD;AATM,GAvCI;AAkDb,EAAA,UAAU,EAAE;AACV,IAAA,UAAU,EAAV,UADU;AAEV,IAAA,IAAI,EAAJ,IAFU;AAGV,IAAA,UAAU,EAAV,UAHU;AAIV,IAAA,QAAQ,EAAR;AAJU;AAlDC,CAAf","sourcesContent":["<template>\n  <div class=\"app-nav-bar\">\n    <div class=\"nav-content\">\n      <breadcrumb />\n      <div class=\"right-info\">\n        <lin-notify\n          height=\"370\"\n          :value=\"value\"\n          :hidden=\"hidden\"\n          :trigger=\"'click'\"\n          @readAll=\"readAll\"\n          @viewAll=\"viewAll\"\n          :messages=\"messages\"\n          @readMessages=\"readMessages\"\n        >\n        </lin-notify>\n        <clear-tab></clear-tab>\n        <screenfull /> <user></user>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport store from '@/store'\nimport Config from '@/config'\nimport { getToken } from '@/lin/util/token'\nimport User from './user'\nimport ClearTab from './clear-tab'\nimport Breadcrumb from './breadcrumb'\nimport Screenfull from './screen-full'\n\nexport default {\n  name: 'NavBar',\n  data() {\n    return {\n      value: 0,\n      hidden: false,\n      messages: [],\n      path: `//api.s.colorful3.com/ws/message?token=${getToken('access_token').split(' ')[1]}`,\n    }\n  },\n  created() {\n    if (Config.websocketEnable) {\n      this.$connect(this.path, { format: 'json' })\n      this.$options.sockets.onmessage = data => {\n        console.log(JSON.parse(data.data))\n        this.messages.push(JSON.parse(data.data))\n      }\n      this.$options.sockets.onerror = err => {\n        console.error(err)\n        this.$message.error('token已过期,请重新登录')\n        store.dispatch('loginOut')\n        const { origin } = window.location\n        window.location.href = origin\n      }\n    }\n  },\n  watch: {\n    messages: {\n      handler() {\n        this.value = this.messages.filter(msg => msg.is_read === false).length\n        if (this.value === 0) {\n          this.hidden = true\n        } else {\n          this.hidden = false\n        }\n      },\n      immediate: true,\n    },\n  },\n  methods: {\n    readAll() {\n      console.log('点击了readAll')\n    },\n    viewAll() {\n      console.log('点击了viewAll')\n    },\n    readMessages(msg, index) {\n      this.messages[index].is_read = true\n    },\n  },\n  components: {\n    Breadcrumb,\n    User,\n    Screenfull,\n    ClearTab,\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.app-nav-bar {\n  width: 100%;\n  height: $navbar-height;\n  display: flex;\n  align-items: center;\n  .logo.js-min-logo {\n    width: 64px;\n    font-size: 16px;\n    color: #fff;\n  }\n  .nav-content {\n    flex: 1;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding-left: 10px;\n    padding-right: $navbar-padding;\n    .right-info {\n      display: flex;\n      align-items: center;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}