{"ast":null,"code":"import _classCallCheck from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _defineProperty from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport { ElMessage } from 'element-plus'; // import EventSourcePolyfill from 'event-source-polyfill'\n\nimport 'event-source-polyfill/src/eventsource';\nimport { getToken } from './cookie';\nimport store from '../../store';\n\nvar Sse = /*#__PURE__*/function () {\n  /**\n   * 需在vuex中确认有user对象后才能初始化，否则不连接服务器\n   * 注意： sse单独走自己的请求路线，不与axios重合，所以axios里面的配置在此处失效\n   * @param {string} url sse全路径\n   * @param {Array} events 当前用户可监听的路径\n   */\n  function Sse(url, events) {\n    var _this = this;\n\n    _classCallCheck(this, Sse);\n\n    _defineProperty(this, \"source\", null);\n\n    /* eslint-disable no-undef */\n    console.log(url, events);\n    this.source = new EventSourcePolyfill(url, {\n      headers: {\n        Authorization: getToken('access_token')\n      }\n    });\n    this.open();\n    events.forEach(function (event) {\n      _this.addEventListener(event);\n    });\n  }\n\n  _createClass(Sse, [{\n    key: \"open\",\n    value: function open() {\n      this.source.onopen = function (event) {\n        console.log('sse opened', event);\n      };\n    }\n  }, {\n    key: \"error\",\n    value: function error() {\n      this.source.onerror = function (event) {\n        console.log('error', event);\n      };\n    }\n  }, {\n    key: \"addEventListener\",\n    value: function addEventListener(eventName) {\n      this.source.addEventListener(eventName, function (event) {\n        // console.log('receive one message: ', event.data)\n        // console.log('receive one message: ', event.lastEventId)\n        store.commit('MARK_UNREAD_MESSAGE', {\n          data: event.data,\n          id: event.lastEventId\n        });\n        ElMessage.warning(JSON.parse(event.data).message);\n      });\n    }\n  }]);\n\n  return Sse;\n}();\n\nexport { Sse as default };","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/lin/util/sse.js"],"names":["ElMessage","getToken","store","Sse","url","events","console","log","source","EventSourcePolyfill","headers","Authorization","open","forEach","event","addEventListener","onopen","onerror","eventName","commit","data","id","lastEventId","warning","JSON","parse","message"],"mappings":";;;;;AAAA,SAASA,SAAT,QAA0B,cAA1B,C,CAEA;;AACA,OAAO,uCAAP;AACA,SAASC,QAAT,QAAyB,UAAzB;AACA,OAAOC,KAAP,MAAkB,aAAlB;;IAEqBC,G;AAGnB;AACF;AACA;AACA;AACA;AACA;AACE,eAAYC,GAAZ,EAAiBC,MAAjB,EAAyB;AAAA;;AAAA;;AAAA,oCARhB,IAQgB;;AACvB;AACAC,IAAAA,OAAO,CAACC,GAAR,CAAYH,GAAZ,EAAiBC,MAAjB;AACA,SAAKG,MAAL,GAAc,IAAIC,mBAAJ,CAAwBL,GAAxB,EAA6B;AACzCM,MAAAA,OAAO,EAAE;AACPC,QAAAA,aAAa,EAAEV,QAAQ,CAAC,cAAD;AADhB;AADgC,KAA7B,CAAd;AAKA,SAAKW,IAAL;AAEAP,IAAAA,MAAM,CAACQ,OAAP,CAAe,UAAAC,KAAK,EAAI;AACtB,MAAA,KAAI,CAACC,gBAAL,CAAsBD,KAAtB;AACD,KAFD;AAGD;;;;WAED,gBAAO;AACL,WAAKN,MAAL,CAAYQ,MAAZ,GAAqB,UAAAF,KAAK,EAAI;AAC5BR,QAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BO,KAA1B;AACD,OAFD;AAGD;;;WAED,iBAAQ;AACN,WAAKN,MAAL,CAAYS,OAAZ,GAAsB,UAAAH,KAAK,EAAI;AAC7BR,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBO,KAArB;AACD,OAFD;AAGD;;;WAED,0BAAiBI,SAAjB,EAA4B;AAC1B,WAAKV,MAAL,CAAYO,gBAAZ,CAA6BG,SAA7B,EAAwC,UAAAJ,KAAK,EAAI;AAC/C;AACA;AACAZ,QAAAA,KAAK,CAACiB,MAAN,CAAa,qBAAb,EAAoC;AAAEC,UAAAA,IAAI,EAAEN,KAAK,CAACM,IAAd;AAAoBC,UAAAA,EAAE,EAAEP,KAAK,CAACQ;AAA9B,SAApC;AACAtB,QAAAA,SAAS,CAACuB,OAAV,CAAkBC,IAAI,CAACC,KAAL,CAAWX,KAAK,CAACM,IAAjB,EAAuBM,OAAzC;AACD,OALD;AAMD;;;;;;SA3CkBvB,G","sourcesContent":["import { ElMessage } from 'element-plus'\n\n// import EventSourcePolyfill from 'event-source-polyfill'\nimport 'event-source-polyfill/src/eventsource'\nimport { getToken } from './cookie'\nimport store from '../../store'\n\nexport default class Sse {\n  source = null\n\n  /**\n   * 需在vuex中确认有user对象后才能初始化，否则不连接服务器\n   * 注意： sse单独走自己的请求路线，不与axios重合，所以axios里面的配置在此处失效\n   * @param {string} url sse全路径\n   * @param {Array} events 当前用户可监听的路径\n   */\n  constructor(url, events) {\n    /* eslint-disable no-undef */\n    console.log(url, events)\n    this.source = new EventSourcePolyfill(url, {\n      headers: {\n        Authorization: getToken('access_token'),\n      },\n    })\n    this.open()\n\n    events.forEach(event => {\n      this.addEventListener(event)\n    })\n  }\n\n  open() {\n    this.source.onopen = event => {\n      console.log('sse opened', event)\n    }\n  }\n\n  error() {\n    this.source.onerror = event => {\n      console.log('error', event)\n    }\n  }\n\n  addEventListener(eventName) {\n    this.source.addEventListener(eventName, event => {\n      // console.log('receive one message: ', event.data)\n      // console.log('receive one message: ', event.lastEventId)\n      store.commit('MARK_UNREAD_MESSAGE', { data: event.data, id: event.lastEventId })\n      ElMessage.warning(JSON.parse(event.data).message)\n    })\n  }\n}\n"]},"metadata":{},"sourceType":"module"}