{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/mall/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/mall/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport User from 'lin/model/user';\nimport axios from 'lin/plugin/axios';\nimport { mapActions, mapGetters } from 'vuex';\nimport defaultAvatar from '@/assets/image/user/user.png';\nimport Avatar from './avatar.vue';\nexport default {\n  name: 'User',\n  components: {\n    Avatar: Avatar\n  },\n  data: function data() {\n    return {\n      cropImg: '',\n      defaultAvatar: defaultAvatar,\n      username: null,\n      nickname: null,\n      groupName: null,\n      cropVisible: false,\n      nicknameChanged: false,\n      dialogFormVisible: false\n    };\n  },\n  computed: _objectSpread({}, mapGetters(['user'])),\n  watch: {\n    cropVisible: function cropVisible(val) {\n      if (!val) {\n        this.cropImg = '';\n      }\n    }\n  },\n  created: function created() {\n    var user = this.$store.state.user;\n    this.nickname = user !== null && user !== void 0 && user.nickname ? user.nickname : '佚名';\n    this.username = user !== null && user !== void 0 && user.username ? user.username : '未登录';\n    this.groupName = user !== null && user !== void 0 && user.groupName ? user.groupName : '超级管理员';\n  },\n  methods: _objectSpread(_objectSpread({}, mapActions(['loginOut', 'setUserAndState'])), {}, {\n    fileChange: function fileChange(event) {\n      var _this = this;\n\n      if (event.target.files.length !== 1) {\n        return;\n      }\n\n      var imgFile = event.target.files[0]; // 验证文件大小是否符合要求, 不大于 5M\n\n      if (imgFile.size > 1024 * 1024 * 5) {\n        this.$message.error('文件过大超过5M'); // 清空输入框\n\n        this.clearFileInput(this.$refs.avatarInput);\n        return;\n      } // 验证图像是否符合要求\n\n\n      var imgSrc = window.URL.createObjectURL(imgFile);\n      var image = new Image();\n      image.src = imgSrc;\n\n      image.onload = function () {\n        var w = image.width;\n        var h = image.height;\n\n        if (w < 50) {\n          _this.$message.error('图像宽度过小, 请选择大于50px的图像'); // 清空输入框\n\n\n          _this.clearFileInput(_this.$refs.avatarInput);\n\n          return;\n        }\n\n        if (h < 50) {\n          _this.$message.error('图像高度过小, 请选择大于50px的图像'); // 清空输入框\n\n\n          _this.clearFileInput(_this.$refs.avatarInput);\n\n          return;\n        } // 验证通过, 打开裁剪框\n\n\n        _this.cropImg = imgSrc;\n        _this.cropVisible = true;\n      };\n\n      image.onerror = function () {\n        _this.$message.error('获取本地图片出现错误, 请重试'); // 清空输入框\n\n\n        _this.clearFileInput(_this.$refs.avatarInput);\n      };\n    },\n    switchCropVisible: function switchCropVisible(flag) {\n      this.cropVisible = flag;\n    },\n    changeNickname: function changeNickname() {\n      var _this2 = this;\n\n      this.nicknameChanged = true;\n      setTimeout(function () {\n        _this2.$refs.input.focus();\n      }, 200);\n    },\n    blur: function blur() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var user;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (_this3.nickname) {\n                  user = _this3.$store.state.user;\n\n                  if (_this3.nickname !== user.nickname && _this3.nickname !== '佚名') {\n                    axios({\n                      method: 'put',\n                      url: '/cms/user',\n                      data: {\n                        nickname: _this3.nickname\n                      },\n                      showBackend: true\n                    }).then(function (res) {\n                      if (res.code < window.MAX_SUCCESS_CODE) {\n                        _this3.$message({\n                          type: 'success',\n                          message: '更新昵称成功'\n                        }); // 触发重新获取用户信息\n\n\n                        return User.getInformation();\n                      }\n                    }).then(function (res) {\n                      _this3.setUserAndState(res);\n\n                      _this3.nickname = res.nickname;\n                    });\n                  }\n                }\n\n                _this3.nicknameChanged = false;\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    goToCenter: function goToCenter() {\n      this.$router.push('/center');\n    },\n    outLogin: function outLogin() {\n      this.loginOut();\n      window.location.reload();\n    },\n    clearFileInput: function clearFileInput(ele) {\n      ele.value = '';\n    }\n  })\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/component/layout/user.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"user\">\n    <el-dropdown>\n      <span class=\"el-dropdown-link\">\n        <div class=\"nav-avatar\"><img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" /></div>\n      </span>\n      <template v-slot:dropdown>\n        <el-dropdown-menu class=\"user-box\">\n          <div class=\"user-info\">\n            <div class=\"avatar\" title=\"点击修改头像\">\n              <img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" />\n              <label class=\"mask\">\n                <i class=\"iconfont icon-icon-test\" style=\"font-size: 20px;\"></i>\n                <input ref=\"avatarInput\" type=\"file\" accept=\"image/*\" @change=\"fileChange\" />\n              </label>\n            </div>\n            <div class=\"text\">\n              <div class=\"username\" @click=\"changeNickname\" v-if=\"!nicknameChanged\">{{ nickname }}</div>\n              <el-input\n                placeholder=\"请输入内容\"\n                size=\"small\"\n                v-else\n                v-model=\"nickname\"\n                ref=\"input\"\n                @blur=\"blur\"\n              ></el-input>\n              <div class=\"desc\" v-if=\"!nicknameChanged\">{{ groupName }}</div>\n            </div>\n            <img src=\"../../assets/image/user/corner.png\" class=\"corner\" />\n          </div>\n          <ul class=\"dropdown-box\">\n            <li class=\"password\" @click=\"goToCenter\">\n              <i class=\"iconfont icon-weibaoxitongshangchuanlogo-\"></i> <span>个人中心</span>\n            </li>\n            <li class=\"account\" @click=\"outLogin\"><i class=\"iconfont icon-tuichu\"></i> <span>退出账户</span></li>\n          </ul>\n        </el-dropdown-menu>\n      </template>\n    </el-dropdown>\n    <!-- 修改头像 -->\n    <avatar :originalImage=\"cropImg\" :cropVisible=\"cropVisible\" @switchCropVisible=\"switchCropVisible\"></avatar>\n  </div>\n</template>\n\n<script>\nimport User from 'lin/model/user'\nimport axios from 'lin/plugin/axios'\nimport { mapActions, mapGetters } from 'vuex'\nimport defaultAvatar from '@/assets/image/user/user.png'\nimport Avatar from './avatar.vue'\n\nexport default {\n  name: 'User',\n  components: { Avatar },\n  data() {\n    return {\n      cropImg: '',\n      defaultAvatar,\n      username: null,\n      nickname: null,\n      groupName: null,\n      cropVisible: false,\n      nicknameChanged: false,\n      dialogFormVisible: false,\n    }\n  },\n  computed: {\n    ...mapGetters(['user']),\n  },\n  watch: {\n    cropVisible(val) {\n      if (!val) {\n        this.cropImg = ''\n      }\n    },\n  },\n  created() {\n    const { user } = this.$store.state\n    this.nickname = user?.nickname ? user.nickname : '佚名'\n    this.username = user?.username ? user.username : '未登录'\n    this.groupName = user?.groupName ? user.groupName : '超级管理员'\n  },\n  methods: {\n    ...mapActions(['loginOut', 'setUserAndState']),\n    fileChange(event) {\n      if (event.target.files.length !== 1) {\n        return\n      }\n\n      const imgFile = event.target.files[0]\n      // 验证文件大小是否符合要求, 不大于 5M\n      if (imgFile.size > 1024 * 1024 * 5) {\n        this.$message.error('文件过大超过5M')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n        return\n      }\n\n      // 验证图像是否符合要求\n      const imgSrc = window.URL.createObjectURL(imgFile)\n      const image = new Image()\n      image.src = imgSrc\n      image.onload = () => {\n        const w = image.width\n        const h = image.height\n        if (w < 50) {\n          this.$message.error('图像宽度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        if (h < 50) {\n          this.$message.error('图像高度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        // 验证通过, 打开裁剪框\n        this.cropImg = imgSrc\n        this.cropVisible = true\n      }\n      image.onerror = () => {\n        this.$message.error('获取本地图片出现错误, 请重试')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n      }\n    },\n    switchCropVisible(flag) {\n      this.cropVisible = flag\n    },\n    changeNickname() {\n      this.nicknameChanged = true\n      setTimeout(() => {\n        this.$refs.input.focus()\n      }, 200)\n    },\n    async blur() {\n      if (this.nickname) {\n        const { user } = this.$store.state\n        if (this.nickname !== user.nickname && this.nickname !== '佚名') {\n          axios({\n            method: 'put',\n            url: '/cms/user',\n            data: {\n              nickname: this.nickname,\n            },\n            showBackend: true,\n          })\n            .then(res => {\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.$message({\n                  type: 'success',\n                  message: '更新昵称成功',\n                })\n                // 触发重新获取用户信息\n                return User.getInformation()\n              }\n            })\n            .then(res => {\n              this.setUserAndState(res)\n              this.nickname = res.nickname\n            })\n        }\n      }\n      this.nicknameChanged = false\n    },\n    goToCenter() {\n      this.$router.push('/center')\n    },\n    outLogin() {\n      this.loginOut()\n      window.location.reload()\n    },\n    clearFileInput(ele) {\n      ele.value = ''\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.user {\n  height: 40px;\n\n  .el-dropdown-link {\n    cursor: pointer;\n\n    .nav-avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      overflow: hidden;\n      margin-right: 10px;\n    }\n  }\n}\n\n.user-box {\n  width: 326px;\n  background-color: none;\n  background: transparent;\n  margin-bottom: 0;\n  padding-bottom: 0;\n  border: none;\n\n  .user-info {\n    background-image: url('../../assets/image/user/user-bg.png');\n    background-size: 100% 100%;\n    transform: translateY(-10px);\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    display: flex;\n    flex-direction: row;\n    padding: 35px 20px 25px 30px;\n    z-index: 100;\n    position: relative;\n\n    .corner {\n      position: absolute;\n      right: 18px;\n      top: -9px;\n      width: 27px;\n      height: 10px;\n    }\n\n    .avatar {\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      cursor: pointer;\n      overflow: hidden;\n      position: relative;\n\n      .mask {\n        opacity: 0;\n        transition: all 0.2s;\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        color: white;\n\n        input {\n          display: none;\n        }\n      }\n\n      &:hover {\n        .mask {\n          opacity: 1;\n        }\n      }\n    }\n\n    .text {\n      margin-left: 20px;\n      color: #fff;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n\n      .username {\n        margin-bottom: 10px;\n        font-size: 16px;\n        height: 32px;\n        line-height: 32px;\n        cursor: pointer;\n      }\n\n      .desc {\n        font-size: 14px;\n        color: rgba(222, 226, 230, 1);\n      }\n    }\n\n    .info {\n      position: absolute;\n      bottom: 10px;\n      right: 10px;\n      display: flex;\n      color: #fff;\n      font-size: 14px;\n      height: 20px;\n      line-height: 20px;\n\n      .mid {\n        padding: 0 5px;\n      }\n    }\n  }\n\n  .dropdown-box {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n    padding-left: 35px;\n    height: 122px;\n    color: #596c8e;\n    font-size: 14px;\n    background: white;\n    margin-top: -10px;\n\n    li {\n      cursor: pointer;\n\n      &:nth-child(1) {\n        margin-top: 20px;\n      }\n\n      &:nth-child(2) {\n        margin-bottom: 20px;\n      }\n\n      i {\n        margin-right: 10px;\n      }\n\n      &:hover {\n        color: $theme !important;\n\n        i {\n          color: $theme !important;\n        }\n      }\n    }\n  }\n}\n\n.popper__arrow {\n  display: none !important;\n}\n\n.avatar-croppa-container {\n  display: inline-block;\n  border-color: #3862bc;\n  border-style: dashed;\n  font-size: 0;\n  border-width: 2px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}