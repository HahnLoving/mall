{"ast":null,"code":"import _objectSpread from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport theme from '@/model/theme';\nimport UploadImgs from '@/component/base/upload-image';\nexport default {\n  components: {\n    UploadImgs: UploadImgs\n  },\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false\n    },\n    themeId: {\n      type: String,\n      default: null\n    }\n  },\n  data: function data() {\n    return {\n      form: {\n        title: '',\n        name: '',\n        tpl_name: '',\n        description: '',\n        online: 1,\n        title_img: null,\n        entrance_img: null,\n        internal_top_img: null\n      },\n      rules: {\n        minWidth: 10,\n        minHeight: 10,\n        maxSize: 5\n      },\n      initImgData: [],\n      initEntranceData: [],\n      initInternalData: [],\n      maxNum: 1,\n      tableData: [],\n      loading: false,\n      spuState: '',\n      spuId: null,\n      spuSuggestions: [],\n      onlined: true,\n      // tpl_options: ['diana', 'irelia', 'camille', 'janna', 'spu-list'],\n      tpl_options: ['type-1', 'type-2', 'type-3', 'type-4']\n    };\n  },\n  watch: {\n    onlined: function onlined(val) {\n      this.form.online = val ? 1 : 0;\n    }\n  },\n  mounted: function mounted() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n      var res, initImgData, initEntranceData, initInternalData;\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (_this.isCreate) {\n                _context.next = 13;\n                break;\n              }\n\n              _context.next = 3;\n              return theme.getTheme(_this.themeId);\n\n            case 3:\n              res = _context.sent;\n              _this.form = res;\n              initImgData = [{\n                id: res.id,\n                display: res.title_img\n              }];\n              _this.initImgData = initImgData;\n              initEntranceData = [{\n                id: res.id,\n                display: res.entrance_img\n              }];\n              _this.initEntranceData = initEntranceData;\n              initInternalData = [{\n                id: res.id,\n                display: res.internal_top_img\n              }];\n              _this.initInternalData = initInternalData;\n              _context.next = 13;\n              return _this.getSpus(res.id);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    // eslint-disable-next-line\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var postData, res;\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return _this2.getValue();\n\n              case 2:\n                _context3.prev = 2;\n                postData = _objectSpread({}, _this2.form);\n\n                if (!_this2.isCreate) {\n                  _context3.next = 10;\n                  break;\n                }\n\n                _context3.next = 7;\n                return theme.addTheme(postData);\n\n              case 7:\n                res = _context3.sent;\n                _context3.next = 13;\n                break;\n\n              case 10:\n                _context3.next = 12;\n                return theme.editTheme(_this2.themeId, postData);\n\n              case 12:\n                res = _context3.sent;\n\n              case 13:\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this2.$message.success(\"\".concat(res.message));\n\n                  _this2.$confirm('是否返回上一页', '提示', {\n                    confirmButtonText: '确定',\n                    cancelButtonText: '取消',\n                    type: 'warning'\n                  }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n                    return regeneratorRuntime.wrap(function _callee2$(_context2) {\n                      while (1) {\n                        switch (_context2.prev = _context2.next) {\n                          case 0:\n                            _this2.$emit('editClose');\n\n                          case 1:\n                          case \"end\":\n                            return _context2.stop();\n                        }\n                      }\n                    }, _callee2);\n                  })));\n                }\n\n                _context3.next = 19;\n                break;\n\n              case 16:\n                _context3.prev = 16;\n                _context3.t0 = _context3[\"catch\"](2);\n                console.error(_context3.t0);\n\n              case 19:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, null, [[2, 16]]);\n      }))();\n    },\n    addThemeSpu: function addThemeSpu() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        var info, res;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                info = {\n                  theme_id: _this3.form.id,\n                  spu_id: _this3.spuId\n                };\n                _context4.prev = 1;\n                _context4.next = 4;\n                return theme.addThemeSpu(info);\n\n              case 4:\n                res = _context4.sent;\n\n                if (res.code < window.MAX_SUCCESS_CODE) {\n                  _this3.$message.success(\"\".concat(res.message));\n\n                  _this3.getSpus(_this3.form.id);\n\n                  _this3.spuId = null;\n                  _this3.spuState = '';\n                }\n\n                _context4.next = 11;\n                break;\n\n              case 8:\n                _context4.prev = 8;\n                _context4.t0 = _context4[\"catch\"](1);\n                console.error(_context4.t0);\n\n              case 11:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, null, [[1, 8]]);\n      }))();\n    },\n    getSpus: function getSpus(id) {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee5() {\n        var spus;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return theme.getSpus(id);\n\n              case 2:\n                spus = _context5.sent;\n                _this4.tableData = spus;\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }))();\n    },\n    loadSpuSuggestions: function loadSpuSuggestions() {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee6() {\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(_this5.spuSuggestions.length > 0)) {\n                  _context6.next = 2;\n                  break;\n                }\n\n                return _context6.abrupt(\"return\");\n\n              case 2:\n                _context6.prev = 2;\n\n                if (_this5.isCreate) {\n                  _context6.next = 8;\n                  break;\n                }\n\n                _context6.next = 6;\n                return theme.getSpuList(_this5.form.id);\n\n              case 6:\n                _this5.spuSuggestions = _context6.sent;\n\n                if (_this5.spuSuggestions.length === 0) {\n                  _this5.$message.error('未找到SPU，请先添加SPU');\n                }\n\n              case 8:\n                _context6.next = 14;\n                break;\n\n              case 10:\n                _context6.prev = 10;\n                _context6.t0 = _context6[\"catch\"](2);\n\n                _this5.$message.error('获取SPU信息失败');\n\n                console.error(_context6.t0);\n\n              case 14:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, null, [[2, 10]]);\n      }))();\n    },\n    querySpuSearch: function querySpuSearch(queryString, cb) {\n      // eslint-disable-next-line\n      var suggestions = this.spuSuggestions;\n      var results = queryString ? suggestions.filter(this.createSpuFilter(queryString)) : suggestions;\n      cb(results);\n    },\n    createSpuFilter: function createSpuFilter(queryString) {\n      // eslint-disable-next-line\n      return function (suggestion) {\n        return suggestion.title.toLowerCase().indexOf(queryString.toLowerCase()) === 0;\n      };\n    },\n    handleSpuSelect: function handleSpuSelect(item) {\n      this.spuState = item.title;\n      this.spuId = item.id;\n    },\n    getValue: function getValue() {\n      var _this6 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee7() {\n        var val, val1, val2;\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return _this6.$refs.uploadImgEle.getValue();\n\n              case 2:\n                val = _context7.sent;\n\n                if (val && val.length > 0) {\n                  _this6.form.title_img = val[0].display;\n                }\n\n                _context7.next = 6;\n                return _this6.$refs.uploadEntranceEle.getValue();\n\n              case 6:\n                val1 = _context7.sent;\n\n                if (val1 && val1.length > 0) {\n                  _this6.form.entrance_img = val1[0].display;\n                }\n\n                _context7.next = 10;\n                return _this6.$refs.uploadInternalEle.getValue();\n\n              case 10:\n                val2 = _context7.sent;\n\n                if (val2 && val2.length > 0) {\n                  _this6.form.internal_top_img = val2[0].display;\n                }\n\n              case 12:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7);\n      }))();\n    },\n    handleDelete: function handleDelete(row) {\n      var _this7 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee8() {\n        var res;\n        return regeneratorRuntime.wrap(function _callee8$(_context8) {\n          while (1) {\n            switch (_context8.prev = _context8.next) {\n              case 0:\n                _context8.prev = 0;\n                _context8.next = 3;\n                return theme.deleteSpu(row.tid);\n\n              case 3:\n                res = _context8.sent;\n\n                if (!(res.code < window.MAX_SUCCESS_CODE)) {\n                  _context8.next = 8;\n                  break;\n                }\n\n                _this7.$message.success(\"\".concat(res.message));\n\n                _context8.next = 8;\n                return _this7.getSpus(_this7.form.id);\n\n              case 8:\n                _context8.next = 13;\n                break;\n\n              case 10:\n                _context8.prev = 10;\n                _context8.t0 = _context8[\"catch\"](0);\n                console.error(_context8.t0);\n\n              case 13:\n              case \"end\":\n                return _context8.stop();\n            }\n          }\n        }, _callee8, null, [[0, 10]]);\n      }))();\n    },\n    resetForm: function resetForm(formName) {\n      this.$refs[formName].resetFields();\n    },\n    back: function back() {\n      this.$emit('editClose');\n    }\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/theme/theme-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <sticky-top>\n      <div class=\"title\">\n        <span>{{ isCreate ? '创建主题' : '更新主题' }}</span>\n        <span class=\"back\" @click=\"back\"> <i class=\"iconfont icon-fanhui\"></i> 返回 </span>\n        <el-divider></el-divider>\n      </div>\n    </sticky-top>\n    <div class=\"container\">\n      <div class=\"wrap\">\n        <el-row>\n          <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n            <el-form :model=\"form\" status-icon ref=\"form\" label-width=\"100px\" @submit.native.prevent>\n              <el-form-item label=\"标题\" prop=\"title\">\n                <el-input size=\"medium\" v-model=\"form.title\" placeholder=\"请填写标题\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"名称\" prop=\"title\">\n                <el-input size=\"medium\" v-model=\"form.name\" placeholder=\"请填写名称\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"主题描述\" prop=\"description\">\n                <el-input size=\"medium\" v-model=\"form.description\" placeholder=\"请填写主题描述\"></el-input>\n              </el-form-item>\n\n              <el-form-item label=\"模板名\" prop=\"tpl_name\">\n                <el-select v-model=\"form.tpl_name\" placeholder=\"请选择模板名\">\n                  <el-option v-for=\"item in tpl_options\" :key=\"item\" :label=\"item\" :value=\"item\"></el-option>\n                </el-select>\n              </el-form-item>\n\n              <el-form-item label=\"是否上线\">\n                <el-switch\n                  size=\"medium\"\n                  v-model=\"onlined\"\n                  active-color=\"#13ce66\"\n                  inactive-color=\"#ff4949\"\n                  active-text=\"上线\"\n                  inactive-text=\"下线\"\n                ></el-switch>\n              </el-form-item>\n\n              <el-form-item label=\"标题图\" prop=\"title_img\">\n                <upload-imgs :rules=\"rules\" :max-num=\"maxNum\" ref=\"uploadImgEle\" :value=\"initImgData\" />\n              </el-form-item>\n\n              <el-form-item label=\"入口图\" prop=\"entrance_img\">\n                <upload-imgs :rules=\"rules\" :max-num=\"maxNum\" ref=\"uploadEntranceEle\" :value=\"initEntranceData\" />\n              </el-form-item>\n\n              <el-form-item label=\"外部图\" prop=\"entrance_img\">\n                <upload-imgs :rules=\"rules\" :max-num=\"maxNum\" ref=\"uploadInternalEle\" :value=\"initInternalData\" />\n              </el-form-item>\n\n              <el-form-item class=\"submit\">\n                <el-button\n                  v-permission=\"{ permission: ['创建主题', '更新主题'], type: 'disabled' }\"\n                  type=\"primary\"\n                  @click=\"submitForm('form')\"\n                  >保 存</el-button\n                >\n                <el-button @click=\"resetForm('form')\">重 置</el-button>\n              </el-form-item>\n            </el-form>\n          </el-col>\n        </el-row>\n      </div>\n\n      <div v-if=\"!isCreate\" class=\"title plus\">\n        <span>主题下的SPU</span>\n      </div>\n      <div v-if=\"!isCreate\" class=\"wrap\">\n        <el-row>\n          <el-table stripe v-loading=\"loading\" :data=\"tableData\">\n            <el-table-column prop=\"id\" fixed=\"left\" label=\"id\" width=\"100\"></el-table-column>\n            <el-table-column prop=\"img\" label=\"主图\" width=\"200\">\n              <template #default=\"scope\">\n                <img class=\"display_img\" :src=\"scope.row.img\" :alt=\"scope.row.img\" />\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"title\" label=\"标题\" width=\"150\"></el-table-column>\n            <el-table-column prop=\"subtitle\" label=\"副标题\" min-width=\"300\"></el-table-column>\n            <el-table-column fixed=\"right\" width=\"150\" label=\"操作\">\n              <template #default=\"scope\">\n                <el-button\n                  v-permission=\"{ permission: ['删除主题下的spu'], type: 'disabled' }\"\n                  @click.prevent=\"handleDelete(scope.row)\"\n                  type=\"danger\"\n                  size=\"mini\"\n                  plain\n                  >删除</el-button\n                >\n              </template>\n            </el-table-column>\n          </el-table>\n\n          <div class=\"complete\">\n            <el-autocomplete\n              @focus=\"loadSpuSuggestions\"\n              popper-class=\"my-autocomplete\"\n              class=\"inline-input\"\n              v-model=\"spuState\"\n              :fetch-suggestions=\"querySpuSearch\"\n              placeholder=\"添加SPU\"\n              @select=\"handleSpuSelect\"\n            >\n              <template #default=\"scope\">\n                <span class=\"id\">{{ item.id }}</span>\n                <span class=\"name\">{{ item.title }}</span>\n              </template>\n            </el-autocomplete>\n            <el-button\n              v-permission=\"{ permission: ['添加主题下的spu'], type: 'disabled' }\"\n              class=\"add\"\n              @click.prevent=\"addThemeSpu\"\n              type=\"primary\"\n              plain\n              size=\"medium\"\n              >添加</el-button\n            >\n          </div>\n        </el-row>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport theme from '@/model/theme'\nimport UploadImgs from '@/component/base/upload-image'\n\nexport default {\n  components: {\n    UploadImgs,\n  },\n  props: {\n    isCreate: {\n      type: Boolean,\n      default: false,\n    },\n    themeId: {\n      type: String,\n      default: null,\n    },\n  },\n  data() {\n    return {\n      form: {\n        title: '',\n        name: '',\n        tpl_name: '',\n        description: '',\n        online: 1,\n        title_img: null,\n        entrance_img: null,\n        internal_top_img: null,\n      },\n      rules: {\n        minWidth: 10,\n        minHeight: 10,\n        maxSize: 5,\n      },\n      initImgData: [],\n      initEntranceData: [],\n      initInternalData: [],\n      maxNum: 1,\n      tableData: [],\n      loading: false,\n      spuState: '',\n      spuId: null,\n      spuSuggestions: [],\n      onlined: true,\n      // tpl_options: ['diana', 'irelia', 'camille', 'janna', 'spu-list'],\n      tpl_options: ['type-1', 'type-2', 'type-3', 'type-4'],\n    }\n  },\n  watch: {\n    onlined(val) {\n      this.form.online = val ? 1 : 0\n    },\n  },\n  async mounted() {\n    if (!this.isCreate) {\n      const res = await theme.getTheme(this.themeId)\n      this.form = res\n      const initImgData = [\n        {\n          id: res.id,\n          display: res.title_img,\n        },\n      ]\n      this.initImgData = initImgData\n      const initEntranceData = [\n        {\n          id: res.id,\n          display: res.entrance_img,\n        },\n      ]\n      this.initEntranceData = initEntranceData\n      const initInternalData = [\n        {\n          id: res.id,\n          display: res.internal_top_img,\n        },\n      ]\n      this.initInternalData = initInternalData\n      await this.getSpus(res.id)\n    }\n  },\n  methods: {\n    // eslint-disable-next-line\n    async submitForm(formName) {\n      await this.getValue()\n      try {\n        const postData = { ...this.form }\n        let res\n        if (this.isCreate) {\n          res = await theme.addTheme(postData)\n        } else {\n          res = await theme.editTheme(this.themeId, postData)\n        }\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.$message.success(`${res.message}`)\n          this.$confirm('是否返回上一页', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning',\n          }).then(async () => {\n            this.$emit('editClose')\n          })\n        }\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async addThemeSpu() {\n      const info = { theme_id: this.form.id, spu_id: this.spuId }\n      try {\n        const res = await theme.addThemeSpu(info)\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.$message.success(`${res.message}`)\n          this.getSpus(this.form.id)\n          this.spuId = null\n          this.spuState = ''\n        }\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    async getSpus(id) {\n      const spus = await theme.getSpus(id)\n      this.tableData = spus\n    },\n    async loadSpuSuggestions() {\n      if (this.spuSuggestions.length > 0) {\n        return\n      }\n      try {\n        if (!this.isCreate) {\n          this.spuSuggestions = await theme.getSpuList(this.form.id)\n          if (this.spuSuggestions.length === 0) {\n            this.$message.error('未找到SPU，请先添加SPU')\n          }\n        }\n      } catch (error) {\n        this.$message.error('获取SPU信息失败')\n        console.error(error)\n      }\n    },\n    querySpuSearch(queryString, cb) {\n      // eslint-disable-next-line\n      const suggestions = this.spuSuggestions\n      const results = queryString ? suggestions.filter(this.createSpuFilter(queryString)) : suggestions\n      cb(results)\n    },\n    createSpuFilter(queryString) {\n      // eslint-disable-next-line\n      return suggestion => {\n        return suggestion.title.toLowerCase().indexOf(queryString.toLowerCase()) === 0\n      }\n    },\n    handleSpuSelect(item) {\n      this.spuState = item.title\n      this.spuId = item.id\n    },\n    async getValue() {\n      const val = await this.$refs.uploadImgEle.getValue()\n      if (val && val.length > 0) {\n        this.form.title_img = val[0].display\n      }\n      const val1 = await this.$refs.uploadEntranceEle.getValue()\n      if (val1 && val1.length > 0) {\n        this.form.entrance_img = val1[0].display\n      }\n      const val2 = await this.$refs.uploadInternalEle.getValue()\n      if (val2 && val2.length > 0) {\n        this.form.internal_top_img = val2[0].display\n      }\n    },\n    async handleDelete(row) {\n      try {\n        const res = await theme.deleteSpu(row.tid)\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          this.$message.success(`${res.message}`)\n          await this.getSpus(this.form.id)\n        }\n      } catch (error) {\n        console.error(error)\n      }\n    },\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    back() {\n      this.$emit('editClose')\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.el-divider--horizontal {\n  margin: 0;\n}\n\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n\n    .back {\n      float: right;\n      margin-right: 40px;\n      cursor: pointer;\n    }\n  }\n\n  .wrap {\n    padding: 20px;\n  }\n\n  .submit {\n    float: left;\n  }\n}\n\n.display_img {\n  max-width: 100px;\n  max-height: 50px;\n  width: auto;\n  height: auto;\n}\n\n.plus {\n  display: flex;\n  justify-content: space-between;\n}\n\n.complete {\n  margin-top: 20px;\n  display: flex;\n  .add {\n    margin-left: 10px;\n  }\n}\n\n.my-autocomplete {\n  li {\n    line-height: normal;\n    padding: 7px;\n    display: inline-flex;\n    align-content: space-around;\n    .name {\n      text-overflow: ellipsis;\n      overflow: hidden;\n    }\n    .id {\n      margin-right: 15px;\n      font-size: 12px;\n      color: #b4b4b4;\n    }\n\n    .highlighted .addr {\n      color: #ddd;\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}