{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/mall/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.array.sort.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport { ref } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport AdminModel from '@/lin/model/admin';\nimport GroupPermissions from './group-permission';\nexport default {\n  components: {\n    GroupPermissions: GroupPermissions\n  },\n  setup: function setup() {\n    var route = useRoute();\n    var router = useRouter(); // originally data properties\n\n    var permissions = ref([]);\n    var allPermissions = ref([]);\n    var cachePermissions = ref([]);\n    /**\n     * 编辑后的最终权限\n     */\n\n    var updatePermissions = function updatePermissions(picked) {\n      permissions.value = picked;\n    };\n    /**\n     * 全部权限\n     */\n\n\n    var updateAllPermissions = function updateAllPermissions(all) {\n      allPermissions.value = all;\n    };\n    /**\n     * 页面打开时候，记录当前分组所拥有的全部权限\n     */\n\n\n    var getCacheAuthIds = function getCacheAuthIds(ids) {\n      cachePermissions.value = ids;\n    };\n    /**\n     * 确认修改\n     */\n\n\n    var confirmEdit = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var addRes, delRes, groupId, deletePermissions, addPermissions;\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                addRes = 0;\n                delRes = 0;\n                groupId = parseInt(route.query.id, 10); // 判断是否更改了分组权限\n\n                if (!(permissions.value.sort().toString() !== cachePermissions.value.sort().toString())) {\n                  _context.next = 15;\n                  break;\n                }\n\n                deletePermissions = cachePermissions.value.concat(permissions.value).filter(function (v) {\n                  return !permissions.value.includes(v);\n                });\n                addPermissions = cachePermissions.value.concat(permissions.value).filter(function (v) {\n                  return !cachePermissions.value.includes(v);\n                });\n\n                if (!(addPermissions.length > 0)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                _context.next = 9;\n                return AdminModel.dispatchPermissions(groupId, addPermissions);\n\n              case 9:\n                addRes = _context.sent;\n\n              case 10:\n                if (!(deletePermissions.length > 0)) {\n                  _context.next = 14;\n                  break;\n                }\n\n                _context.next = 13;\n                return AdminModel.removePermissions(groupId, deletePermissions);\n\n              case 13:\n                delRes = _context.sent;\n\n              case 14:\n                if (addRes.code < window.MAX_SUCCESS_CODE || delRes.code < window.MAX_SUCCESS_CODE) {\n                  ElMessage.success('权限修改成功');\n                }\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function confirmEdit() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    /**\n     * 返回\n     */\n\n\n    var back = function back() {\n      router.go(-1);\n    };\n\n    return {\n      back: back,\n      permissions: permissions,\n      confirmEdit: confirmEdit,\n      allPermissions: allPermissions,\n      getCacheAuthIds: getCacheAuthIds,\n      cachePermissions: cachePermissions,\n      updatePermissions: updatePermissions,\n      updateAllPermissions: updateAllPermissions\n    };\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/view/admin/group/group-edit.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"title\">编辑分组权限</div>\n    <div class=\"content\">\n      <el-row>\n        <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n          <div class=\"content\">\n            <group-permissions\n              :id=\"$route.query.id\"\n              ref=\"groupPermissions\"\n              @updatePermissions=\"updatePermissions\"\n              @getCacheAuthIds=\"getCacheAuthIds\"\n              @updateAllPermissions=\"updateAllPermissions\"\n              style=\"margin-right:-30px;margin-left:-25px;margin-bottom:-10px;\"\n            >\n            </group-permissions>\n          </div>\n          <div style=\"padding-left:5px;margin-top: 30px;\">\n            <el-button type=\"primary\" @click=\"confirmEdit\">确 定</el-button>\n            <el-button @click=\"back\">返回</el-button>\n          </div>\n        </el-col>\n      </el-row>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport { ElMessage } from 'element-plus'\nimport AdminModel from '@/lin/model/admin'\nimport GroupPermissions from './group-permission'\n\nexport default {\n  components: {\n    GroupPermissions,\n  },\n  setup() {\n    const route = useRoute()\n    const router = useRouter()\n    // originally data properties\n    const permissions = ref([])\n    const allPermissions = ref([])\n    const cachePermissions = ref([])\n\n    /**\n     * 编辑后的最终权限\n     */\n    const updatePermissions = picked => {\n      permissions.value = picked\n    }\n\n    /**\n     * 全部权限\n     */\n    const updateAllPermissions = all => {\n      allPermissions.value = all\n    }\n\n    /**\n     * 页面打开时候，记录当前分组所拥有的全部权限\n     */\n    const getCacheAuthIds = ids => {\n      cachePermissions.value = ids\n    }\n\n    /**\n     * 确认修改\n     */\n    const confirmEdit = async () => {\n      let addRes = 0\n      let delRes = 0\n      const groupId = parseInt(route.query.id, 10)\n      // 判断是否更改了分组权限\n      if (permissions.value.sort().toString() !== cachePermissions.value.sort().toString()) {\n        const deletePermissions = cachePermissions.value\n          .concat(permissions.value)\n          .filter(v => !permissions.value.includes(v))\n        const addPermissions = cachePermissions.value\n          .concat(permissions.value)\n          .filter(v => !cachePermissions.value.includes(v))\n\n        if (addPermissions.length > 0) {\n          addRes = await AdminModel.dispatchPermissions(groupId, addPermissions)\n        }\n        if (deletePermissions.length > 0) {\n          delRes = await AdminModel.removePermissions(groupId, deletePermissions)\n        }\n        if (addRes.code < window.MAX_SUCCESS_CODE || delRes.code < window.MAX_SUCCESS_CODE) {\n          ElMessage.success('权限修改成功')\n        }\n      }\n    }\n\n    /**\n     * 返回\n     */\n    const back = () => {\n      router.go(-1)\n    }\n\n    return {\n      back,\n      permissions,\n      confirmEdit,\n      allPermissions,\n      getCacheAuthIds,\n      cachePermissions,\n      updatePermissions,\n      updateAllPermissions,\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n    border-bottom: 1px solid #dae1ec;\n  }\n\n  .content {\n    margin-top: 10px;\n    padding-left: 33px;\n    padding-right: 40px;\n  }\n\n  .submit {\n    float: left;\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}