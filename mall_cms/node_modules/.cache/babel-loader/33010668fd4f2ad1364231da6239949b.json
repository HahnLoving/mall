{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, withModifiers as _withModifiers, resolveComponent as _resolveComponent, withCtx as _withCtx, createVNode as _createVNode, createBlock as _createBlock, vShow as _vShow, normalizeStyle as _normalizeStyle, withDirectives as _withDirectives, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-1852d99c\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  key: 0,\n  ref: \"resueTab\",\n  class: \"reuse-tab\"\n};\nvar _hoisted_2 = [\"src\"];\nvar _hoisted_3 = {\n  style: {\n    \"padding\": \"0 5px\"\n  }\n};\nvar _hoisted_4 = [\"onClick\"];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_router_link = _resolveComponent(\"router-link\");\n\n  var _component_swiper_slide = _resolveComponent(\"swiper-slide\");\n\n  var _component_swiper = _resolveComponent(\"swiper\");\n\n  return $data.histories.length > 1 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_swiper, {\n    class: \"reuse-tab-wrap\",\n    \"slides-per-view\": \"auto\",\n    \"space-between\": 1,\n    \"initial-slide\": 0,\n    effect: \"slide\",\n    \"prevent-clicks\": false,\n    \"free-mode\": true,\n    mousewheel: true,\n    direction: \"horizontal\"\n  }, {\n    default: _withCtx(function () {\n      return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($data.histories, function (item, index) {\n        return _openBlock(), _createBlock(_component_swiper_slide, {\n          key: item.path\n        }, {\n          default: _withCtx(function () {\n            return [_createVNode(_component_router_link, {\n              class: _normalizeClass([\"reuse-tab-item\", item.path === _ctx.$route.path ? 'active' : '']),\n              to: item.path,\n              onContextmenu: _withModifiers(function ($event) {\n                return $options.onTags(index, $event);\n              }, [\"prevent\"])\n            }, {\n              default: _withCtx(function () {\n                return [!$options.filterIcon(_ctx.stageList[item.stageId].icon) ? (_openBlock(), _createElementBlock(\"i\", {\n                  key: 0,\n                  class: _normalizeClass(_ctx.stageList[item.stageId].icon)\n                }, null, 2)) : (_openBlock(), _createElementBlock(\"img\", {\n                  key: 1,\n                  src: _ctx.stageList[item.stageId].icon,\n                  style: {\n                    \"width\": \"16px\"\n                  }\n                }, null, 8, _hoisted_2)), _createElementVNode(\"span\", _hoisted_3, _toDisplayString(_ctx.stageList[item.stageId].title), 1), _createElementVNode(\"span\", {\n                  class: \"el-icon-close\",\n                  onClick: _withModifiers(function ($event) {\n                    return $options.close(index);\n                  }, [\"prevent\", \"stop\"])\n                }, null, 8, _hoisted_4)];\n              }),\n              _: 2\n            }, 1032, [\"class\", \"to\", \"onContextmenu\"])];\n          }),\n          _: 2\n        }, 1024);\n      }), 128))];\n    }),\n    _: 1\n  }), _withDirectives(_createElementVNode(\"ul\", {\n    style: _normalizeStyle({\n      left: $data.left + 'px',\n      top: $data.top + 'px'\n    }),\n    class: \"contextmenu\"\n  }, [_createElementVNode(\"li\", {\n    onClick: _cache[0] || (_cache[0] = function () {\n      return $options.closeAll && $options.closeAll.apply($options, arguments);\n    })\n  }, \"关闭所有\"), _createElementVNode(\"li\", {\n    onClick: _cache[1] || (_cache[1] = function () {\n      return $options.closeOthers && $options.closeOthers.apply($options, arguments);\n    })\n  }, \"关闭其他\"), $data.hasLeft ? (_openBlock(), _createElementBlock(\"li\", {\n    key: 0,\n    onClick: _cache[2] || (_cache[2] = function () {\n      return $options.closeLeft && $options.closeLeft.apply($options, arguments);\n    })\n  }, \"关闭左侧\")) : _createCommentVNode(\"\", true), $data.hasRight ? (_openBlock(), _createElementBlock(\"li\", {\n    key: 1,\n    onClick: _cache[3] || (_cache[3] = function () {\n      return $options.closeRight && $options.closeRight.apply($options, arguments);\n    })\n  }, \"关闭右侧\")) : _createCommentVNode(\"\", true)], 4), [[_vShow, $data.visible]])], 512)) : _createCommentVNode(\"\", true);\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/component/layout/reuse-tab.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div v-if=\"histories.length > 1\" ref=\"resueTab\" class=\"reuse-tab\">\n    <swiper\n      class=\"reuse-tab-wrap\"\n      slides-per-view=\"auto\"\n      :space-between=\"1\"\n      :initial-slide=\"0\"\n      effect=\"slide\"\n      :prevent-clicks=\"false\"\n      :free-mode=\"true\"\n      :mousewheel=\"true\"\n      direction=\"horizontal\"\n    >\n      <swiper-slide v-for=\"(item, index) in histories\" :key=\"item.path\">\n        <router-link\n          class=\"reuse-tab-item\"\n          :class=\"item.path === $route.path ? 'active' : ''\"\n          :to=\"item.path\"\n          @contextmenu.prevent=\"onTags(index, $event)\"\n        >\n          <i v-if=\"!filterIcon(stageList[item.stageId].icon)\" :class=\"stageList[item.stageId].icon\"></i>\n          <img v-else :src=\"stageList[item.stageId].icon\" style=\"width:16px;\" />\n          <span style=\"padding: 0 5px;\">{{ stageList[item.stageId].title }}</span>\n          <span class=\"el-icon-close\" @click.prevent.stop=\"close(index)\" />\n        </router-link>\n      </swiper-slide>\n    </swiper>\n\n    <ul v-show=\"visible\" :style=\"{ left: left + 'px', top: top + 'px' }\" class=\"contextmenu\">\n      <li @click=\"closeAll\">关闭所有</li>\n      <li @click=\"closeOthers\">关闭其他</li>\n      <li @click=\"closeLeft\" v-if=\"hasLeft\">关闭左侧</li>\n      <li @click=\"closeRight\" v-if=\"hasRight\">关闭右侧</li>\n    </ul>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\nimport emitter from 'lin/util/emitter'\nimport { Swiper, SwiperSlide } from 'swiper/vue'\nimport SwiperCore, { Mousewheel } from 'swiper'\n\nimport 'swiper/swiper.scss'\n\nSwiperCore.use([Mousewheel])\n\nexport default {\n  components: { Swiper, SwiperSlide },\n  data() {\n    return {\n      histories: [],\n      visible: false,\n      hasLeft: true,\n      hasRight: true,\n      top: 0,\n      left: 0,\n      index: 0,\n    }\n  },\n  watch: {\n    $route(to) {\n      // 对路由变化作出响应...\n      const { histories } = this\n      const flag = histories.find(item => item.path === to.path)\n      if (flag) {\n        return\n      }\n\n      const ele = {}\n      ele.stageId = to.name\n      ele.path = to.path\n      ele.routePath = to.matched[to.matched.length - 1].path\n      this.histories = [ele, ...histories]\n    },\n    loggedIn(val) {\n      if (val) {\n        return\n      }\n      this.closeAll()\n    },\n    visible(value) {\n      if (value) {\n        document.body.addEventListener('click', this.closeMenu)\n      } else {\n        document.body.removeEventListener('click', this.closeMenu)\n      }\n    },\n    // 舞台改变时触发\n    stageList() {\n      this.init()\n    },\n    histories(arr) {\n      if (arr.length < 2) {\n        emitter.emit('noReuse')\n      } else {\n        emitter.emit('hasReuse')\n      }\n    },\n  },\n  created() {\n    // 关闭窗口时执行\n    window.onbeforeunload = () => {\n      // 缓存历史记录\n      window.localStorage.setItem('history', JSON.stringify(this.histories))\n    }\n  },\n  computed: {\n    loggedIn() {\n      return this.$store.state.loggedIn\n    },\n    defaultRoute() {\n      return this.$store.state.defaultRoute\n    },\n    ...mapGetters(['getStageByRoute', 'getStageByName', 'stageList']),\n  },\n  mounted() {\n    this.init()\n    emitter.on('clearTap', () => {\n      this.histories = []\n    })\n  },\n  methods: {\n    init() {\n      const histories = []\n\n      // 获取当前的历史记录, 可能从本地存储, 可能直接获取当前的\n      let localHistory\n      if (this.histories.length > 0) {\n        localHistory = [...this.histories]\n      } else {\n        localHistory = window.localStorage.getItem('history') || '[]'\n        localHistory = JSON.parse(localHistory)\n      }\n\n      localHistory.forEach(item => {\n        let findResult\n        if (item.name) {\n          findResult = this.getStageByName(item.name)\n        } else {\n          findResult = this.getStageByRoute(item.routePath)\n        }\n        if (!findResult) {\n          return\n        }\n\n        histories.push({ ...item, stageId: findResult.name })\n        this.histories = histories\n      })\n    },\n    filterIcon(icon) {\n      if (!icon) {\n        return false\n      }\n      return icon.indexOf('/') !== -1\n    },\n    closeAll() {\n      this.histories = []\n      this.$router.push(this.defaultRoute)\n    },\n    closeOthers() {\n      this.$router.push(this.histories[this.index].path)\n      this.histories = []\n    },\n    closeLeft() {\n      this.histories.splice(0, this.index)\n    },\n    closeRight() {\n      this.histories.splice(this.index + 1, this.histories.length - this.index - 1)\n    },\n    onTags(index, event) {\n      this.closeMenu()\n      const menuMinWidth = 126\n      const offsetLeft = this.$el.getBoundingClientRect().left\n      const { offsetWidth } = this.$el\n      const maxLeft = offsetWidth - menuMinWidth\n      const left = event.clientX - offsetLeft + 15\n\n      if (left > maxLeft) {\n        this.left = maxLeft\n      } else {\n        this.left = left\n      }\n\n      if (index === 0) {\n        this.hasLeft = false\n      }\n\n      if (index + 1 === this.histories.length) {\n        this.hasRight = false\n      }\n\n      this.top = 18\n      this.index = index\n      this.visible = true\n    },\n    closeMenu() {\n      this.visible = false\n      this.hasLeft = true\n      this.hasRight = true\n    },\n    close(index) {\n      // 检测是否是当前页, 如果是当前页则自动切换路由\n      if (this.$route.path === this.histories[index].path) {\n        if (index > 0) {\n          this.$router.push(this.histories[index - 1].path)\n        } else if (this.histories.length > 1) {\n          this.$router.push(this.histories[1].path)\n        } else {\n          this.$router.push(this.defaultRoute)\n        }\n      }\n      // 删除该历史记录\n      this.histories.splice(index, 1)\n      this.histories = [...this.histories]\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.swiper-slide {\n  width: auto !important;\n  min-width: 126px;\n  display: flex;\n  height: $reuse-tab-height;\n  flex-direction: column;\n  justify-content: center;\n  background-color: $reuse-tab-item-background;\n  color: $right-side-font-color;\n  margin-right: 1px;\n}\n\n.reuse-tab-wrap {\n  bottom: 0;\n  left: 0;\n  user-select: none;\n  height: $reuse-tab-height;\n  background: $header-background;\n  font-size: 14px;\n  color: #8c98ae;\n  display: flex;\n  align-items: center;\n  overflow: hidden;\n\n  .reuse-tab-item {\n    box-sizing: border-box;\n    width: auto;\n    height: $reuse-tab-height;\n    min-width: 126px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 0 1em;\n    margin-right: 1px;\n    position: relative;\n    white-space: nowrap;\n\n    > i {\n      color: $theme;\n    }\n\n    .el-icon-close {\n      opacity: 0;\n      position: absolute;\n    }\n\n    &:hover {\n      background: $theme;\n      border: none;\n      color: #fff;\n\n      > i {\n        color: #fff;\n      }\n\n      .el-icon-close {\n        position: absolute;\n        display: inline-block;\n        width: 14px;\n        height: 14px;\n        top: 0;\n        right: 0;\n        opacity: 1;\n        border-radius: 0 0 0 14px;\n        background: rgba(255, 255, 255, 0.3);\n\n        &::before {\n          font-size: 12px;\n          position: absolute;\n          right: -1px;\n          transform: scale(0.7);\n        }\n      }\n    }\n  }\n\n  .active {\n    box-sizing: border-box;\n    height: 40px;\n    color: #ffffff;\n    background: $theme;\n    border: none;\n    position: relative;\n\n    > i {\n      color: #fff;\n    }\n\n    .el-icon-close {\n      position: absolute;\n      display: inline-block;\n      width: 14px;\n      height: 14px;\n      top: 0;\n      right: 0;\n      opacity: 1;\n      border-radius: 0 0 0 14px;\n      background: rgba(255, 255, 255, 0.3);\n\n      &::before {\n        font-size: 12px;\n        position: absolute;\n        right: -1px;\n        transform: scale(0.7);\n      }\n    }\n  }\n\n  .reuse-tab-wrap {\n    height: 100%;\n  }\n}\n.reuse-tab {\n  position: relative;\n  .contextmenu {\n    margin: 0;\n    background: #ffffff;\n    z-index: 3000;\n    position: absolute;\n    list-style-type: none;\n    padding: 5px 0;\n    border-radius: 4px;\n    font-size: 14px;\n    font-weight: 400;\n    color: #596c8e;\n    box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, 0.3);\n    li {\n      margin: 0;\n      padding: 10px 20px;\n      cursor: pointer;\n      &:hover {\n        background: #ebeff8;\n        color: #6182c9;\n      }\n    }\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}