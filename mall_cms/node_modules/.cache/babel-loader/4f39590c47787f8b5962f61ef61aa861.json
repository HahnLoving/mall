{"ast":null,"code":"import { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createBlock as _createBlock, createTextVNode as _createTextVNode, withCtx as _withCtx, createVNode as _createVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '../../assets/image/user/corner.png';\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-61e20970\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  class: \"user\"\n};\nvar _hoisted_2 = {\n  class: \"el-dropdown-link\"\n};\nvar _hoisted_3 = {\n  class: \"nav-avatar\"\n};\nvar _hoisted_4 = [\"src\"];\nvar _hoisted_5 = {\n  class: \"user-info\"\n};\nvar _hoisted_6 = {\n  class: \"avatar\",\n  title: \"点击修改头像\"\n};\nvar _hoisted_7 = [\"src\"];\nvar _hoisted_8 = {\n  class: \"mask\"\n};\n\nvar _hoisted_9 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"i\", {\n    class: \"iconfont icon-icon-test\",\n    style: {\n      \"font-size\": \"20px\"\n    }\n  }, null, -1);\n});\n\nvar _hoisted_10 = {\n  class: \"text\"\n};\nvar _hoisted_11 = {\n  key: 2,\n  class: \"desc\"\n};\n\nvar _hoisted_12 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"img\", {\n    src: _imports_0,\n    class: \"corner\"\n  }, null, -1);\n});\n\nvar _hoisted_13 = {\n  class: \"dropdown-box\"\n};\n\nvar _hoisted_14 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"i\", {\n    class: \"iconfont icon-weibaoxitongshangchuanlogo-\"\n  }, null, -1);\n});\n\nvar _hoisted_15 = /*#__PURE__*/_createTextVNode();\n\nvar _hoisted_16 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"span\", null, \"个人中心\", -1);\n});\n\nvar _hoisted_17 = [_hoisted_14, _hoisted_15, _hoisted_16];\n\nvar _hoisted_18 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"i\", {\n    class: \"iconfont icon-tuichu\"\n  }, null, -1);\n});\n\nvar _hoisted_19 = /*#__PURE__*/_createTextVNode();\n\nvar _hoisted_20 = /*#__PURE__*/_withScopeId(function () {\n  return /*#__PURE__*/_createElementVNode(\"span\", null, \"退出账户\", -1);\n});\n\nvar _hoisted_21 = [_hoisted_18, _hoisted_19, _hoisted_20];\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_input = _resolveComponent(\"el-input\");\n\n  var _component_el_dropdown_menu = _resolveComponent(\"el-dropdown-menu\");\n\n  var _component_el_dropdown = _resolveComponent(\"el-dropdown\");\n\n  var _component_avatar = _resolveComponent(\"avatar\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_dropdown, null, {\n    dropdown: _withCtx(function () {\n      return [_createVNode(_component_el_dropdown_menu, {\n        class: \"user-box\"\n      }, {\n        default: _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"img\", {\n            src: _ctx.user.avatar || $data.defaultAvatar,\n            alt: \"头像\"\n          }, null, 8, _hoisted_7), _createElementVNode(\"label\", _hoisted_8, [_hoisted_9, _createElementVNode(\"input\", {\n            ref: \"avatarInput\",\n            type: \"file\",\n            accept: \"image/*\",\n            onChange: _cache[0] || (_cache[0] = function () {\n              return $options.fileChange && $options.fileChange.apply($options, arguments);\n            })\n          }, null, 544)])]), _createElementVNode(\"div\", _hoisted_10, [!$data.nicknameChanged ? (_openBlock(), _createElementBlock(\"div\", {\n            key: 0,\n            class: \"username\",\n            onClick: _cache[1] || (_cache[1] = function () {\n              return $options.changeNickname && $options.changeNickname.apply($options, arguments);\n            })\n          }, _toDisplayString($data.nickname), 1)) : (_openBlock(), _createBlock(_component_el_input, {\n            key: 1,\n            placeholder: \"请输入内容\",\n            size: \"small\",\n            modelValue: $data.nickname,\n            \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n              return $data.nickname = $event;\n            }),\n            ref: \"input\",\n            onBlur: $options.blur\n          }, null, 8, [\"modelValue\", \"onBlur\"])), !$data.nicknameChanged ? (_openBlock(), _createElementBlock(\"div\", _hoisted_11, _toDisplayString($data.groupName), 1)) : _createCommentVNode(\"\", true)]), _hoisted_12]), _createElementVNode(\"ul\", _hoisted_13, [_createElementVNode(\"li\", {\n            class: \"password\",\n            onClick: _cache[3] || (_cache[3] = function () {\n              return $options.goToCenter && $options.goToCenter.apply($options, arguments);\n            })\n          }, _hoisted_17), _createElementVNode(\"li\", {\n            class: \"account\",\n            onClick: _cache[4] || (_cache[4] = function () {\n              return $options.outLogin && $options.outLogin.apply($options, arguments);\n            })\n          }, _hoisted_21)])];\n        }),\n        _: 1\n      })];\n    }),\n    default: _withCtx(function () {\n      return [_createElementVNode(\"span\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_createElementVNode(\"img\", {\n        src: _ctx.user.avatar || $data.defaultAvatar,\n        alt: \"头像\"\n      }, null, 8, _hoisted_4)])])];\n    }),\n    _: 1\n  }), _createVNode(_component_avatar, {\n    originalImage: $data.cropImg,\n    cropVisible: $data.cropVisible,\n    onSwitchCropVisible: $options.switchCropVisible\n  }, null, 8, [\"originalImage\", \"cropVisible\", \"onSwitchCropVisible\"])]);\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/component/layout/user.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"user\">\n    <el-dropdown>\n      <span class=\"el-dropdown-link\">\n        <div class=\"nav-avatar\"><img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" /></div>\n      </span>\n      <template v-slot:dropdown>\n        <el-dropdown-menu class=\"user-box\">\n          <div class=\"user-info\">\n            <div class=\"avatar\" title=\"点击修改头像\">\n              <img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" />\n              <label class=\"mask\">\n                <i class=\"iconfont icon-icon-test\" style=\"font-size: 20px;\"></i>\n                <input ref=\"avatarInput\" type=\"file\" accept=\"image/*\" @change=\"fileChange\" />\n              </label>\n            </div>\n            <div class=\"text\">\n              <div class=\"username\" @click=\"changeNickname\" v-if=\"!nicknameChanged\">{{ nickname }}</div>\n              <el-input\n                placeholder=\"请输入内容\"\n                size=\"small\"\n                v-else\n                v-model=\"nickname\"\n                ref=\"input\"\n                @blur=\"blur\"\n              ></el-input>\n              <div class=\"desc\" v-if=\"!nicknameChanged\">{{ groupName }}</div>\n            </div>\n            <img src=\"../../assets/image/user/corner.png\" class=\"corner\" />\n          </div>\n          <ul class=\"dropdown-box\">\n            <li class=\"password\" @click=\"goToCenter\">\n              <i class=\"iconfont icon-weibaoxitongshangchuanlogo-\"></i> <span>个人中心</span>\n            </li>\n            <li class=\"account\" @click=\"outLogin\"><i class=\"iconfont icon-tuichu\"></i> <span>退出账户</span></li>\n          </ul>\n        </el-dropdown-menu>\n      </template>\n    </el-dropdown>\n    <!-- 修改头像 -->\n    <avatar :originalImage=\"cropImg\" :cropVisible=\"cropVisible\" @switchCropVisible=\"switchCropVisible\"></avatar>\n  </div>\n</template>\n\n<script>\nimport User from 'lin/model/user'\nimport axios from 'lin/plugin/axios'\nimport { mapActions, mapGetters } from 'vuex'\nimport defaultAvatar from '@/assets/image/user/user.png'\nimport Avatar from './avatar.vue'\n\nexport default {\n  name: 'User',\n  components: { Avatar },\n  data() {\n    return {\n      cropImg: '',\n      defaultAvatar,\n      username: null,\n      nickname: null,\n      groupName: null,\n      cropVisible: false,\n      nicknameChanged: false,\n      dialogFormVisible: false,\n    }\n  },\n  computed: {\n    ...mapGetters(['user']),\n  },\n  watch: {\n    cropVisible(val) {\n      if (!val) {\n        this.cropImg = ''\n      }\n    },\n  },\n  created() {\n    const { user } = this.$store.state\n    this.nickname = user?.nickname ? user.nickname : '佚名'\n    this.username = user?.username ? user.username : '未登录'\n    this.groupName = user?.groupName ? user.groupName : '超级管理员'\n  },\n  methods: {\n    ...mapActions(['loginOut', 'setUserAndState']),\n    fileChange(event) {\n      if (event.target.files.length !== 1) {\n        return\n      }\n\n      const imgFile = event.target.files[0]\n      // 验证文件大小是否符合要求, 不大于 5M\n      if (imgFile.size > 1024 * 1024 * 5) {\n        this.$message.error('文件过大超过5M')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n        return\n      }\n\n      // 验证图像是否符合要求\n      const imgSrc = window.URL.createObjectURL(imgFile)\n      const image = new Image()\n      image.src = imgSrc\n      image.onload = () => {\n        const w = image.width\n        const h = image.height\n        if (w < 50) {\n          this.$message.error('图像宽度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        if (h < 50) {\n          this.$message.error('图像高度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        // 验证通过, 打开裁剪框\n        this.cropImg = imgSrc\n        this.cropVisible = true\n      }\n      image.onerror = () => {\n        this.$message.error('获取本地图片出现错误, 请重试')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n      }\n    },\n    switchCropVisible(flag) {\n      this.cropVisible = flag\n    },\n    changeNickname() {\n      this.nicknameChanged = true\n      setTimeout(() => {\n        this.$refs.input.focus()\n      }, 200)\n    },\n    async blur() {\n      if (this.nickname) {\n        const { user } = this.$store.state\n        if (this.nickname !== user.nickname && this.nickname !== '佚名') {\n          axios({\n            method: 'put',\n            url: '/cms/user',\n            data: {\n              nickname: this.nickname,\n            },\n            showBackend: true,\n          })\n            .then(res => {\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.$message({\n                  type: 'success',\n                  message: '更新昵称成功',\n                })\n                // 触发重新获取用户信息\n                return User.getInformation()\n              }\n            })\n            .then(res => {\n              this.setUserAndState(res)\n              this.nickname = res.nickname\n            })\n        }\n      }\n      this.nicknameChanged = false\n    },\n    goToCenter() {\n      this.$router.push('/center')\n    },\n    outLogin() {\n      this.loginOut()\n      window.location.reload()\n    },\n    clearFileInput(ele) {\n      ele.value = ''\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.user {\n  height: 40px;\n\n  .el-dropdown-link {\n    cursor: pointer;\n\n    .nav-avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      overflow: hidden;\n      margin-right: 10px;\n    }\n  }\n}\n\n.user-box {\n  width: 326px;\n  background-color: none;\n  background: transparent;\n  margin-bottom: 0;\n  padding-bottom: 0;\n  border: none;\n\n  .user-info {\n    background-image: url('../../assets/image/user/user-bg.png');\n    background-size: 100% 100%;\n    transform: translateY(-10px);\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    display: flex;\n    flex-direction: row;\n    padding: 35px 20px 25px 30px;\n    z-index: 100;\n    position: relative;\n\n    .corner {\n      position: absolute;\n      right: 18px;\n      top: -9px;\n      width: 27px;\n      height: 10px;\n    }\n\n    .avatar {\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      cursor: pointer;\n      overflow: hidden;\n      position: relative;\n\n      .mask {\n        opacity: 0;\n        transition: all 0.2s;\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        color: white;\n\n        input {\n          display: none;\n        }\n      }\n\n      &:hover {\n        .mask {\n          opacity: 1;\n        }\n      }\n    }\n\n    .text {\n      margin-left: 20px;\n      color: #fff;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n\n      .username {\n        margin-bottom: 10px;\n        font-size: 16px;\n        height: 32px;\n        line-height: 32px;\n        cursor: pointer;\n      }\n\n      .desc {\n        font-size: 14px;\n        color: rgba(222, 226, 230, 1);\n      }\n    }\n\n    .info {\n      position: absolute;\n      bottom: 10px;\n      right: 10px;\n      display: flex;\n      color: #fff;\n      font-size: 14px;\n      height: 20px;\n      line-height: 20px;\n\n      .mid {\n        padding: 0 5px;\n      }\n    }\n  }\n\n  .dropdown-box {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n    padding-left: 35px;\n    height: 122px;\n    color: #596c8e;\n    font-size: 14px;\n    background: white;\n    margin-top: -10px;\n\n    li {\n      cursor: pointer;\n\n      &:nth-child(1) {\n        margin-top: 20px;\n      }\n\n      &:nth-child(2) {\n        margin-bottom: 20px;\n      }\n\n      i {\n        margin-right: 10px;\n      }\n\n      &:hover {\n        color: $theme !important;\n\n        i {\n          color: $theme !important;\n        }\n      }\n    }\n  }\n}\n\n.popper__arrow {\n  display: none !important;\n}\n\n.avatar-croppa-container {\n  display: inline-block;\n  border-color: #3862bc;\n  border-style: dashed;\n  font-size: 0;\n  border-width: 2px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}