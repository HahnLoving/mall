{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, withCtx as _withCtx, createTextVNode as _createTextVNode, vShow as _vShow, withDirectives as _withDirectives, resolveDirective as _resolveDirective, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\n\nvar _withScopeId = function _withScopeId(n) {\n  return _pushScopeId(\"data-v-16140bac\"), n = n(), _popScopeId(), n;\n};\n\nvar _hoisted_1 = {\n  class: \"container\"\n};\n\nvar _hoisted_2 = /*#__PURE__*/_createTextVNode(\"保存\");\n\nvar _hoisted_3 = /*#__PURE__*/_createTextVNode(\"取消\");\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_input = _resolveComponent(\"el-input\");\n\n  var _component_el_form_item = _resolveComponent(\"el-form-item\");\n\n  var _component_el_button = _resolveComponent(\"el-button\");\n\n  var _component_el_form = _resolveComponent(\"el-form\");\n\n  var _directive_loading = _resolveDirective(\"loading\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_withDirectives(_createVNode(_component_el_form, {\n    ref: \"form\",\n    model: $setup.info,\n    \"status-icon\": \"\",\n    rules: $setup.rules,\n    \"label-width\": \"100px\",\n    \"label-position\": \"right\"\n  }, {\n    default: _withCtx(function () {\n      return [_createVNode(_component_el_form_item, {\n        label: \"密码\",\n        prop: \"newPassword\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            clearable: \"\",\n            type: \"password\",\n            modelValue: $setup.info.newPassword,\n            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n              return $setup.info.newPassword = $event;\n            }),\n            autocomplete: \"off\"\n          }, null, 8, [\"modelValue\"])];\n        }),\n        _: 1\n      }), _createVNode(_component_el_form_item, {\n        label: \"确认密码\",\n        prop: \"confirmPassword\",\n        \"label-position\": \"top\"\n      }, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_input, {\n            clearable: \"\",\n            type: \"password\",\n            modelValue: $setup.info.confirmPassword,\n            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n              return $setup.info.confirmPassword = $event;\n            }),\n            autocomplete: \"off\"\n          }, null, 8, [\"modelValue\"])];\n        }),\n        _: 1\n      }), _withDirectives(_createVNode(_component_el_form_item, null, {\n        default: _withCtx(function () {\n          return [_createVNode(_component_el_button, {\n            type: \"primary\",\n            onClick: $setup.submitForm\n          }, {\n            default: _withCtx(function () {\n              return [_hoisted_2];\n            }),\n            _: 1\n          }, 8, [\"onClick\"]), _createVNode(_component_el_button, {\n            onClick: $setup.resetForm\n          }, {\n            default: _withCtx(function () {\n              return [_hoisted_3];\n            }),\n            _: 1\n          }, 8, [\"onClick\"])];\n        }),\n        _: 1\n      }, 512), [[_vShow, false]])];\n    }),\n    _: 1\n  }, 8, [\"model\", \"rules\"]), [[_directive_loading, $setup.loading]])]);\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/src/view/admin/user/user-password.vue"],"names":[],"mappings":";;;;;;;AACO,EAAA,KAAK,EAAC;;;+CAiByC,I;;+CAChB,I;;;;;;;;;;;;;uBAlBpC,mBAAA,CAqBM,KArBN,EAAA,UAAA,EAqBM,C,gBApBJ,YAAA,CAmBU,kBAnBV,EAmBU;AAlBR,IAAA,GAAG,EAAC,MAkBI;AAjBP,IAAA,KAAK,EAAE,MAAA,CAAA,IAiBA;AAhBR,mBAAA,EAgBQ;AAfP,IAAA,KAAK,EAAE,MAAA,CAAA,KAeA;AAbR,mBAAY,OAaJ;AAZR,sBAAe;AAYP,GAnBV,E;sBASE;AAAA,aAEe,CAFf,YAAA,CAEe,uBAFf,EAEe;AAFD,QAAA,KAAK,EAAC,IAEL;AAFU,QAAA,IAAI,EAAC;AAEf,OAFf,E;0BACE;AAAA,iBAA6F,CAA7F,YAAA,CAA6F,mBAA7F,EAA6F;AAAnF,YAAA,SAAS,EAAT,EAAmF;AAAzE,YAAA,IAAI,EAAC,UAAoE;wBAAhD,MAAA,CAAA,IAAA,CAAK,WAA2C;;qBAAhD,MAAA,CAAA,IAAA,CAAK,W,GAAW,M;cAAgC;AAA9B,YAAA,YAAY,EAAC;AAAiB,WAA7F,E,IAAA,E,CAAA,E,cAAA,CAA6F,CAA7F;AAAA,S;;OADF,CAEe,EACf,YAAA,CAEe,uBAFf,EAEe;AAFD,QAAA,KAAK,EAAC,MAEL;AAFY,QAAA,IAAI,EAAC,iBAEjB;AAFmC,0BAAe;AAElD,OAFf,E;0BACE;AAAA,iBAAiG,CAAjG,YAAA,CAAiG,mBAAjG,EAAiG;AAAvF,YAAA,SAAS,EAAT,EAAuF;AAA7E,YAAA,IAAI,EAAC,UAAwE;wBAApD,MAAA,CAAA,IAAA,CAAK,eAA+C;;qBAApD,MAAA,CAAA,IAAA,CAAK,e,GAAe,M;cAAgC;AAA9B,YAAA,YAAY,EAAC;AAAiB,WAAjG,E,IAAA,E,CAAA,E,cAAA,CAAiG,CAAjG;AAAA,S;;OADF,CADe,E,gBAIf,YAAA,CAGe,uBAHf,EAGe,IAHf,EAGe;0BAFb;AAAA,iBAA4D,CAA5D,YAAA,CAA4D,oBAA5D,EAA4D;AAAjD,YAAA,IAAI,EAAC,SAA4C;AAAjC,YAAA,OAAK,EAAE,MAAA,CAAA;AAA0B,WAA5D,E;8BAA8C;AAAA,qBAAE,C,UAAA,CAAF;AAAA,a;;WAA9C,E,CAAA,E,WAAA,CAA4D,EAC5D,YAAA,CAA4C,oBAA5C,EAA4C;AAAhC,YAAA,OAAK,EAAE,MAAA,CAAA;AAAyB,WAA5C,EAA4B;8BAAE;AAAA,qBAAE,C,UAAA,CAAF;AAAA,a,CAAF;;AAAA,WAA5B,E,CAAA,E,WAAA,CAD4D,CAA5D;AAAA,S,CAEa;;AAAA,OAHf,E,GAAA,C,YAAsB,K,GAJP,CAFf;AAAA,K;;GATF,E,CAAA,E,kBAAA,C,wBAKa,MAAA,CAAA,O,GAeT,CArBN,C","sourcesContent":["<template>\n  <div class=\"container\">\n    <el-form\n      ref=\"form\"\n      :model=\"info\"\n      status-icon\n      :rules=\"rules\"\n      v-loading=\"loading\"\n      label-width=\"100px\"\n      label-position=\"right\"\n    >\n      <el-form-item label=\"密码\" prop=\"newPassword\">\n        <el-input clearable type=\"password\" v-model=\"info.newPassword\" autocomplete=\"off\"></el-input>\n      </el-form-item>\n      <el-form-item label=\"确认密码\" prop=\"confirmPassword\" label-position=\"top\">\n        <el-input clearable type=\"password\" v-model=\"info.confirmPassword\" autocomplete=\"off\"></el-input>\n      </el-form-item>\n      <el-form-item v-show=\"false\">\n        <el-button type=\"primary\" @click=\"submitForm\">保存</el-button>\n        <el-button @click=\"resetForm\">取消</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { ElMessage } from 'element-plus'\nimport { reactive, ref } from 'vue'\nimport AdminModel from '@/lin/model/admin'\n\nexport default {\n  props: ['id'],\n  setup(props, ctx) {\n    const form = ref(null)\n    const loading = ref(false)\n    const info = reactive({\n      newPassword: '',\n      confirmPassword: '',\n    })\n\n    /**\n     * 表单规则\n     */\n    const rules = getRules(ctx, info, form)\n\n    /**\n     * 提交表单数据\n     */\n    const submitForm = () => {\n      if (!info.newPassword && !info.confirmPassword) {\n        ctx.emit('handlePasswordResult', true)\n        return\n      }\n\n      form.value.validate(async valid => {\n        if (valid) {\n          let res = {}\n          try {\n            loading.value = true\n            res = await AdminModel.changePassword(info.newPassword, info.confirmPassword, props.id)\n          } catch (e) {\n            loading.value = false\n          }\n          if (res.code < window.MAX_SUCCESS_CODE) {\n            loading.value = false\n            ElMessage.success(`${res.message}`)\n            resetForm()\n            ctx.emit('handlePasswordResult', true)\n          } else {\n            loading.value = false\n            ElMessage.error(`${res.message}`)\n          }\n        } else {\n          ElMessage.error('请填写正确的密码信息')\n        }\n      })\n    }\n\n    // 重置表单\n    const resetForm = () => {\n      form.value.resetFields()\n    }\n\n    return {\n      info,\n      form,\n      rules,\n      loading,\n      resetForm,\n      submitForm,\n    }\n  },\n}\n\n/**\n * 表单规则\n */\nfunction getRules(ctx, info, form) {\n  const validatePassword = (rule, value, callback) => {\n    if (!value) {\n      callback(new Error('请输入密码'))\n    } else if (value.length < 6) {\n      callback(new Error('密码长度不能少于6位数'))\n    } else {\n      if (info.confirmPassword) {\n        form.value.validateField('confirmPassword')\n      }\n      callback()\n    }\n  }\n  const validatePassword2 = (rule, value, callback) => {\n    if (!value) {\n      callback(new Error('请再次输入密码'))\n    } else if (value !== info.newPassword) {\n      callback(new Error('两次输入密码不一致!'))\n    } else {\n      callback()\n    }\n  }\n\n  // 验证规则\n  return {\n    newPassword: [{ validator: validatePassword, trigger: 'blur', required: true }],\n    confirmPassword: [{ validator: validatePassword2, trigger: 'blur', required: true }],\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.el-form-item :v-deep(.el-form-item__label) {\n  padding-right: 10px !important;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}