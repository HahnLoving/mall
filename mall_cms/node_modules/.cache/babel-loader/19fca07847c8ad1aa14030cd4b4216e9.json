{"ast":null,"code":"import \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.symbol.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport Util from '@/lin/util/util';\nvar stageMap = {};\nexport var loggedIn = function loggedIn(state) {\n  return state.loggedIn;\n};\nexport var user = function user(state) {\n  return state.user;\n};\nexport var alreadyReadMessages = function alreadyReadMessages(state) {\n  return state.alreadyReadMessages;\n};\nexport var unreadMessages = function unreadMessages(state) {\n  return state.unreadMessages;\n};\n/**\n * 获取有权限的舞台配置\n * @param {*} state\n */\n\nexport var permissionStageConfig = function permissionStageConfig(state) {\n  var stageConfig = state.stageConfig,\n      permissions = state.permissions,\n      user = state.user;\n  var tempStageConfig = Util.deepClone(stageConfig);\n  var shookConfig = permissionShaking(tempStageConfig, permissions, user); // 设置舞台缓存\n\n  var list = {};\n  deepTravel(shookConfig, function (item) {\n    list[item.name] = item;\n  });\n  stageMap = list;\n  return shookConfig;\n};\n/**\n * 获取有权限的左侧菜单数据\n * @param {*} state\n * @param {*} getters 其他 getter\n */\n\nexport var sidebarList = function sidebarList(state, getters) {\n  var sidebarLevel = state.sidebarLevel;\n  var permissionStageConfig = getters.permissionStageConfig;\n\n  function deepGetSidebar(target) {\n    var level = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\n\n    // 集合节点处理\n    if (Array.isArray(target)) {\n      var acc = target.map(function (item) {\n        return deepGetSidebar(item, level - 1);\n      });\n      return acc.filter(function (item) {\n        return item !== null;\n      });\n    } // 检测是否需要在导航中显示\n\n\n    if (!target.inNav) {\n      return null;\n    }\n\n    if (target.type === 'folder' && level !== 0) {\n      // 处理 folder 模式\n      var sideConfig = {};\n      sideConfig.name = target.name;\n      sideConfig.title = target.title;\n      sideConfig.icon = target.icon;\n      sideConfig.path = target.route || Util.getRandomStr(6);\n      sideConfig.children = target.children.map(function (item) {\n        return deepGetSidebar(item, level - 1);\n      });\n      sideConfig.children = sideConfig.children.filter(function (item) {\n        return item !== null;\n      });\n      return sideConfig;\n    } // 处理一级就是 view 的情况\n\n\n    if (target.type === 'view') {\n      var _sideConfig = {};\n      _sideConfig.name = target.name;\n      _sideConfig.title = target.title;\n      _sideConfig.icon = target.icon;\n      _sideConfig.path = target.route;\n      return _sideConfig;\n    } // 处理 appTab 情况\n\n\n    if (target.type === 'tab') {\n      var _sideConfig2 = {};\n      _sideConfig2.name = target.name;\n      _sideConfig2.title = target.title;\n      _sideConfig2.icon = target.icon;\n      _sideConfig2.path = target.route; // 如果 Tab 没有设置默认打开的路由, 则设置为第一个子节点路由\n\n      if (!_sideConfig2.path) {\n        if (target.children && target.children.length > 0 && target.children[0].route) {\n          _sideConfig2.path = target.children[0].route;\n        }\n      }\n\n      return _sideConfig2;\n    } // 最后一层, 都当做子节点处理\n\n\n    if (level <= 0) {\n      var _sideConfig3 = {};\n      _sideConfig3.name = target.name;\n      _sideConfig3.title = target.title;\n      _sideConfig3.icon = target.icon;\n      _sideConfig3.path = Util.getRandomStr(6);\n\n      if (target.children && target.children.length > 0 && target.children[0].route) {\n        _sideConfig3.path = target.children[0].route;\n      }\n\n      return _sideConfig3;\n    }\n\n    return null;\n  }\n\n  var sideBar = deepGetSidebar(permissionStageConfig, sidebarLevel);\n  return sideBar;\n};\n/**\n * 获取有权限的所有节点配置对象\n */\n\nexport var getStageByName = function getStageByName() {\n  return function (name) {\n    return stageMap[name];\n  };\n};\n/**\n * 获取有权限的所有节点配置对象\n */\n\nexport var getStageByRoute = function getStageByRoute() {\n  return function (path) {\n    var result = Object.getOwnPropertySymbols(stageMap).find(function (key) {\n      return stageMap[key].route === path;\n    });\n    return stageMap[result];\n  };\n};\nexport var stageList = function stageList() {\n  return stageMap;\n};\nexport var permissions = function permissions(state) {\n  return state.permissions;\n};\nexport var getStageInfo = function getStageInfo(state) {\n  var stageConfig = state.stageConfig;\n  var cache = {};\n\n  var findStage = function findStage(stages, name) {\n    var result;\n\n    if (Array.isArray(stages)) {\n      for (var i = 0; i < stages.length; i += 1) {\n        result = findStage(stages[i], name);\n\n        if (result) {\n          break;\n        }\n      }\n\n      return result;\n    }\n\n    if (stages.children && stages.children.length) {\n      result = findStage(stages.children, name);\n\n      if (result) {\n        result.unshift(stages);\n      }\n\n      return result;\n    }\n\n    if (stages.name === name) {\n      return [stages];\n    }\n\n    return false;\n  };\n\n  return function (name) {\n    if (cache[name]) {\n      return cache[name];\n    }\n\n    var stageInfo = findStage(stageConfig, name);\n\n    if (stageInfo) {\n      cache[name] = stageInfo;\n    }\n\n    return stageInfo;\n  };\n};\n/**\n * 递归\n * @param {*} obj\n * @param {*} fuc\n */\n\nfunction deepTravel(obj, fuc) {\n  if (Array.isArray(obj)) {\n    obj.forEach(function (item) {\n      deepTravel(item, fuc);\n    });\n    return;\n  }\n\n  if (obj && obj.children) {\n    fuc(obj);\n    deepTravel(obj.children, fuc);\n    return;\n  }\n\n  if (obj.name) {\n    fuc(obj);\n  }\n}\n/**\n * 在侧边栏展示时，如果当前路由 children 属性为空，则删除该路由\n * @param {*} arr 路由配置项数据\n */\n\n\nfunction IterationDelateMenuChildren(arr) {\n  if (arr.length) {\n    // eslint-disable-next-line no-unused-vars\n    for (var i in arr) {\n      if (arr[i].children && !arr[i].children.length) {\n        delete arr[i];\n      } else if (arr[i].children && arr[i].children.length) {\n        IterationDelateMenuChildren(arr[i].children);\n      }\n    }\n  }\n\n  return arr;\n}\n/**\n * Shaking 掉无权限路由\n * @param {array} stageConfig 路由配置项数据\n * @param {array} permissions 当前登录管理员所拥有的权限集合\n * @param {object} currentUser 当前登录管理员\n */\n\n\nfunction permissionShaking(stageConfig, permissions, currentUser) {\n  var shookConfig = stageConfig.filter(function (route) {\n    if (Util.hasPermission(permissions, route, currentUser)) {\n      if (route.children && route.children.length) {\n        route.children = permissionShaking(route.children, permissions, currentUser);\n      }\n\n      return true;\n    }\n\n    return false;\n  });\n  return IterationDelateMenuChildren(shookConfig);\n}","map":{"version":3,"sources":["/Users/zhahn/Desktop/未命名文件夹/lin-cms-vue/src/store/getter.js"],"names":["Util","stageMap","loggedIn","state","user","alreadyReadMessages","unreadMessages","permissionStageConfig","stageConfig","permissions","tempStageConfig","deepClone","shookConfig","permissionShaking","list","deepTravel","item","name","sidebarList","getters","sidebarLevel","deepGetSidebar","target","level","Array","isArray","acc","map","filter","inNav","type","sideConfig","title","icon","path","route","getRandomStr","children","length","sideBar","getStageByName","getStageByRoute","result","Object","getOwnPropertySymbols","find","key","stageList","getStageInfo","cache","findStage","stages","i","unshift","stageInfo","obj","fuc","forEach","IterationDelateMenuChildren","arr","currentUser","hasPermission"],"mappings":"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","sourcesContent":["import Util from '@/lin/util/util'\n\nlet stageMap = {}\n\nexport const loggedIn = state => state.loggedIn\n\nexport const user = state => state.user\n\nexport const alreadyReadMessages = state => state.alreadyReadMessages\n\nexport const unreadMessages = state => state.unreadMessages\n\n/**\n * 获取有权限的舞台配置\n * @param {*} state\n */\nexport const permissionStageConfig = state => {\n  const { stageConfig, permissions, user } = state\n  const tempStageConfig = Util.deepClone(stageConfig)\n  const shookConfig = permissionShaking(tempStageConfig, permissions, user)\n\n  // 设置舞台缓存\n  const list = {}\n  deepTravel(shookConfig, item => {\n    list[item.name] = item\n  })\n  stageMap = list\n  return shookConfig\n}\n\n/**\n * 获取有权限的左侧菜单数据\n * @param {*} state\n * @param {*} getters 其他 getter\n */\nexport const sidebarList = (state, getters) => {\n  const { sidebarLevel } = state\n  const { permissionStageConfig } = getters\n\n  function deepGetSidebar(target, level = 3) {\n    // 集合节点处理\n    if (Array.isArray(target)) {\n      const acc = target.map(item => deepGetSidebar(item, level - 1))\n      return acc.filter(item => item !== null)\n    }\n\n    // 检测是否需要在导航中显示\n    if (!target.inNav) {\n      return null\n    }\n\n    if (target.type === 'folder' && level !== 0) {\n      // 处理 folder 模式\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route || Util.getRandomStr(6)\n      sideConfig.children = target.children.map(item => deepGetSidebar(item, level - 1))\n      sideConfig.children = sideConfig.children.filter(item => item !== null)\n      return sideConfig\n    }\n\n    // 处理一级就是 view 的情况\n    if (target.type === 'view') {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route\n      return sideConfig\n    }\n\n    // 处理 appTab 情况\n    if (target.type === 'tab') {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = target.route\n      // 如果 Tab 没有设置默认打开的路由, 则设置为第一个子节点路由\n      if (!sideConfig.path) {\n        if (target.children && target.children.length > 0 && target.children[0].route) {\n          sideConfig.path = target.children[0].route\n        }\n      }\n      return sideConfig\n    }\n\n    // 最后一层, 都当做子节点处理\n    if (level <= 0) {\n      const sideConfig = {}\n      sideConfig.name = target.name\n      sideConfig.title = target.title\n      sideConfig.icon = target.icon\n      sideConfig.path = Util.getRandomStr(6)\n      if (target.children && target.children.length > 0 && target.children[0].route) {\n        sideConfig.path = target.children[0].route\n      }\n      return sideConfig\n    }\n    return null\n  }\n\n  const sideBar = deepGetSidebar(permissionStageConfig, sidebarLevel)\n  return sideBar\n}\n\n/**\n * 获取有权限的所有节点配置对象\n */\nexport const getStageByName = () => name => stageMap[name]\n\n/**\n * 获取有权限的所有节点配置对象\n */\nexport const getStageByRoute = () => path => {\n  const result = Object.getOwnPropertySymbols(stageMap).find(key => stageMap[key].route === path)\n  return stageMap[result]\n}\n\nexport const stageList = () => stageMap\n\nexport const permissions = state => state.permissions\n\nexport const getStageInfo = state => {\n  const { stageConfig } = state\n  const cache = {}\n  const findStage = (stages, name) => {\n    let result\n    if (Array.isArray(stages)) {\n      for (let i = 0; i < stages.length; i += 1) {\n        result = findStage(stages[i], name)\n        if (result) {\n          break\n        }\n      }\n      return result\n    }\n\n    if (stages.children && stages.children.length) {\n      result = findStage(stages.children, name)\n      if (result) {\n        result.unshift(stages)\n      }\n      return result\n    }\n\n    if (stages.name === name) {\n      return [stages]\n    }\n    return false\n  }\n  return name => {\n    if (cache[name]) {\n      return cache[name]\n    }\n    const stageInfo = findStage(stageConfig, name)\n    if (stageInfo) {\n      cache[name] = stageInfo\n    }\n    return stageInfo\n  }\n}\n\n/**\n * 递归\n * @param {*} obj\n * @param {*} fuc\n */\nfunction deepTravel(obj, fuc) {\n  if (Array.isArray(obj)) {\n    obj.forEach(item => {\n      deepTravel(item, fuc)\n    })\n    return\n  }\n  if (obj && obj.children) {\n    fuc(obj)\n    deepTravel(obj.children, fuc)\n    return\n  }\n  if (obj.name) {\n    fuc(obj)\n  }\n}\n\n/**\n * 在侧边栏展示时，如果当前路由 children 属性为空，则删除该路由\n * @param {*} arr 路由配置项数据\n */\nfunction IterationDelateMenuChildren(arr) {\n  if (arr.length) {\n    // eslint-disable-next-line no-unused-vars\n    for (const i in arr) {\n      if (arr[i].children && !arr[i].children.length) {\n        delete arr[i]\n      } else if (arr[i].children && arr[i].children.length) {\n        IterationDelateMenuChildren(arr[i].children)\n      }\n    }\n  }\n  return arr\n}\n\n/**\n * Shaking 掉无权限路由\n * @param {array} stageConfig 路由配置项数据\n * @param {array} permissions 当前登录管理员所拥有的权限集合\n * @param {object} currentUser 当前登录管理员\n */\nfunction permissionShaking(stageConfig, permissions, currentUser) {\n  const shookConfig = stageConfig.filter(route => {\n    if (Util.hasPermission(permissions, route, currentUser)) {\n      if (route.children && route.children.length) {\n        route.children = permissionShaking(route.children, permissions, currentUser)\n      }\n      return true\n    }\n    return false\n  })\n  return IterationDelateMenuChildren(shookConfig)\n}\n"]},"metadata":{},"sourceType":"module"}