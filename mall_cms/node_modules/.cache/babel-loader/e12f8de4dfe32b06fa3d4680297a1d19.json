{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport { ref, reactive } from 'vue';\nimport { ElMessageBox, ElMessage } from 'element-plus';\nimport AdminModel from 'lin/model/admin';\nimport UserInfo from './user-info';\nimport UserPassword from './user-password';\nimport { useUserList, useFormData } from './use-user';\nexport default {\n  components: {\n    UserInfo: UserInfo,\n    UserPassword: UserPassword\n  },\n  setup: function setup(props, ctx) {\n    var info = ref(false);\n    var password = ref(false);\n    var dialogFormVisible = ref(false); // 弹窗遮罩层\n\n    var refreshPagination = ref(true); // 页数增加的时候，因为缓存的缘故，需要刷新Pagination组件\n\n    var _useUserList = useUserList(),\n        allGroups = _useUserList.allGroups,\n        loading = _useUserList.loading,\n        groupId = _useUserList.groupId,\n        totalNum = _useUserList.totalNum,\n        tableData = _useUserList.tableData,\n        pageCount = _useUserList.pageCount,\n        currentPage = _useUserList.currentPage,\n        getAdminUsers = _useUserList.getAdminUsers;\n\n    var _useFormData = useFormData(ctx, dialogFormVisible, getAdminUsers, currentPage, loading, info, password),\n        id = _useFormData.id,\n        activeTab = _useFormData.activeTab,\n        resetForm = _useFormData.resetForm,\n        confirmEdit = _useFormData.confirmEdit,\n        handleClose = _useFormData.handleClose,\n        handleClick = _useFormData.handleClick,\n        handleChange = _useFormData.handleChange,\n        handleInfoResult = _useFormData.handleInfoResult,\n        handleCurrentChange = _useFormData.handleCurrentChange,\n        handlePasswordResult = _useFormData.handlePasswordResult;\n\n    var userInfo = reactive({\n      email: '',\n      username: '',\n      password: '',\n      groups: [],\n      confirm_password: ''\n    });\n    /**\n     * 修改管理员信息\n     */\n\n    var handleEdit = function handleEdit(row) {\n      id.value = row.id;\n      userInfo.email = row.email;\n      userInfo.groups = row.groups;\n      userInfo.username = row.username;\n      dialogFormVisible.value = true;\n    };\n    /**\n     * 删除管理员数据\n     */\n\n\n    var handleDelete = function handleDelete(id) {\n      var res;\n      ElMessageBox.confirm('此操作将永久删除该用户, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                loading.value = true;\n                _context.next = 4;\n                return AdminModel.deleteOneUser(id);\n\n              case 4:\n                res = _context.sent;\n                _context.next = 11;\n                break;\n\n              case 7:\n                _context.prev = 7;\n                _context.t0 = _context[\"catch\"](0);\n                loading.value = false;\n                console.error(_context.t0);\n\n              case 11:\n                if (!(res.code < window.MAX_SUCCESS_CODE)) {\n                  _context.next = 19;\n                  break;\n                }\n\n                loading.value = false;\n\n                if (totalNum.value % pageCount.value === 1 && currentPage.value !== 1) {\n                  // 判断删除的是不是每一页的最后一条数据\n                  currentPage.value--;\n                }\n\n                _context.next = 16;\n                return getAdminUsers();\n\n              case 16:\n                ElMessage.success(\"\".concat(res.message));\n                _context.next = 21;\n                break;\n\n              case 19:\n                loading.value = false;\n                ElMessage.error(\"\".concat(res.message));\n\n              case 21:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, null, [[0, 7]]);\n      })));\n    };\n\n    var rowDoubleClick = function rowDoubleClick(row) {\n      handleEdit(row);\n    };\n\n    return {\n      id: id,\n      info: info,\n      groupId: groupId,\n      loading: loading,\n      password: password,\n      userInfo: userInfo,\n      totalNum: totalNum,\n      allGroups: allGroups,\n      tableData: tableData,\n      activeTab: activeTab,\n      resetForm: resetForm,\n      pageCount: pageCount,\n      handleEdit: handleEdit,\n      confirmEdit: confirmEdit,\n      handleClose: handleClose,\n      currentPage: currentPage,\n      handleClick: handleClick,\n      handleChange: handleChange,\n      handleDelete: handleDelete,\n      rowDoubleClick: rowDoubleClick,\n      handleInfoResult: handleInfoResult,\n      refreshPagination: refreshPagination,\n      dialogFormVisible: dialogFormVisible,\n      handleCurrentChange: handleCurrentChange,\n      handlePasswordResult: handlePasswordResult\n    };\n  }\n};","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/admin/user/user-list.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"header\">\n      <div class=\"title\">用户列表</div>\n      <!-- 分组选择下拉框 -->\n      <el-select filterable v-model=\"groupId\" placeholder=\"请选择分组\" @change=\"handleChange\" clearable>\n        <el-option v-for=\"(group, index) in allGroups\" :key=\"index\" :label=\"group.name\" :value=\"group.id\"> </el-option>\n      </el-select>\n    </div>\n    <!-- 表格 -->\n    <el-table :data=\"tableData\" v-loading=\"loading\" @row-dblclick=\"rowDoubleClick\">\n      <el-table-column prop=\"username\" label=\"名称\"></el-table-column>\n      <el-table-column prop=\"groupNames\" label=\"所属分组\"></el-table-column>\n      <el-table-column label=\"操作\" fixed=\"right\" width=\"275\">\n        <template #default=\"scope\">\n          <el-button plain size=\"mini\" type=\"primary\" @click=\"handleEdit(scope.row)\">编辑</el-button>\n          <el-button plain size=\"mini\" type=\"danger\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n    <!-- 分页 -->\n    <div class=\"pagination\">\n      <el-pagination\n        :total=\"totalNum\"\n        :background=\"true\"\n        :page-size=\"pageCount\"\n        v-if=\"refreshPagination\"\n        :current-page=\"currentPage\"\n        layout=\"prev, pager, next, jumper\"\n        @current-change=\"handleCurrentChange\"\n      >\n      </el-pagination>\n    </div>\n    <!-- 弹窗 -->\n    <el-dialog title=\"用户信息\" :append-to-body=\"true\" :before-close=\"handleClose\" v-model=\"dialogFormVisible\">\n      <div style=\"margin-top: -25px\">\n        <el-tabs v-model=\"activeTab\" @tab-click=\"handleClick\">\n          <el-tab-pane label=\"修改信息\" name=\"修改信息\">\n            <user-info\n              :id=\"id\"\n              ref=\"info\"\n              class=\"info\"\n              pageType=\"edit\"\n              :info=\"userInfo\"\n              :submit=\"false\"\n              :allGroups=\"allGroups\"\n              labelPosition=\"right\"\n              v-if=\"dialogFormVisible\"\n              @handleInfoResult=\"handleInfoResult\"\n            />\n          </el-tab-pane>\n          <el-tab-pane label=\"修改密码\" name=\"修改密码\">\n            <user-password @handlePasswordResult=\"handlePasswordResult\" ref=\"password\" :id=\"id\" class=\"password\" />\n          </el-tab-pane>\n        </el-tabs>\n      </div>\n      <!-- 按键操作 -->\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button type=\"primary\" @click=\"confirmEdit\">确 定</el-button>\n          <el-button @click=\"resetForm\">重 置</el-button>\n        </div>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { ref, reactive } from 'vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport AdminModel from 'lin/model/admin'\n\nimport UserInfo from './user-info'\nimport UserPassword from './user-password'\nimport { useUserList, useFormData } from './use-user'\n\nexport default {\n  components: { UserInfo, UserPassword },\n  setup(props, ctx) {\n    const info = ref(false)\n    const password = ref(false)\n    const dialogFormVisible = ref(false) // 弹窗遮罩层\n    const refreshPagination = ref(true) // 页数增加的时候，因为缓存的缘故，需要刷新Pagination组件\n\n    const { allGroups, loading, groupId, totalNum, tableData, pageCount, currentPage, getAdminUsers } = useUserList()\n    const {\n      id,\n      activeTab,\n      resetForm,\n      confirmEdit,\n      handleClose,\n      handleClick,\n      handleChange,\n      handleInfoResult,\n      handleCurrentChange,\n      handlePasswordResult,\n    } = useFormData(ctx, dialogFormVisible, getAdminUsers, currentPage, loading, info, password)\n\n    const userInfo = reactive({\n      email: '',\n      username: '',\n      password: '',\n      groups: [],\n      confirm_password: '',\n    })\n\n    /**\n     * 修改管理员信息\n     */\n    const handleEdit = row => {\n      id.value = row.id\n      userInfo.email = row.email\n      userInfo.groups = row.groups\n      userInfo.username = row.username\n      dialogFormVisible.value = true\n    }\n\n    /**\n     * 删除管理员数据\n     */\n    const handleDelete = id => {\n      let res\n      ElMessageBox.confirm('此操作将永久删除该用户, 是否继续?', '提示', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning',\n      }).then(async () => {\n        try {\n          loading.value = true\n          res = await AdminModel.deleteOneUser(id)\n        } catch (e) {\n          loading.value = false\n          console.error(e)\n        }\n        if (res.code < window.MAX_SUCCESS_CODE) {\n          loading.value = false\n          if (totalNum.value % pageCount.value === 1 && currentPage.value !== 1) {\n            // 判断删除的是不是每一页的最后一条数据\n            currentPage.value--\n          }\n          await getAdminUsers()\n          ElMessage.success(`${res.message}`)\n        } else {\n          loading.value = false\n          ElMessage.error(`${res.message}`)\n        }\n      })\n    }\n\n    const rowDoubleClick = row => {\n      handleEdit(row)\n    }\n\n    return {\n      id,\n      info,\n      groupId,\n      loading,\n      password,\n      userInfo,\n      totalNum,\n      allGroups,\n      tableData,\n      activeTab,\n      resetForm,\n      pageCount,\n      handleEdit,\n      confirmEdit,\n      handleClose,\n      currentPage,\n      handleClick,\n      handleChange,\n      handleDelete,\n      rowDoubleClick,\n      handleInfoResult,\n      refreshPagination,\n      dialogFormVisible,\n      handleCurrentChange,\n      handlePasswordResult,\n    }\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  padding: 0 30px;\n\n  .header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n\n    .title {\n      height: 59px;\n      line-height: 59px;\n      color: $parent-title-color;\n      font-size: 16px;\n      font-weight: 500;\n    }\n  }\n\n  .pagination {\n    display: flex;\n    justify-content: flex-end;\n    margin: 20px;\n  }\n}\n\n.info {\n  margin-left: -55px;\n  margin-bottom: -30px;\n}\n\n.password {\n  margin-top: 20px;\n  margin-left: -55px;\n  margin-bottom: -20px;\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}