{"ast":null,"code":"import _asyncToGenerator from \"/Users/zhahn/Documents/Hahn/\\u81EA\\u8003/\\u9879\\u76EE/mall_cms/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"regenerator-runtime/runtime.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.object.keys.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport { useRouter } from 'vue-router';\nimport { ref, reactive } from 'vue';\nimport { ElMessage } from 'element-plus';\nimport AdminModel from '@/lin/model/admin';\nimport GroupPermissions from './group-permission';\nexport default {\n  components: {\n    GroupPermissions: GroupPermissions\n  },\n  setup: function setup() {\n    /**\n     * 表单验证规则\n     */\n    var _getRules = getRules(),\n        rules = _getRules.rules; // originally data properties\n\n\n    var form = ref(null);\n    var groupPermissions = ref(null);\n    var loading = ref(false);\n    var router = useRouter();\n    var permissions = ref([]);\n    var allPermissions = ref([]);\n    var group = reactive({\n      name: '',\n      info: ''\n    });\n    /**\n     * 重置表单\n     */\n\n    var resetForm = function resetForm() {\n      form.value.resetFields();\n      groupPermissions.value.getGroupPermissions();\n    };\n    /**\n     * 提交表单\n     * 添加新的分组\n     */\n\n\n    var submitForm = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                form.value.validate( /*#__PURE__*/function () {\n                  var _ref2 = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(valid) {\n                    var res, finalPermissions;\n                    return regeneratorRuntime.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            if (!valid) {\n                              _context.next = 17;\n                              break;\n                            }\n\n                            res = {};\n                            finalPermissions = permissions.value.filter(function (x) {\n                              return Object.keys(allPermissions.value).indexOf(x) < 0;\n                            });\n                            _context.prev = 3;\n                            loading.value = true;\n                            _context.next = 7;\n                            return AdminModel.createOneGroup(group.name, group.info, finalPermissions);\n\n                          case 7:\n                            res = _context.sent;\n                            _context.next = 14;\n                            break;\n\n                          case 10:\n                            _context.prev = 10;\n                            _context.t0 = _context[\"catch\"](3);\n                            loading.value = false;\n                            console.error(_context.t0);\n\n                          case 14:\n                            if (res.code < window.MAX_SUCCESS_CODE) {\n                              loading.value = false;\n                              ElMessage.success(\"\".concat(res.message));\n                              router.push('/admin/group/list');\n                              resetForm();\n                            } else {\n                              loading.value = false;\n                            }\n\n                            _context.next = 18;\n                            break;\n\n                          case 17:\n                            ElMessage.error('请将信息填写完整');\n\n                          case 18:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, null, [[3, 10]]);\n                  }));\n\n                  return function (_x) {\n                    return _ref2.apply(this, arguments);\n                  };\n                }());\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      return function submitForm() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n    /**\n     * 编辑后的最终权限\n     */\n\n\n    var updatePermissions = function updatePermissions(picked) {\n      permissions.value = picked;\n    };\n\n    return {\n      form: form,\n      rules: rules,\n      group: group,\n      loading: loading,\n      resetForm: resetForm,\n      submitForm: submitForm,\n      groupPermissions: groupPermissions,\n      updatePermissions: updatePermissions\n    };\n  }\n};\n\nfunction getRules() {\n  var checkName = function checkName(rule, value, callback) {\n    if (!value) {\n      return callback(new Error('分组名称不能为空'));\n    }\n\n    callback();\n  };\n\n  var rules = {\n    info: [],\n    name: [{\n      validator: checkName,\n      trigger: ['blur', 'change'],\n      required: true\n    }]\n  };\n  return {\n    rules: rules\n  };\n}","map":{"version":3,"sources":["/Users/zhahn/Documents/Hahn/自考/项目/mall_cms/src/view/admin/group/group-create.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"title\">新建分组信息</div>\n    <el-row>\n      <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n        <div class=\"content\">\n          <el-form\n            ref=\"form\"\n            status-icon\n            :rules=\"rules\"\n            :model=\"group\"\n            label-position=\"right\"\n            label-width=\"100px\"\n            v-loading=\"loading\"\n            @submit.prevent\n          >\n            <el-form-item label=\"分组名称\" prop=\"name\">\n              <el-input clearable v-model=\"group.name\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"分组描述\" prop=\"info\">\n              <el-input clearable v-model=\"group.info\"></el-input>\n            </el-form-item>\n            <el-form-item>\n              <group-permissions title=\"分配权限\" ref=\"groupPermissions\" @updatePermissions=\"updatePermissions\">\n              </group-permissions>\n            </el-form-item>\n            <el-form-item class=\"submit\">\n              <el-button type=\"primary\" @click=\"submitForm('form')\">保 存</el-button>\n              <el-button @click=\"resetForm('form')\">重 置</el-button>\n            </el-form-item>\n          </el-form>\n        </div>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<script>\nimport { useRouter } from 'vue-router'\nimport { ref, reactive } from 'vue'\nimport { ElMessage } from 'element-plus'\nimport AdminModel from '@/lin/model/admin'\nimport GroupPermissions from './group-permission'\n\nexport default {\n  components: {\n    GroupPermissions,\n  },\n  setup() {\n    /**\n     * 表单验证规则\n     */\n    const { rules } = getRules()\n\n    // originally data properties\n    const form = ref(null)\n    const groupPermissions = ref(null)\n\n    const loading = ref(false)\n    const router = useRouter()\n    const permissions = ref([])\n    const allPermissions = ref([])\n    const group = reactive({ name: '', info: '' })\n\n    /**\n     * 重置表单\n     */\n    const resetForm = () => {\n      form.value.resetFields()\n      groupPermissions.value.getGroupPermissions()\n    }\n\n    /**\n     * 提交表单\n     * 添加新的分组\n     */\n    const submitForm = async () => {\n      form.value.validate(async valid => {\n        if (valid) {\n          let res = {}\n          const finalPermissions = permissions.value.filter(x => Object.keys(allPermissions.value).indexOf(x) < 0)\n          try {\n            loading.value = true\n            res = await AdminModel.createOneGroup(group.name, group.info, finalPermissions)\n          } catch (e) {\n            loading.value = false\n            console.error(e)\n          }\n          if (res.code < window.MAX_SUCCESS_CODE) {\n            loading.value = false\n            ElMessage.success(`${res.message}`)\n            router.push('/admin/group/list')\n            resetForm()\n          } else {\n            loading.value = false\n          }\n        } else {\n          ElMessage.error('请将信息填写完整')\n        }\n      })\n    }\n\n    /**\n     * 编辑后的最终权限\n     */\n    const updatePermissions = picked => {\n      permissions.value = picked\n    }\n\n    return {\n      form,\n      rules,\n      group,\n      loading,\n      resetForm,\n      submitForm,\n      groupPermissions,\n      updatePermissions,\n    }\n  },\n}\n\nfunction getRules() {\n  const checkName = (rule, value, callback) => {\n    if (!value) {\n      return callback(new Error('分组名称不能为空'))\n    }\n    callback()\n  }\n  const rules = { info: [], name: [{ validator: checkName, trigger: ['blur', 'change'], required: true }] }\n  return { rules }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n    border-bottom: 1px solid #dae1ec;\n  }\n\n  .content {\n    margin-top: 10px;\n    padding-left: 25px;\n    padding-right: 40px;\n  }\n\n  .submit {\n    float: left;\n  }\n}\n</style>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}