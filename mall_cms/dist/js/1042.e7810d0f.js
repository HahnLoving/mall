"use strict";(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[1042,1301,2194],{41301:function(e,r,n){n.r(r),n.d(r,{default:function(){return i}});var t=n(48534),u=n(13087),a=n(62833),s=(n(35666),n(12109)),i=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5;(0,u.Z)(this,e),this.uPage=r,this.uCount=n,this.lPage=t,this.gCount=a}return(0,a.Z)(e,[{key:"increaseUPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.uPage+=1;case 1:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"increaseGPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.lPage+=1;case 1:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"decreaseUPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.uPage-=1,this.uPage<0&&(this.uPage=0);case 2:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"decreaseGPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.lPage-=1,this.lPage<0&&(this.lPage=0);case 2:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"nextUsersPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.increaseUPage();case 2:return e.abrupt("return",this.getAdminUsers({}));case 3:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"preUsersPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.decreaseUPage();case 2:return e.abrupt("return",this.getAdminUsers({}));case 3:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"getGroupsWithPermissions",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r){var n,t,u,a,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.count,t=void 0===n?this.uCount:n,u=r.page,a=void 0===u?this.uPage:u,e.next=3,(0,s.get)("cms/admin/groups",{count:t,page:a});case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"nextGroupsPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.increaseGPage();case 2:return e.abrupt("return",this.getGroupsWithPermissions({}));case 3:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"preGroupsPage",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.decreaseGPage();case 2:return e.abrupt("return",this.getGroupsWithPermissions({}));case 3:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()}],[{key:"getAllPermissions",value:function(){return(0,s.get)("cms/admin/permission")}},{key:"getAdminUsers",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r){var n,t,u,a,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=r.groupId,t=r.count,u=void 0===t?this.uCount:t,a=r.page,i=void 0===a?this.uPage:a,!n){e.next=7;break}return e.next=4,(0,s.get)("cms/admin/users",{count:u,page:i,group_id:n});case 4:o=e.sent,e.next=10;break;case 7:return e.next=9,(0,s.get)("cms/admin/users",{count:u,page:i});case 9:o=e.sent;case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"getAllGroups",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.get)("cms/admin/group/all");case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));function r(){return e.apply(this,arguments)}return r}()},{key:"getOneGroup",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.get)("cms/admin/group/".concat(r));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"createOneGroup",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n,t){var u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.post)("cms/admin/group",{name:r,info:n,permission_ids:t});case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));function r(r,n,t){return e.apply(this,arguments)}return r}()},{key:"updateOneGroup",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n,t){var u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.put)("cms/admin/group/".concat(t),{name:r,info:n});case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));function r(r,n,t){return e.apply(this,arguments)}return r}()},{key:"deleteOneGroup",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s._delete)("cms/admin/group/".concat(r));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"deleteOneUser",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s._delete)("cms/admin/user/".concat(r));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"updateOneUser",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n,t){var u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.put)("cms/admin/user/".concat(t),{email:r,group_ids:n});case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));function r(r,n,t){return e.apply(this,arguments)}return r}()},{key:"dispatchPermissions",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.post)("cms/admin/permission/dispatch/batch",{group_id:r,permission_ids:n});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function r(r,n){return e.apply(this,arguments)}return r}()},{key:"changePassword",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n,t){var u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.put)("cms/admin/user/".concat(t,"/password"),{new_password:r,confirm_password:n});case 2:return u=e.sent,e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));function r(r,n,t){return e.apply(this,arguments)}return r}()},{key:"removePermissions",value:function(){var e=(0,t.Z)(regeneratorRuntime.mark((function e(r,n){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,s.post)("cms/admin/permission/remove",{group_id:r,permission_ids:n});case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function r(r,n){return e.apply(this,arguments)}return r}()}]),e}()},42194:function(e,r,n){n.r(r),n.d(r,{default:function(){return p}});var t=n(95082),u=n(48534),a=n(13087),s=n(62833),i=(n(35666),n(24239)),o=n(12109),c=n(8593),p=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"register",value:function(e){return(0,o["default"])({method:"post",url:"cms/user/register",data:{email:e.email,username:e.username,password:e.password,group_ids:e.groupIds,confirm_password:e.confirmPassword},handleError:!0})}},{key:"getToken",value:function(){var e=(0,u.Z)(regeneratorRuntime.mark((function e(r,n,t,u){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o["default"])({url:"cms/user/login",method:"POST",data:{captcha:t,username:r,password:n},headers:{tag:u}});case 2:return a=e.sent,(0,c.saveTokens)(a.access_token,a.refresh_token),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));function r(r,n,t,u){return e.apply(this,arguments)}return r}()},{key:"getInformation",value:function(){var e=(0,u.Z)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("cms/user/information");case 2:return r=e.sent,n=null===i["default"].getters.user?{}:i["default"].getters.user,e.abrupt("return",Object.assign((0,t.Z)({},n),r));case 5:case"end":return e.stop()}}),e)})));function r(){return e.apply(this,arguments)}return r}()},{key:"getPermissions",value:function(){var e=(0,u.Z)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("cms/user/permissions");case 2:return r=e.sent,n=null===i["default"].getters.user?{}:i["default"].getters.user,e.abrupt("return",Object.assign((0,t.Z)({},n),r));case 5:case"end":return e.stop()}}),e)})));function r(){return e.apply(this,arguments)}return r}()},{key:"updatePassword",value:function(e){var r=e.old_password,n=e.new_password,t=e.confirm_password;return(0,o.put)("cms/user/change_password",{new_password:n,confirm_password:t,old_password:r})}}]),e}()},61042:function(e,r,n){n.r(r),n.d(r,{default:function(){return v}});n(68309);var t=n(66252),u=n(58061),a=n(56612),s={class:"container"},i=(0,t.Uk)("保 存");function o(e,r,n,o,c,p){var l=(0,t.up)("el-input"),d=(0,t.up)("el-form-item"),m=(0,t.up)("el-checkbox"),f=(0,t.up)("el-checkbox-group"),g=(0,t.up)("el-button"),w=(0,t.up)("el-form"),h=(0,t.Q2)("loading");return(0,t.wg)(),(0,t.iD)("div",s,[(0,t.wy)((0,t.Wm)(w,{ref:"form","status-icon":"",rules:o.rules,model:o.userInfo,"label-width":"100px","label-position":n.labelPosition,onSubmit:r[5]||(r[5]=(0,u.iM)((function(){}),["prevent"]))},{default:(0,t.w5)((function(){return[(0,t.Wm)(d,{label:"用户名",prop:"username"},{default:(0,t.w5)((function(){return[(0,t.Wm)(l,{clearable:"",modelValue:o.userInfo.username,"onUpdate:modelValue":r[0]||(r[0]=function(e){return o.userInfo.username=e}),disabled:o.isEdited},null,8,["modelValue","disabled"])]})),_:1}),(0,t.Wm)(d,{label:"邮箱",prop:"email"},{default:(0,t.w5)((function(){return[(0,t.Wm)(l,{clearable:"",disabled:o.isEdited,modelValue:o.userInfo.email,"onUpdate:modelValue":r[1]||(r[1]=function(e){return o.userInfo.email=e}),"auto-complete":"new-password"},null,8,["disabled","modelValue"])]})),_:1}),"add"===n.pageType?((0,t.wg)(),(0,t.j4)(d,{key:0,label:"密码",prop:"password"},{default:(0,t.w5)((function(){return[(0,t.Wm)(l,{clearable:"",type:"password",modelValue:o.userInfo.password,"onUpdate:modelValue":r[2]||(r[2]=function(e){return o.userInfo.password=e}),"auto-complete":"new-password"},null,8,["modelValue"])]})),_:1})):(0,t.kq)("",!0),"add"===n.pageType?((0,t.wg)(),(0,t.j4)(d,{key:1,label:"确认密码",prop:"confirmPassword","label-position":"top"},{default:(0,t.w5)((function(){return[(0,t.Wm)(l,{clearable:"",type:"password",autocomplete:"off",modelValue:o.userInfo.confirmPassword,"onUpdate:modelValue":r[3]||(r[3]=function(e){return o.userInfo.confirmPassword=e})},null,8,["modelValue"])]})),_:1})):(0,t.kq)("",!0),"password"!==n.pageType?((0,t.wg)(),(0,t.j4)(d,{key:2,label:"选择分组"},{default:(0,t.w5)((function(){return[(0,t.Wm)(f,{modelValue:o.userInfo.groupIds,"onUpdate:modelValue":r[4]||(r[4]=function(e){return o.userInfo.groupIds=e}),size:"small",style:{transform:"translateY(5px)"}},{default:(0,t.w5)((function(){return[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(n.allGroups,(function(e){return(0,t.wg)(),(0,t.j4)(m,{key:e.id,label:e.id,border:"",style:{"margin-left":"0"}},{default:(0,t.w5)((function(){return[(0,t.Uk)((0,a.zw)(e.name),1)]})),_:2},1032,["label"])})),128))]})),_:1},8,["modelValue"])]})),_:1})):(0,t.kq)("",!0),(0,t.wy)((0,t.Wm)(d,{class:"submit"},{default:(0,t.w5)((function(){return[(0,t.Wm)(g,{type:"primary",onClick:o.submitForm},{default:(0,t.w5)((function(){return[i]})),_:1},8,["onClick"])]})),_:1},512),[[u.F8,n.submit]])]})),_:1},8,["rules","model","label-position"]),[[h,o.loading]])])}var c=n(48534),p=(n(35666),n(9653),n(21249),n(41539),n(39714),n(2707),n(62931)),l=n(20610),d=n(41301),m=n(42194),f={props:{submit:{type:Boolean,default:!0},id:{type:Number,default:void 0},allGroups:{type:Array,default:function(){}},labelPosition:{type:String,default:"right"},info:{type:Object,default:function(){}},pageType:{type:String,default:"add"}},setup:function(e,r){var n=(0,p.iH)(null),u=(0,p.iH)(!1),a=(0,p.iH)(!1),s=(0,p.qj)({email:"",username:"",password:"",groupIds:[],confirmPassword:""}),i=g(s),o=i.rules,f=function(){n.value.validate(function(){var n=(0,c.Z)(regeneratorRuntime.mark((function n(t){var a,i;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t){n.next=34;break}if(a={},"add"!==e.pageType){n.next=17;break}return n.prev=3,u.value=!0,n.next=7,m["default"].register(s);case 7:a=n.sent,a.code<window.MAX_SUCCESS_CODE&&(u.value=!1,l.z8.success("".concat(a.message)),w()),n.next=15;break;case 11:n.prev=11,n.t0=n["catch"](3),u.value=!1,l.z8.error("新增用户失败");case 15:n.next=32;break;case 17:if(i=e.info.groups.map((function(e){return e.id})),s.groupIds.sort().toString()!==i.toString()){n.next=21;break}return r.emit("handleInfoResult",!1),n.abrupt("return");case 21:return n.prev=21,u.value=!0,n.next=25,d["default"].updateOneUser(s.email,s.groupIds,e.id);case 25:a=n.sent,n.next=31;break;case 28:n.prev=28,n.t1=n["catch"](21),u.value=!1;case 31:a.code<window.MAX_SUCCESS_CODE?(u.value=!1,l.z8.success("".concat(a.message)),r.emit("handleInfoResult",!0)):u.value=!1;case 32:n.next=35;break;case 34:l.z8.error("请填写正确的信息");case 35:case"end":return n.stop()}}),n,null,[[3,11],[21,28]])})));return function(e){return n.apply(this,arguments)}}())},w=function(){"edit"===e.pageType?h():(s.groupIds=[],n.value.resetFields())},h=function(){s.email=e.info.email,s.username=e.info.username,s.groupIds=e.info.groups.map((function(e){return e.id}))};return(0,t.bv)((function(){"edit"===e.pageType&&(h(),a.value=!0)})),{form:n,rules:o,loading:u,isEdited:a,userInfo:s,resetForm:w,submitForm:f}}};function g(e){var r=function(e,r,n){r||n(new Error("用户名不能为空")),n()},n=function(e,r,n){""===r?n(new Error("请输入密码")):r.length<6?n(new Error("密码长度不能少于6位数")):n()},t=function(r,n,t){""===n?t(new Error("请再次输入密码")):n!==e.password?t(new Error("两次输入密码不一致!")):t()},u={password:[{validator:n,trigger:"blur",required:!0}],username:[{validator:r,trigger:["blur","change"],required:!0}],confirmPassword:[{validator:t,trigger:"blur",required:!0}],email:[{type:"email",message:"请输入正确的邮箱地址或者不填",trigger:["blur","change"]}]};return{rules:u}}var w=n(83744);const h=(0,w.Z)(f,[["render",o],["__scopeId","data-v-48cef260"]]);var v=h}}]);
//# sourceMappingURL=1042.e7810d0f.js.map