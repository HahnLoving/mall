{"version":3,"file":"js/9086.88a13db5.js","mappings":"0RACOA,MAAM,Q,GAEDA,MAAM,oB,GACLA,MAAM,c,aAIJA,MAAM,a,GACJA,MAAM,SAASC,MAAM,U,aAEjBD,MAAM,Q,uBACX,OAAgE,KAA7DA,MAAM,0BAA0BE,MAAA,sBAAnC,Y,GAICF,MAAM,Q,SAUJA,MAAM,Q,uBAEb,OAA+D,OAA1DG,IAAA,EAAyCH,MAAM,UAApD,Y,GAEEA,MAAM,gB,uBAEN,OAAyD,KAAtDA,MAAM,6CAA2C,Y,oCAAM,OAAiB,YAAX,QAAI,M,GAApE,IAA0D,G,uBAEtB,OAAoC,KAAjCA,MAAM,wBAAsB,Y,oCAAM,OAAiB,YAAX,QAAI,M,GAA/C,IAAqC,G,mJAjCrF,QAwCM,MAxCN,EAwCM,EAvCJ,QAoCc,QAhCKI,UAAQ,SACvB,iBA6BmB,EA7BnB,QA6BmB,GA7BDJ,MAAM,YAAU,C,kBAChC,iBAqBM,EArBN,OAqBM,MArBN,EAqBM,EApBJ,OAMM,MANN,EAMM,EALJ,OAAoD,OAA9CG,IAAK,EAAAE,KAAKC,QAAU,EAAAC,cAAeC,IAAI,MAA7C,WACA,OAGQ,QAHR,EAGQ,CAFN,GACA,OAA6E,SAAtEC,IAAI,cAAcC,KAAK,OAAOC,OAAO,UAAW,SAAM,8BAAE,EAAAC,YAAA,EAAAA,WAAA,sBAA/D,eAGJ,OAWM,MAXN,EAWM,CAViD,EAAAC,kBAArD,WACA,QAOY,G,MANVC,YAAY,QACZC,KAAK,Q,WAEI,EAAAC,S,qDAAA,EAAAA,SAAQ,IACjBP,IAAI,QACH,OAAM,EAAAQ,MANT,mCADqD,WAArD,QAA0F,O,MAArFjB,MAAM,WAAY,QAAK,8BAAE,EAAAkB,gBAAA,EAAAA,eAAA,uBAA9B,QAAyE,EAAAF,UAAQ,IASxD,EAAAH,iBAAzB,iBAAyB,WAAzB,QAA+D,MAA/D,GAA+D,QAAlB,EAAAM,WAAS,MAExD,KAEF,OAKK,KALL,EAKK,EAJH,OAEK,MAFDnB,MAAM,WAAY,QAAK,8BAAE,EAAAoB,YAAA,EAAAA,WAAA,sBAA7B,IAGA,OAAiG,MAA7FpB,MAAM,UAAW,QAAK,8BAAE,EAAAqB,UAAA,EAAAA,SAAA,sBAA5B,S,4BA/BN,iBAEO,EAFP,OAEO,OAFP,EAEO,EADL,OAAkF,MAAlF,EAAkF,EAA1D,OAAoD,OAA9ClB,IAAK,EAAAE,KAAKC,QAAU,EAAAC,cAAeC,IAAI,MAA7C,kB,OAoC5B,QAA4G,GAAnGc,cAAe,EAAAC,QAAUC,YAAa,EAAAA,YAAc,oBAAmB,EAAAC,mBAAhF,gE,yIAWJ,GACEC,KAAM,OACNC,WAAY,CAAEC,OAAA,cACdC,KAHa,WAIX,MAAO,CACLN,QAAS,GACThB,cAAA,EACAuB,SAAU,KACVd,SAAU,KACVG,UAAW,KACXK,aAAa,EACbX,iBAAiB,EACjBkB,mBAAmB,IAGvBC,UAAU,WACL,QAAW,CAAC,UAEjBC,MAAO,CACLT,YADK,SACOU,GACLA,IACHC,KAAKZ,QAAU,MAIrBa,QAzBa,WA0BX,IAAQ/B,EAAS8B,KAAKE,OAAOC,MAArBjC,KACR8B,KAAKnB,SAAe,OAAJX,QAAI,IAAJA,GAAAA,EAAMW,SAAWX,EAAKW,SAAW,KACjDmB,KAAKL,SAAe,OAAJzB,QAAI,IAAJA,GAAAA,EAAMyB,SAAWzB,EAAKyB,SAAW,MACjDK,KAAKhB,UAAgB,OAAJd,QAAI,IAAJA,GAAAA,EAAMc,UAAYd,EAAKc,UAAY,SAEtDoB,SAAS,mBACJ,QAAW,CAAC,WAAY,qBADtB,IAEL3B,WAFO,SAEI4B,GAAO,WAChB,GAAkC,IAA9BA,EAAMC,OAAOC,MAAMC,OAAvB,CAIA,IAAMC,EAAUJ,EAAMC,OAAOC,MAAM,GAEnC,GAAIE,EAAQ7B,KAAO,QAIjB,OAHAoB,KAAKU,SAASC,MAAM,iBAEpBX,KAAKY,eAAeZ,KAAKa,MAAMC,aAKjC,IAAMC,EAASC,OAAOC,IAAIC,gBAAgBT,GACpCU,EAAQ,IAAIC,MAClBD,EAAMnD,IAAM+C,EACZI,EAAME,OAAS,WACb,IAAMC,EAAIH,EAAMI,MACVC,EAAIL,EAAMM,OAChB,OAAIH,EAAI,IACN,EAAKZ,SAASC,MAAM,6BAEpB,EAAKC,eAAe,EAAKC,MAAMC,cAG7BU,EAAI,IACN,EAAKd,SAASC,MAAM,6BAEpB,EAAKC,eAAe,EAAKC,MAAMC,eAIjC,EAAK1B,QAAU2B,OACf,EAAK1B,aAAc,KAErB8B,EAAMO,QAAU,WACd,EAAKhB,SAASC,MAAM,mBAEpB,EAAKC,eAAe,EAAKC,MAAMC,gBAGnCxB,kBA7CO,SA6CWqC,GAChB3B,KAAKX,YAAcsC,GAErB5C,eAhDO,WAgDU,WACfiB,KAAKtB,iBAAkB,EACvBkD,YAAW,WACT,EAAKf,MAAMgB,MAAMC,UAChB,MAEChD,KAtDC,WAsDM,sJACP,EAAKD,WACCX,EAAS,EAAKgC,OAAOC,MAArBjC,KACJ,EAAKW,WAAaX,EAAKW,UAA8B,OAAlB,EAAKA,WAC1C,EAAAkD,EAAA,YAAM,CACJC,OAAQ,MACRC,IAAK,YACLvC,KAAM,CACJb,SAAU,EAAKA,UAEjBqD,aAAa,IAEZC,MAAK,SAAAC,GACJ,GAAIA,EAAIC,KAAOrB,OAAOsB,iBAMpB,OALA,EAAK5B,SAAS,CACZnC,KAAM,UACNgE,QAAS,WAGJ,iCAGVJ,MAAK,SAAAC,GACJ,EAAKI,gBAAgBJ,GACrB,EAAKvD,SAAWuD,EAAIvD,aAI5B,EAAKH,iBAAkB,EA5BZ,8CA8BbO,WApFO,WAqFLe,KAAKyC,QAAQC,KAAK,YAEpBxD,SAvFO,WAwFLc,KAAK2C,WACL3B,OAAO4B,SAASC,UAElBjC,eA3FO,SA2FQkC,GACbA,EAAIC,MAAQ,O,WCvKlB,MAAMC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,SAASC,GAAQ,CAAC,YAAY,qBAEzF,S","sources":["webpack://lin-cms-vue/./src/component/layout/user.vue","webpack://lin-cms-vue/./src/component/layout/user.vue?ee1d"],"sourcesContent":["<template>\n  <div class=\"user\">\n    <el-dropdown>\n      <span class=\"el-dropdown-link\">\n        <div class=\"nav-avatar\"><img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" /></div>\n      </span>\n      <template v-slot:dropdown>\n        <el-dropdown-menu class=\"user-box\">\n          <div class=\"user-info\">\n            <div class=\"avatar\" title=\"点击修改头像\">\n              <img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" />\n              <label class=\"mask\">\n                <i class=\"iconfont icon-icon-test\" style=\"font-size: 20px;\"></i>\n                <input ref=\"avatarInput\" type=\"file\" accept=\"image/*\" @change=\"fileChange\" />\n              </label>\n            </div>\n            <div class=\"text\">\n              <div class=\"username\" @click=\"changeNickname\" v-if=\"!nicknameChanged\">{{ nickname }}</div>\n              <el-input\n                placeholder=\"请输入内容\"\n                size=\"small\"\n                v-else\n                v-model=\"nickname\"\n                ref=\"input\"\n                @blur=\"blur\"\n              ></el-input>\n              <div class=\"desc\" v-if=\"!nicknameChanged\">{{ groupName }}</div>\n            </div>\n            <img src=\"../../assets/image/user/corner.png\" class=\"corner\" />\n          </div>\n          <ul class=\"dropdown-box\">\n            <li class=\"password\" @click=\"goToCenter\">\n              <i class=\"iconfont icon-weibaoxitongshangchuanlogo-\"></i> <span>个人中心</span>\n            </li>\n            <li class=\"account\" @click=\"outLogin\"><i class=\"iconfont icon-tuichu\"></i> <span>退出账户</span></li>\n          </ul>\n        </el-dropdown-menu>\n      </template>\n    </el-dropdown>\n    <!-- 修改头像 -->\n    <avatar :originalImage=\"cropImg\" :cropVisible=\"cropVisible\" @switchCropVisible=\"switchCropVisible\"></avatar>\n  </div>\n</template>\n\n<script>\nimport User from 'lin/model/user'\nimport axios from 'lin/plugin/axios'\nimport { mapActions, mapGetters } from 'vuex'\nimport defaultAvatar from '@/assets/image/user/user.png'\nimport Avatar from './avatar.vue'\n\nexport default {\n  name: 'User',\n  components: { Avatar },\n  data() {\n    return {\n      cropImg: '',\n      defaultAvatar,\n      username: null,\n      nickname: null,\n      groupName: null,\n      cropVisible: false,\n      nicknameChanged: false,\n      dialogFormVisible: false,\n    }\n  },\n  computed: {\n    ...mapGetters(['user']),\n  },\n  watch: {\n    cropVisible(val) {\n      if (!val) {\n        this.cropImg = ''\n      }\n    },\n  },\n  created() {\n    const { user } = this.$store.state\n    this.nickname = user?.nickname ? user.nickname : '佚名'\n    this.username = user?.username ? user.username : '未登录'\n    this.groupName = user?.groupName ? user.groupName : '超级管理员'\n  },\n  methods: {\n    ...mapActions(['loginOut', 'setUserAndState']),\n    fileChange(event) {\n      if (event.target.files.length !== 1) {\n        return\n      }\n\n      const imgFile = event.target.files[0]\n      // 验证文件大小是否符合要求, 不大于 5M\n      if (imgFile.size > 1024 * 1024 * 5) {\n        this.$message.error('文件过大超过5M')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n        return\n      }\n\n      // 验证图像是否符合要求\n      const imgSrc = window.URL.createObjectURL(imgFile)\n      const image = new Image()\n      image.src = imgSrc\n      image.onload = () => {\n        const w = image.width\n        const h = image.height\n        if (w < 50) {\n          this.$message.error('图像宽度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        if (h < 50) {\n          this.$message.error('图像高度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        // 验证通过, 打开裁剪框\n        this.cropImg = imgSrc\n        this.cropVisible = true\n      }\n      image.onerror = () => {\n        this.$message.error('获取本地图片出现错误, 请重试')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n      }\n    },\n    switchCropVisible(flag) {\n      this.cropVisible = flag\n    },\n    changeNickname() {\n      this.nicknameChanged = true\n      setTimeout(() => {\n        this.$refs.input.focus()\n      }, 200)\n    },\n    async blur() {\n      if (this.nickname) {\n        const { user } = this.$store.state\n        if (this.nickname !== user.nickname && this.nickname !== '佚名') {\n          axios({\n            method: 'put',\n            url: '/cms/user',\n            data: {\n              nickname: this.nickname,\n            },\n            showBackend: true,\n          })\n            .then(res => {\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.$message({\n                  type: 'success',\n                  message: '更新昵称成功',\n                })\n                // 触发重新获取用户信息\n                return User.getInformation()\n              }\n            })\n            .then(res => {\n              this.setUserAndState(res)\n              this.nickname = res.nickname\n            })\n        }\n      }\n      this.nicknameChanged = false\n    },\n    goToCenter() {\n      this.$router.push('/center')\n    },\n    outLogin() {\n      this.loginOut()\n      window.location.reload()\n    },\n    clearFileInput(ele) {\n      ele.value = ''\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.user {\n  height: 40px;\n\n  .el-dropdown-link {\n    cursor: pointer;\n\n    .nav-avatar {\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      overflow: hidden;\n      margin-right: 10px;\n    }\n  }\n}\n\n.user-box {\n  width: 326px;\n  background-color: none;\n  background: transparent;\n  margin-bottom: 0;\n  padding-bottom: 0;\n  border: none;\n\n  .user-info {\n    background-image: url('../../assets/image/user/user-bg.png');\n    background-size: 100% 100%;\n    transform: translateY(-10px);\n    border-top-left-radius: 4px;\n    border-top-right-radius: 4px;\n    display: flex;\n    flex-direction: row;\n    padding: 35px 20px 25px 30px;\n    z-index: 100;\n    position: relative;\n\n    .corner {\n      position: absolute;\n      right: 18px;\n      top: -9px;\n      width: 27px;\n      height: 10px;\n    }\n\n    .avatar {\n      width: 80px;\n      height: 80px;\n      border-radius: 50%;\n      cursor: pointer;\n      overflow: hidden;\n      position: relative;\n\n      .mask {\n        opacity: 0;\n        transition: all 0.2s;\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        cursor: pointer;\n        color: white;\n\n        input {\n          display: none;\n        }\n      }\n\n      &:hover {\n        .mask {\n          opacity: 1;\n        }\n      }\n    }\n\n    .text {\n      margin-left: 20px;\n      color: #fff;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n\n      .username {\n        margin-bottom: 10px;\n        font-size: 16px;\n        height: 32px;\n        line-height: 32px;\n        cursor: pointer;\n      }\n\n      .desc {\n        font-size: 14px;\n        color: rgba(222, 226, 230, 1);\n      }\n    }\n\n    .info {\n      position: absolute;\n      bottom: 10px;\n      right: 10px;\n      display: flex;\n      color: #fff;\n      font-size: 14px;\n      height: 20px;\n      line-height: 20px;\n\n      .mid {\n        padding: 0 5px;\n      }\n    }\n  }\n\n  .dropdown-box {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-around;\n    padding-left: 35px;\n    height: 122px;\n    color: #596c8e;\n    font-size: 14px;\n    background: white;\n    margin-top: -10px;\n\n    li {\n      cursor: pointer;\n\n      &:nth-child(1) {\n        margin-top: 20px;\n      }\n\n      &:nth-child(2) {\n        margin-bottom: 20px;\n      }\n\n      i {\n        margin-right: 10px;\n      }\n\n      &:hover {\n        color: $theme !important;\n\n        i {\n          color: $theme !important;\n        }\n      }\n    }\n  }\n}\n\n.popper__arrow {\n  display: none !important;\n}\n\n.avatar-croppa-container {\n  display: inline-block;\n  border-color: #3862bc;\n  border-style: dashed;\n  font-size: 0;\n  border-width: 2px;\n}\n</style>\n","import { render } from \"./user.vue?vue&type=template&id=61e20970&scoped=true\"\nimport script from \"./user.vue?vue&type=script&lang=js\"\nexport * from \"./user.vue?vue&type=script&lang=js\"\n\nimport \"./user.vue?vue&type=style&index=0&id=61e20970&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-61e20970\"]])\n\nexport default __exports__"],"names":["class","title","style","src","dropdown","user","avatar","defaultAvatar","alt","ref","type","accept","fileChange","nicknameChanged","placeholder","size","nickname","blur","changeNickname","groupName","goToCenter","outLogin","originalImage","cropImg","cropVisible","switchCropVisible","name","components","Avatar","data","username","dialogFormVisible","computed","watch","val","this","created","$store","state","methods","event","target","files","length","imgFile","$message","error","clearFileInput","$refs","avatarInput","imgSrc","window","URL","createObjectURL","image","Image","onload","w","width","h","height","onerror","flag","setTimeout","input","focus","axios","method","url","showBackend","then","res","code","MAX_SUCCESS_CODE","message","setUserAndState","$router","push","loginOut","location","reload","ele","value","__exports__","render"],"sourceRoot":""}