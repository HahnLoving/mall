{"version":3,"file":"js/2887.eaedcee0.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/lin/model/admin.js","webpack://lin-cms-vue/./src/view/admin/group/use-group.js"],"sourcesContent":["/* eslint-disable class-methods-use-this */\nimport { post, get, put, _delete } from '@/lin/plugin/axios'\n\nexport default class Admin {\n  constructor(uPage = 0, uCount = 10, gPage = 0, gCount = 5) {\n    this.uPage = uPage\n    this.uCount = uCount\n    this.lPage = gPage\n    this.gCount = gCount\n  }\n\n  async increaseUPage() {\n    this.uPage += 1\n  }\n\n  async increaseGPage() {\n    this.lPage += 1\n  }\n\n  async decreaseUPage() {\n    this.uPage -= 1\n    if (this.uPage < 0) {\n      this.uPage = 0\n    }\n  }\n\n  async decreaseGPage() {\n    this.lPage -= 1\n    if (this.lPage < 0) {\n      this.lPage = 0\n    }\n  }\n\n  static getAllPermissions() {\n    return get('cms/admin/permission')\n  }\n\n  static async getAdminUsers({ groupId, count = this.uCount, page = this.uPage }) {\n    let res\n    if (groupId) {\n      res = await get('cms/admin/users', {\n        count,\n        page,\n        group_id: groupId,\n      })\n    } else {\n      res = await get('cms/admin/users', {\n        count,\n        page,\n      })\n    }\n    return res\n  }\n\n  async nextUsersPage() {\n    await this.increaseUPage()\n    return this.getAdminUsers({})\n  }\n\n  async preUsersPage() {\n    await this.decreaseUPage()\n    return this.getAdminUsers({})\n  }\n\n  async getGroupsWithPermissions({ count = this.uCount, page = this.uPage }) {\n    const res = await get('cms/admin/groups', {\n      count,\n      page,\n    })\n    return res\n  }\n\n  async nextGroupsPage() {\n    await this.increaseGPage()\n    return this.getGroupsWithPermissions({})\n  }\n\n  async preGroupsPage() {\n    await this.decreaseGPage()\n    return this.getGroupsWithPermissions({})\n  }\n\n  static async getAllGroups() {\n    const groups = await get('cms/admin/group/all')\n    return groups\n  }\n\n  static async getOneGroup(id) {\n    const group = await get(`cms/admin/group/${id}`)\n    return group\n  }\n\n  // eslint-disable-next-line camelcase\n  static async createOneGroup(name, info, permission_ids) {\n    const res = await post('cms/admin/group', {\n      name,\n      info,\n      permission_ids,\n    })\n    return res\n  }\n\n  static async updateOneGroup(name, info, id) {\n    const res = await put(`cms/admin/group/${id}`, {\n      name,\n      info,\n    })\n    return res\n  }\n\n  static async deleteOneGroup(id) {\n    const res = await _delete(`cms/admin/group/${id}`)\n    return res\n  }\n\n  static async deleteOneUser(id) {\n    const res = await _delete(`cms/admin/user/${id}`)\n    return res\n  }\n\n  // eslint-disable-next-line camelcase\n  static async updateOneUser(email, group_ids, id) {\n    const res = await put(`cms/admin/user/${id}`, {\n      email,\n      group_ids,\n    })\n    return res\n  }\n\n  // eslint-disable-next-line camelcase\n  static async dispatchPermissions(group_id, permission_ids) {\n    const res = await post('cms/admin/permission/dispatch/batch', {\n      group_id,\n      permission_ids,\n    })\n    return res\n  }\n\n  // eslint-disable-next-line camelcase\n  static async changePassword(new_password, confirm_password, id) {\n    const res = await put(`cms/admin/user/${id}/password`, {\n      new_password,\n      confirm_password,\n    })\n    return res\n  }\n\n  // eslint-disable-next-line camelcase\n  static async removePermissions(group_id, permission_ids) {\n    const res = await post('cms/admin/permission/remove', {\n      group_id,\n      permission_ids,\n    })\n    return res\n  }\n}\n","import { ref, onMounted, reactive } from 'vue'\nimport { ElMessageBox, ElMessage } from 'element-plus'\nimport AdminModel from '@/lin/model/admin'\n\nexport const useGroupList = () => {\n  const tableData = ref([]) // 表格数据\n  const loading = ref(false)\n\n  /**\n   * 获取所有分组并传给table渲染\n   */\n  const getAllGroups = async () => {\n    try {\n      loading.value = true\n      tableData.value = await AdminModel.getAllGroups()\n      loading.value = false\n    } catch (e) {\n      loading.value = false\n      console.error(e)\n    }\n  }\n\n  /**\n   * 删除某项数据\n   * @param {object} id 选中的一行数据 ID\n   */\n  const handleDelete = id => {\n    let res = {}\n    ElMessageBox.confirm('此操作将永久删除该分组, 是否继续?', '提示', {\n      confirmButtonText: '确定',\n      cancelButtonText: '取消',\n      type: 'warning',\n    }).then(async () => {\n      try {\n        loading.value = true\n        res = await AdminModel.deleteOneGroup(id)\n      } catch (e) {\n        loading.value = false\n        console.log(e)\n      }\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        await getAllGroups()\n        ElMessage.message({ type: 'success', message: `${res.message}` })\n      } else {\n        loading.value = false\n        ElMessage.message({ type: 'error', message: `${res.message}` })\n      }\n    })\n  }\n\n  onMounted(async () => {\n    await getAllGroups()\n  })\n\n  return {\n    loading,\n    tableData,\n    handleDelete,\n    getAllGroups,\n  }\n}\n\nexport const useEditGroup = (ctx, getAllGroups) => {\n  let cacheGroup = {}\n  const id = ref(0) // 分组id\n  const form = ref(null)\n  const group = reactive({ name: '', info: '' })\n  const dialogFormVisible = ref(false) // 是否弹窗\n  const rules = {\n    // 表单验证规则\n    info: [],\n    name: [{ required: true, message: '请输入分组名称', trigger: 'blur' }],\n  }\n\n  /**\n   * 获取所拥有的权限并渲染  由子组件提供\n   * @param {*} val 选中的某行数据\n   */\n  const handleEdit = row => {\n    id.value = row.id\n    group.name = row.name\n    group.info = row.info\n    cacheGroup = { ...group }\n    dialogFormVisible.value = true\n  }\n\n  /**\n   * 修改分组信息\n   */\n  const confirmEdit = async () => {\n    if (group.name === '') {\n      ElMessage.warning('请将信息填写完整')\n      return\n    }\n    if (cacheGroup.name !== group.name || cacheGroup.info !== group.info) {\n      const res = await AdminModel.updateOneGroup(group.name, group.info, id.value)\n      if (res.code < window.MAX_SUCCESS_CODE) {\n        ElMessage.success(`${res.message}`)\n        getAllGroups()\n      }\n    }\n    dialogFormVisible.value = false\n  }\n\n  const handleClose = done => {\n    done()\n  }\n  const rowDoubleClick = row => {\n    handleEdit(row)\n  }\n  const resetForm = () => {\n    form.value.resetFields()\n  }\n\n  return {\n    id,\n    form,\n    rules,\n    group,\n    resetForm,\n    handleEdit,\n    confirmEdit,\n    handleClose,\n    rowDoubleClick,\n    dialogFormVisible,\n  }\n}\n"],"names":["Admin","uPage","uCount","gPage","gCount","this","lPage","increaseUPage","getAdminUsers","decreaseUPage","count","page","get","res","increaseGPage","getGroupsWithPermissions","decreaseGPage","groupId","group_id","groups","id","group","name","info","permission_ids","post","put","_delete","email","group_ids","new_password","confirm_password","useGroupList","tableData","ref","loading","getAllGroups","value","AdminModel","console","error","handleDelete","ElMessageBox","confirmButtonText","cancelButtonText","type","then","log","code","window","MAX_SUCCESS_CODE","ElMessage","message","onMounted","useEditGroup","ctx","cacheGroup","form","reactive","dialogFormVisible","rules","required","trigger","handleEdit","row","confirmEdit","handleClose","done","rowDoubleClick","resetForm","resetFields"],"sourceRoot":""}