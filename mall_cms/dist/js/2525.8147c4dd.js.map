{"version":3,"file":"js/2525.8147c4dd.js","mappings":"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","sources":["webpack://lin-cms-vue/./src/view/center/center.vue","webpack://lin-cms-vue/./src/view/center/center.vue?962e"],"sourcesContent":["<template>\n  <div class=\"container\">\n    <div class=\"title\">个人中心</div>\n    <div class=\"wrap\">\n      <el-row>\n        <el-col :lg=\"16\" :md=\"20\" :sm=\"24\" :xs=\"24\">\n          <div class=\"user\">\n            <div class=\"title\">用户信息</div>\n            <div class=\"content\">\n              <div class=\"name-wrapper\">\n                <div class=\"label\">昵称</div>\n                <div class=\"name\">\n                  <el-input\n                    placeholder=\"请输入内容\"\n                    size=\"small\"\n                    v-model=\"nickname\"\n                    suffix-icon=\"el-icon-edit\"\n                    ref=\"input\"\n                    @blur=\"blur\"\n                  ></el-input>\n                </div>\n              </div>\n              <div class=\"avatar\" title=\"点击修改头像\">\n                <img :src=\"user.avatar || defaultAvatar\" alt=\"头像\" />\n                <label class=\"mask\">\n                  <i class=\"iconfont icon-icon-test\" style=\"font-size: 20px;\"></i>\n                  <input ref=\"avatarInput\" type=\"file\" accept=\"image/*\" @change=\"fileChange\" />\n                </label>\n              </div>\n            </div>\n          </div>\n          <div class=\"password\">\n            <div class=\"title\">修改密码</div>\n            <el-form\n              ref=\"form\"\n              :model=\"form\"\n              status-icon\n              :rules=\"rules\"\n              @submit.prevent\n              label-width=\"90px\"\n              label-position=\"left\"\n            >\n              <el-form-item label=\"原始密码\" prop=\"old_password\">\n                <el-input type=\"password\" v-model=\"form.old_password\" autocomplete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"新密码\" prop=\"new_password\">\n                <el-input type=\"password\" v-model=\"form.new_password\" autocomplete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item label=\"确认密码\" prop=\"confirm_password\" label-position=\"top\">\n                <el-input type=\"password\" v-model=\"form.confirm_password\" autocomplete=\"off\"></el-input>\n              </el-form-item>\n              <el-form-item>\n                <el-button type=\"primary\" @click=\"submitForm('form')\">保存</el-button>\n                <!-- <el-button @click=\"resetForm('form')\">重置</el-button> -->\n              </el-form-item>\n            </el-form>\n          </div>\n        </el-col>\n      </el-row>\n    </div>\n    <!-- 修改头像 -->\n    <avatar :originalImage=\"cropImg\" :cropVisible=\"cropVisible\" @switchCropVisible=\"switchCropVisible\"></avatar>\n  </div>\n</template>\n\n<script>\nimport { mapActions, mapGetters } from 'vuex'\n\nimport User from '@/lin/model/user'\nimport axios from '@/lin/plugin/axios'\nimport defaultAvatar from '@/assets/image/user/user.png'\nimport Avatar from '../../component/layout/avatar.vue'\n\nexport default {\n  name: 'Center',\n  components: { Avatar },\n  data() {\n    const oldPassword = (rule, value, callback) => {\n      if (!value) {\n        return callback(new Error('原始密码不能为空'))\n      }\n      callback()\n    }\n    const validatePassword = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请输入密码'))\n      } else if (value.length < 6) {\n        callback(new Error('密码长度不能少于6位数'))\n      } else {\n        if (this.form.checkPassword !== '') {\n          this.$refs.form.validateField('confirm_password')\n        }\n        callback()\n      }\n    }\n    const validatePassword2 = (rule, value, callback) => {\n      if (value === '') {\n        callback(new Error('请再次输入密码'))\n      } else if (value !== this.form.new_password) {\n        callback(new Error('两次输入密码不一致!'))\n      } else {\n        callback()\n      }\n    }\n    return {\n      cropImg: '',\n      username: null,\n      nickname: null,\n      defaultAvatar,\n      cropVisible: false,\n      form: {\n        old_password: '',\n        new_password: '',\n        confirm_password: '',\n      },\n      rules: {\n        old_password: [{ validator: oldPassword, trigger: 'blur', required: true }],\n        new_password: [{ validator: validatePassword, trigger: 'blur', required: true }],\n        confirm_password: [{ validator: validatePassword2, trigger: 'blur', required: true }],\n      },\n    }\n  },\n  computed: {\n    ...mapGetters(['user']),\n  },\n  watch: {\n    cropVisible(val) {\n      if (!val) {\n        this.cropImg = ''\n      }\n    },\n  },\n  created() {\n    const { user } = this.$store.state\n    this.nickname = user?.nickname ? user.nickname : '佚名'\n  },\n  methods: {\n    ...mapActions(['loginOut', 'setUserAndState']),\n    switchCropVisible(flag) {\n      this.cropVisible = flag\n    },\n    fileChange(event) {\n      if (event.target.files.length !== 1) {\n        return\n      }\n\n      const imgFile = event.target.files[0]\n      // 验证文件大小是否符合要求, 不大于 5M\n      if (imgFile.size > 1024 * 1024 * 5) {\n        this.$message.error('文件过大超过5M')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n        return\n      }\n\n      // 验证图像是否符合要求\n      const imgSrc = window.URL.createObjectURL(imgFile)\n      const image = new Image()\n      image.src = imgSrc\n      image.onload = () => {\n        const w = image.width\n        const h = image.height\n        if (w < 50) {\n          this.$message.error('图像宽度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        if (h < 50) {\n          this.$message.error('图像高度过小, 请选择大于50px的图像')\n          // 清空输入框\n          this.clearFileInput(this.$refs.avatarInput)\n          return\n        }\n        // 验证通过, 打开裁剪框\n        this.cropImg = imgSrc\n        this.cropVisible = true\n        if (this.$refs.croppa) {\n          this.$refs.croppa.refresh()\n        }\n      }\n      image.onerror = () => {\n        this.$message.error('获取本地图片出现错误, 请重试')\n        // 清空输入框\n        this.clearFileInput(this.$refs.avatarInput)\n      }\n    },\n    async blur() {\n      if (this.nickname) {\n        const { user } = this.$store.state\n        if (this.nickname !== user.nickname && this.nickname !== '佚名') {\n          axios({\n            method: 'put',\n            url: '/cms/user',\n            data: {\n              nickname: this.nickname,\n            },\n            showBackend: true,\n          })\n            .then(res => {\n              if (res.code < window.MAX_SUCCESS_CODE) {\n                this.$message({\n                  type: 'success',\n                  message: '更新昵称成功',\n                })\n                // 触发重新获取用户信息\n                return User.getInformation()\n              }\n            })\n            .then(res => {\n              // eslint-disable-line\n              this.setUserAndState(res)\n              this.nickname = res.nickname\n            })\n        }\n      }\n      this.nicknameChanged = false\n    },\n    submitForm(formName) {\n      if (this.form.old_password === '' && this.form.new_password === '' && this.form.confirm_password === '') {\n        this.dialogFormVisible = false\n        return\n      }\n      if (this.form.old_password === this.form.new_password) {\n        this.$message.error('新密码不能与原始密码一样')\n        return\n      }\n      this.$refs[formName].validate(async valid => {\n        // eslint-disable-line\n        if (valid) {\n          const res = await User.updatePassword(this.form)\n          if (res.code < window.MAX_SUCCESS_CODE) {\n            this.$message.success(`${res.message}`)\n            this.resetForm(formName)\n            this.dialogFormVisible = false\n            setTimeout(() => {\n              this.loginOut()\n              const { origin } = window.location\n              window.location.href = origin\n            }, 1000)\n          }\n        } else {\n          console.log('error submit!!')\n          this.$message.error('请填写正确的信息')\n          return false\n        }\n      })\n    },\n    // 重置表单\n    resetForm(formName) {\n      this.$refs[formName].resetFields()\n    },\n    clearFileInput(ele) {\n      ele.value = ''\n    },\n  },\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.container {\n  .title {\n    height: 59px;\n    line-height: 59px;\n    color: $parent-title-color;\n    font-size: 16px;\n    font-weight: 500;\n    text-indent: 40px;\n    border-bottom: 1px solid #dae1ec;\n  }\n\n  .wrap {\n    padding: 20px;\n    max-width: 800px;\n    .user {\n      padding: 0px 20px 25px 30px;\n      z-index: 100;\n      position: relative;\n      border-bottom: 1px solid #dae1ec;\n      .title {\n        font-weight: bold;\n        font-size: 16px;\n        color: #3a3a3a;\n        text-indent: 0px;\n        border: none;\n      }\n      .content {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        .name-wrapper {\n          display: flex;\n          align-items: center;\n          .label {\n            margin-right: 20px;\n            color: #333;\n            font-weight: bold;\n            font-size: 14px;\n          }\n          .name {\n            font-weight: 500;\n          }\n        }\n        .avatar {\n          width: 80px;\n          height: 80px;\n          border-radius: 50%;\n          cursor: pointer;\n          overflow: hidden;\n          position: relative;\n\n          .mask {\n            opacity: 0;\n            transition: all 0.2s;\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0, 0, 0, 0.3);\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            cursor: pointer;\n            color: white;\n\n            input {\n              display: none;\n            }\n          }\n\n          &:hover {\n            .mask {\n              opacity: 1;\n            }\n          }\n        }\n\n        .text {\n          margin-left: 20px;\n          color: #fff;\n          display: flex;\n          flex-direction: column;\n          justify-content: center;\n\n          .username {\n            margin-bottom: 10px;\n            font-size: 16px;\n            cursor: pointer;\n          }\n\n          .desc {\n            font-size: 14px;\n            color: rgba(222, 226, 230, 1);\n          }\n        }\n\n        .info {\n          position: absolute;\n          bottom: 10px;\n          right: 10px;\n          display: flex;\n          color: #fff;\n          font-size: 14px;\n          height: 20px;\n          line-height: 20px;\n\n          .mid {\n            padding: 0 5px;\n          }\n        }\n      }\n    }\n    .password {\n      padding: 25px 20px 25px 30px;\n      .title {\n        color: #3a3a3a;\n        font-weight: bold;\n        font-size: 16px;\n        text-indent: 0px;\n        margin-bottom: 20px;\n        border: none;\n      }\n    }\n  }\n}\n</style>\n","import { render } from \"./center.vue?vue&type=template&id=2f7ae4be&scoped=true\"\nimport script from \"./center.vue?vue&type=script&lang=js\"\nexport * from \"./center.vue?vue&type=script&lang=js\"\n\nimport \"./center.vue?vue&type=style&index=0&id=2f7ae4be&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/zhahn/Documents/Hahn/自考/mall/mall_cms/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-2f7ae4be\"]])\n\nexport default __exports__"],"names":["class","title","style","lg","md","sm","xs","placeholder","size","nickname","ref","blur","src","user","avatar","defaultAvatar","alt","type","accept","fileChange","model","form","rules","label","prop","old_password","autocomplete","new_password","confirm_password","submitForm","originalImage","cropImg","cropVisible","switchCropVisible","name","components","Avatar","data","oldPassword","rule","value","callback","Error","validatePassword","length","checkPassword","$refs","validateField","validatePassword2","username","validator","trigger","required","computed","watch","val","this","created","$store","state","methods","flag","event","target","files","imgFile","$message","error","clearFileInput","avatarInput","imgSrc","window","URL","createObjectURL","image","Image","onload","w","width","h","height","croppa","refresh","onerror","axios","method","url","showBackend","then","res","code","MAX_SUCCESS_CODE","message","setUserAndState","nicknameChanged","formName","validate","valid","success","resetForm","dialogFormVisible","setTimeout","loginOut","origin","location","href","console","log","resetFields","ele","__exports__","render"],"sourceRoot":""}