(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[5892],{38415:function(t,e,i){"use strict";var n=i(99958),r=i(84488);t.exports=function(t){var e=String(r(this)),i="",a=n(t);if(a<0||a==1/0)throw RangeError("Wrong number of repetitions");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(i+=e);return i}},50863:function(t,e,i){var n=i(84326);t.exports=function(t){if("number"!=typeof t&&"Number"!=n(t))throw TypeError("Incorrect invocation");return+t}},56977:function(t,e,i){"use strict";var n=i(82109),r=i(99958),a=i(50863),o=i(38415),s=i(47293),c=1..toFixed,u=Math.floor,l=function(t,e,i){return 0===e?i:e%2===1?l(t,e-1,i*t):l(t*t,e/2,i)},h=function(t){var e=0,i=t;while(i>=4096)e+=12,i/=4096;while(i>=2)e+=1,i/=2;return e},d=function(t,e,i){var n=-1,r=i;while(++n<6)r+=e*t[n],t[n]=r%1e7,r=u(r/1e7)},f=function(t,e){var i=6,n=0;while(--i>=0)n+=t[i],t[i]=u(n/e),n=n%e*1e7},m=function(t){var e=6,i="";while(--e>=0)if(""!==i||0===e||0!==t[e]){var n=String(t[e]);i=""===i?n:i+o.call("0",7-n.length)+n}return i},p=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!s((function(){c.call({})}));n({target:"Number",proto:!0,forced:p},{toFixed:function(t){var e,i,n,s,c=a(this),u=r(t),p=[0,0,0,0,0,0],g="",w="0";if(u<0||u>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(g="-",c=-c),c>1e-21)if(e=h(c*l(2,69,1))-69,i=e<0?c*l(2,-e,1):c/l(2,e,1),i*=4503599627370496,e=52-e,e>0){d(p,0,i),n=u;while(n>=7)d(p,1e7,0),n-=7;d(p,l(10,n,1),0),n=e-1;while(n>=23)f(p,1<<23),n-=23;f(p,1<<n),d(p,1,1),f(p,2),w=m(p)}else d(p,0,i),d(p,1<<-e,0),w=m(p)+o.call("0",u);return u>0?(s=w.length,w=g+(s<=u?"0."+o.call("0",u-s)+w:w.slice(0,s-u)+"."+w.slice(s-u))):w=g+w,w}})},5892:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return W}});i(69600);var n=i(66252),r=i(56612),a=i(58061),o=function(t){return(0,n.dD)("data-v-640f10f0"),t=t(),(0,n.Cn)(),t},s={class:"upload-imgs-container"},c={key:0},u={class:"info"},l=["onClick"],h={class:"control"},d=["onClick"],f=["onClick"],m=o((function(){return(0,n._)("i",{class:"el-icon-edit"},null,-1)})),p=[m],g={key:2,class:"control-bottom"},w=["onClick"],b=["onClick"],v=["onClick"],y={key:1},x=["onClick","onKeydown"],k=o((function(){return(0,n._)("i",{class:"el-icon-plus",style:{"font-size":"3em"}},null,-1)})),I=["innerHTML"],L=["accept","multiple"];function C(t,e,i,o,m,C){var S=(0,n.up)("el-image"),R=(0,n.Q2)("loading");return(0,n.wy)(((0,n.wg)(),(0,n.iD)("div",s,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(m.itemList,(function(t,e){return(0,n.wg)(),(0,n.iD)("div",{key:t.id},[t.display?((0,n.wg)(),(0,n.iD)("div",c,[(0,n.wy)((0,n._)("div",{class:"thumb-item",style:(0,r.j5)(C.boxStyle)},[(0,n.Wm)(S,{fit:i.fit,ref:C.setImageRef,src:t.display,class:"thumb-item-img",previewSrcList:m.srcList,style:{width:"100%",height:"100%"}},null,8,["fit","src","previewSrcList"]),(0,n._)("div",u,[t.file?((0,n.wg)(),(0,n.iD)("i",{key:0,class:"el-icon-upload wait-upload",onClick:(0,a.iM)((function(e){return C.delItem(t.id)}),["prevent","stop"]),title:"等待上传"},null,8,l)):(0,n.kq)("",!0)]),(0,n._)("div",h,[i.disabled?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("i",{key:0,class:"el-icon-close del",onClick:(0,a.iM)((function(e){return C.delItem(t.id)}),["prevent","stop"]),title:"删除"},null,8,d)),i.disabled?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",{key:1,class:"preview",title:"更换图片",onClick:(0,a.iM)((function(e){return C.handleClick(t.id)}),["prevent","stop"])},p,8,f)),i.sortable||i.preview?((0,n.wg)(),(0,n.iD)("div",g,[i.sortable&&!i.disabled?((0,n.wg)(),(0,n.iD)("i",{key:0,title:"前移",class:(0,r.C_)(["control-bottom-btn el-icon-back",{disabled:0===e}]),onClick:(0,a.iM)((function(e){return C.move(t.id,-1)}),["stop"])},null,10,w)):(0,n.kq)("",!0),i.preview?((0,n.wg)(),(0,n.iD)("i",{key:1,class:"control-bottom-btn el-icon-view",title:"预览",style:{cursor:"pointer"},onClick:(0,a.iM)((function(i){return C.previewImg(t,e)}),["stop"])},null,8,b)):(0,n.kq)("",!0),i.sortable&&!i.disabled?((0,n.wg)(),(0,n.iD)("i",{key:2,title:"后移",class:(0,r.C_)(["control-bottom-btn el-icon-right",{disabled:e===m.itemList.length-1}]),onClick:(0,a.iM)((function(e){return C.move(t.id,1)}),["stop"])},null,10,v)):(0,n.kq)("",!0)])):(0,n.kq)("",!0)])],4),[[R,t.loading]])])):((0,n.wg)(),(0,n.iD)("div",y,[(0,n._)("div",{class:(0,r.C_)(["upload-item",{disabled:i.disabled}]),style:(0,r.j5)(C.boxStyle),onClick:function(e){return C.handleClick(t.id)},onKeydown:function(e){return C.handleKeydown(e,t.id)}},[k,(0,n._)("div",{innerHTML:C.rulesTip.join("<br>"),style:{"margin-top":"1em"}},null,8,I)],46,x)]))])})),128)),(0,n._)("input",{ref:"input",type:"file",accept:i.accept,multiple:i.multiple,onChange:e[0]||(e[0]=function(){return C.handleChange&&C.handleChange.apply(C,arguments)}),class:"upload-imgs__input","aria-labelledby":"Upload images"},null,40,L)],512)),[[R,m.loading]])}var S=i(48534),R=i(89584),A=i(95082),U=(i(35666),i(92222),i(9653),i(56977),i(41539),i(54747),i(78783),i(33948),i(60285),i(41637),i(21249),i(68309),i(34553),i(40561),i(57327),i(12109)),E=i(46692),_=1024,z=1024*_;function F(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i={loading:!1,id:(0,E.createId)(),status:"input",src:"",display:"",imgId:""};return t?t.file&&!t.id?((0,E.isEmptyObj)(e)?i.status="new":("input"!==e.status&&"new"!==e.status||(i.status="new"),"init"!==e.status&&"edit"!==e.status||(i.status="edit")),i.id=e.id||i.id,i.src="",i.imgId="",i.display=t.localSrc||i.display,i=(0,A.Z)((0,A.Z)({},t),i),i):(i.id=t.id||(0,E.createId)(),i.imgId=t.imgId||i.imgId,i.src=t.src||i.src,i.display=t.display||i.display,i.status=t.status||"init",i=(0,A.Z)((0,A.Z)({},t),i),i):i}function Z(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=t;return r+=e&&i?" ".concat(e).concat(n,"~").concat(i).concat(n):e?" ≥ ".concat(e).concat(n):i?" ≤ ".concat(i).concat(n):"无限制",r}var D,H=10,M=[],N={name:"UploadImgs",data:function(){return{srcList:[],itemList:[],imageRefs:[],loading:!1,currentId:"",imageInitialIndex:0}},props:{width:{type:[Number,String],default:160},height:{type:[Number,String],default:160},autoUpload:{type:Boolean,default:!0},value:{type:Array,default:function(){return[]}},accept:{type:String,default:"image/*"},minNum:{type:Number,default:0},maxNum:{type:Number,default:0},sortable:{type:Boolean,default:!1},preview:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},rules:{type:[Object,Function],default:function(){return{maxSize:2}}},disabled:{type:Boolean,default:!1},beforeUpload:{type:Function,default:null},remoteFuc:{type:Function,default:null},fit:{type:String,default:"contain"},animatedCheck:{type:Boolean,default:!1}},computed:{boxStyle:function(){var t=this.width,e=this.height,i=this.disabled,n={};"number"===typeof t?n.width="".concat(t,"px"):"string"===typeof t&&(n.width=t),"number"===typeof e?n.height="".concat(e,"px"):"string"===typeof e&&(n.height=e),n.cursor=i?"not-allowed":"pointer";var r=12,a=8;return"number"===typeof t&&t/a<r&&(r=(t/a).toFixed(2)),n.fontSize="".concat(r,"px"),n.textAlign="center",n.position="relative",n.display="flex",n.alignItems="center",n.justifyContent="center",n.overflow="hidden",n.lineHeight="1.3",n.flexDirection="column",n},min:function(){var t=this.minNum;return t<0?0:parseInt(t,10)},max:function(){var t=this.min,e=this.maxNum;return e<t?t:parseInt(e,10)},isStable:function(){var t=this.min,e=this.max;return 0!==e&&t===e},rulesTip:function(){var t,e=this.rules,i=[];if("function"===typeof e)try{t=e()}catch(n){t={}}else t=e||{};return t.width&&t.height?i.push("宽高 ".concat(t.width,"x").concat(t.height)):t.width?(i.push("宽度 ".concat(t.width)),i.push("".concat(Z("高度",t.minHeight,t.maxHeight)))):t.height?(i.push("高度 ".concat(t.height)),i.push("".concat(Z("宽度",t.minWidth,t.maxWidth)))):(i.push("".concat(Z("宽度",t.minWidth,t.maxWidth))),i.push("".concat(Z("高度",t.minHeight,t.maxHeight)))),t.ratio&&(Array.isArray(t.ratio)?i.push("宽高比 ".concat(t.ratio.join(":"))):i.push("宽高比 ".concat(t.ratio))),(t.minSize||t.maxSize)&&i.push(Z("文件大小",t.minSize,t.maxSize,"Mb")),t.allowAnimated&&t.allowAnimated>0&&(1===t.allowAnimated?i.push("不允许上传动图"):2===t.allowAnimated&&i.push("只允许上传动图")),i}},watch:{value:function(t){this.initItemList(t)}},mounted:function(){this.initItemList(this.value)},methods:{uploadCatch:function(t){var e=this,i={};return t.forEach((function(t,e){i["file_".concat(e)]=t.img.file})),(0,U.post)("cms/file",i).then((function(e){if(!Array.isArray(e)||0===e.length)throw new Error("图像上传失败");var i=e.reduce((function(t,e){return t[e.key]=e,t}),{});t.forEach((function(t,e){var n=i["file_".concat(e)];t.cb(n)}))})).catch((function(i){t.forEach((function(t){t.cb(!1)}));var n="图像上传失败, 请重试";i.message&&(n=i.message),console.error(i),e.$message.error(n)}))},originUpload:function(t,e){var i=this;if(M.push({img:t,cb:e}),M.length===H){var n=(0,R.Z)(M);return M=[],clearTimeout(D),D=null,this.uploadCatch(n)}D&&M.length<H&&clearTimeout(D),D=setTimeout((function(){i.uploadCatch((0,R.Z)(M)),M=[],D=null}),50)},uploadImg:function(t){var e=this;return(0,S.Z)(regeneratorRuntime.mark((function i(){var n,r,a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=function(t,e){t.loading=!1,e&&(t.display=e.url,t.src=e.path,t.imgId=e.id,t.file=null,window.URL.revokeObjectURL(t.display))},"input"!==t.status&&t.file){i.next=3;break}return i.abrupt("return");case 3:if(t.loading=!0,!e.beforeUpload||"function"!==typeof e.beforeUpload){i.next=12;break}if("function"!==typeof e.beforeUpload){i.next=12;break}return i.next=8,new Promise((function(i){var n;try{n=e.beforeUpload(t,(function(t){i(!!t)}))}catch(r){i(!1)}null!=n&&"function"===typeof n.then&&n.then((function(t){i(!!t)})).catch((function(){i(!1)}))}));case 8:if(r=i.sent,r){i.next=12;break}return n(t,!1),i.abrupt("return",!1);case 12:if(!e.remoteFuc||"function"!==typeof e.remoteFuc){i.next=20;break}return i.next=15,new Promise((function(i){var n;try{n=e.remoteFuc(t.file,(function(t){i(t||!1)}))}catch(r){e.$message.error("执行自定义上传出错"),i(!1)}null!=n&&"function"===typeof n.then&&n.then((function(t){i(t||!1)})).catch((function(){i(!1)}))}));case 15:if(a=i.sent,n(t,a),a){i.next=19;break}return i.abrupt("return",!1);case 19:return i.abrupt("return",t);case 20:return i.abrupt("return",new Promise((function(i){e.originUpload(t,(function(e){n(t,e),i(!!e&&t)}))})));case 21:case"end":return i.stop()}}),i)})))()},getValue:function(){var t=this;return(0,S.Z)(regeneratorRuntime.mark((function e(){var i,n,r,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:i=t.itemList,n=t.isStable,r=t.min,a=n?i.length:i.length-1,o=0;case 3:if(!(o<a)){e.next=10;break}if("input"!==i[o].status){e.next=7;break}return t.$message.error("当前存在未选择图片, 请全部选择"),e.abrupt("return",!1);case 7:o+=1,e.next=3;break;case 10:if(!(a<r)){e.next=13;break}return t.$message.error("至少选择".concat(r,"张图片")),e.abrupt("return",!1);case 13:for(s=[],c=0;c<i.length;c+=1)"input"!==i[c].status&&(i[c].file?s.push(t.uploadImg(i[c])):s.push(Promise.resolve(i[c])));return e.next=17,Promise.all(s);case 17:if(u=e.sent,!u.some((function(t){return!t}))){e.next=20;break}return e.abrupt("return",!1);case 20:return l=u.map((function(t){var e={id:"new"===t.status?"":t.id,imgId:t.imgId||null,src:t.src||null,display:t.display,width:t.width||null,height:t.height||null,fileSize:t.size||null,fileName:t.name||null,fileType:t.type||null,isAnimated:t.isAnimated||null};return e})),t.$emit("upload",l),e.abrupt("return",l);case 23:case"end":return e.stop()}}),e)})))()},delItem:function(t){var e=this.itemList,i=this.isStable,n=e.findIndex((function(e){return e.id===t})),r=e[n].display;i?(e[n]=F(),this.itemList=(0,R.Z)(e)):e.splice(n,1),window.URL.revokeObjectURL(r),this.initItemList(this.itemList)},previewImg:function(t,e){var i=this.itemList.filter((function(t){return"input"!==t.status}));this.srcList=i.map((function(t){return t.display})),this.imageRefs[e].showViewer=!0},setImageRef:function(t){t&&this.imageRefs.push(t)},move:function(t,e){var i=this.itemList,n=this.isStable,r=i.findIndex((function(e){return e.id===t}));if(!(r+e<0||r+e>=i.length)&&(n||r+e!==i.length-1||"input"!==i[i.length-1].status)){var a=i[r],o=i[r+e];i[r]=o,i[r+e]=a,this.itemList=(0,R.Z)(i)}},validateImg:function(t){var e=this;return(0,S.Z)(regeneratorRuntime.mark((function i(){var n,r,a;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.rules,"function"===typeof n)try{r=n(t)}catch(o){r={}}else r=n;if(!(r.allowAnimated&&r.allowAnimated>0)){i.next=11;break}if(null!==t.isAnimated){i.next=7;break}e.$message.error('要进行是否动图验证需要配置 "animated-check" 属性为 true'),i.next=11;break;case 7:if(1!==r.allowAnimated||!t.isAnimated){i.next=9;break}throw new Error('"'.concat(t.name,'"为动态图, 不允许上传'));case 9:if(2!==r.allowAnimated||t.isAnimated){i.next=11;break}throw new Error('"'.concat(t.name,'"为静态图, 只允许上传动态图'));case 11:if(!r.width){i.next=16;break}if(t.width===r.width){i.next=14;break}throw new Error('"'.concat(t.name,'"图像宽不符合要求, 需为').concat(r.width));case 14:i.next=20;break;case 16:if(!(r.minWidth&&t.width<r.minWidth)){i.next=18;break}throw new Error('"'.concat(t.name,'"图像宽不符合要求, 至少为').concat(r.minWidth));case 18:if(!(r.maxWidth&&t.width>r.maxWidth)){i.next=20;break}throw new Error('"'.concat(t.name,'"图像宽不符合要求, 至多为').concat(r.maxWidth));case 20:if(!r.height){i.next=25;break}if(t.height===r.height){i.next=23;break}throw new Error('"'.concat(t.name,'"图像高不符合要求, 需为').concat(r.height));case 23:i.next=29;break;case 25:if(!(r.minHeight&&t.height<r.minHeight)){i.next=27;break}throw new Error('"'.concat(t.name,'"图像高不符合要求, 至少为').concat(r.minHeight));case 27:if(!(r.maxHeight&&t.height>r.maxHeight)){i.next=29;break}throw new Error('"'.concat(t.name,'"图像高不符合要求, 至多为').concat(r.maxHeight));case 29:if(!r.ratio){i.next=34;break}if(a=Array.isArray(r.ratio)?r.ratio[0]/r.ratio[1]:r.ratio,a=a.toFixed(2),(t.width/t.height).toFixed(2)===a){i.next=34;break}throw new Error('"'.concat(t.name,'"图像宽高比不符合要求, 需为').concat(a));case 34:if(!(r.minSize&&t.size<r.minSize*z)){i.next=36;break}throw new Error('"'.concat(t.name,'"图像文件大小比不符合要求, 至少为').concat(r.minSize,"Mb"));case 36:if(!(r.maxSize&&t.size>r.maxSize*z)){i.next=38;break}throw new Error('"'.concat(t.name,'"图像文件大小比不符合要求, 至多为').concat(r.maxSize,"Mb"));case 38:return i.abrupt("return",!0);case 39:case"end":return i.stop()}}),i)})))()},handleChange:function(t){var e=this;return(0,S.Z)(regeneratorRuntime.mark((function i(){var n,r,a,o,s,c,u,l,h;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.currentId,r=e.autoUpload,a=t.target.files,a){i.next=4;break}return i.abrupt("return");case 4:for(s=[],c=function(){var t=(0,S.Z)(regeneratorRuntime.mark((function t(i){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getImgInfo(i);case 2:return n=t.sent,s.push(n),t.next=6,e.validateImg(n);case 6:return t.abrupt("return",n);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),u=[],l=0;l<a.length;l+=1)u.push(c(a[l]));return i.prev=8,i.next=11,Promise.all(u);case 11:o=i.sent,e.setImgInfo(n,o),r&&e.itemList.forEach((function(t){e.uploadImg(t)})),i.next=22;break;case 16:for(i.prev=16,i.t0=i["catch"](8),h=0;h<s.length;h+=1)window.URL.revokeObjectURL(s[h].localSrc);s=null,console.error(i.t0),e.$message.error(i.t0.message);case 22:case"end":return i.stop()}}),i,null,[[8,16]])})))()},setImgInfo:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.max,n=this.itemList,r=this.itemList.findIndex((function(e){return e.id===t}));if(window.URL.revokeObjectURL(this.itemList[r].display),this.itemList[r]=F(e[0],this.itemList[r]),e.length>1){var a=e.length;if(this.isStable)for(var o=0,s=1;o<i&&s<a;o+=1)"input"===n[o].status&&(this.itemList[o]=F(e[s]),s+=1);else{var c=i-n.length;i&&a>c&&(a=c),"input"===n[n.length-1].status&&this.itemList.pop();for(var u=1;u<=a;u+=1)this.itemList.push(F(e[u]))}}this.initItemList(this.itemList)},handleKeydown:function(t,e){t.target===t.currentTarget&&(13!==t.keyCode&&32!==t.keyCode||this.handleClick(e))},handleClick:function(t){this.disabled||(this.currentId=t||"",this.$refs.input.value=null,this.$refs.input.click())},initItemList:function(t){var e=this.max,i=this.isStable,n=this.disabled,r=[];if(!t||!Array.isArray(t)||0===t.length){if(i){for(var a=0;a<e;a+=1)r.push(F());return void(this.itemList=r)}return r.push(F()),void(this.itemList=r)}for(var o=0;o<t.length;o+=1)r.push(F(t[o]));(0===e||t.length<e)&&!n&&"input"!==t[t.length-1].status&&r.push(F()),this.itemList=r},getImgInfo:function(t){var e=this;return(0,S.Z)(regeneratorRuntime.mark((function i(){var n,r,a,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e.animatedCheck,r=window.URL.createObjectURL(t),i.next=4,(0,E.getFileType)(t);case 4:if(a=i.sent,o=null,!n){i.next=10;break}return i.next=9,(0,E.checkIsAnimated)({file:t,fileType:a,fileUrl:r});case 9:o=i.sent;case 10:return i.abrupt("return",new Promise((function(e,i){var n=new Image;n.src=r,n.onload=function(){var i={localSrc:r,file:t,width:n.width,height:n.height,name:t.name,size:t.size,type:"unknow"===a?t.type:a,lastModified:t.lastModified,isAnimated:o};e(i),n=null},n.onerror=function(){i(new Error("图像加载失败")),n=null}})));case 11:case"end":return i.stop()}}),i)})))()},clear:function(){this.initItemList([]),this.getValue()},reset:function(){this.initItemList(this.value)}}},j=i(83744);const T=(0,j.Z)(N,[["render",C],["__scopeId","data-v-640f10f0"]]);var W=T}}]);
//# sourceMappingURL=5892.457a4961.js.map