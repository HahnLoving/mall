"use strict";(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[2589,1901],{81901:function(e,t,n){n.r(t);var r=n(48534),u=n(13087),a=n(62833),i=(n(35666),n(12109)),l=function(){function e(){(0,u.Z)(this,e)}return(0,a.Z)(e,null,[{key:"addTheme",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.post)("v1/theme",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addThemeSpu",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.post)("v1/theme/spu",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getTheme",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.get)("v1/theme/".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getList",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.get)("v1/theme/list");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"editTheme",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.put)("v1/theme/".concat(t),n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"deleteTheme",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i._delete)("v1/theme/".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getThemes",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(){var t,n,r,u=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:0,n=u.length>1&&void 0!==u[1]?u[1]:10,e.next=4,(0,i.get)("v1/theme/page",{page:t,count:n});case 4:return r=e.sent,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSpus",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.get)("v1/theme/spus",{id:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getSpuList",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i.get)("v1/theme/spu/list",{id:t});case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"deleteSpu",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,i._delete)("v1/theme/spu/".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}();t["default"]=l},62589:function(e,t,n){n.r(t),n.d(t,{default:function(){return U}});n(68309),n(82526),n(41817);var r=n(66252),u=n(56612),a=n(58061),i=function(e){return(0,r.dD)("data-v-31445a1c"),e=e(),(0,r.Cn)(),e},l={class:"title"},s=i((function(){return(0,r._)("i",{class:"iconfont icon-fanhui"},null,-1)})),o=(0,r.Uk)(" 返回 "),c=[s,o],p={class:"container"},m={class:"wrap"},d=(0,r.Uk)("保 存"),f={key:0,class:"title plus"},g=i((function(){return(0,r._)("span",null,"主题下的SPU",-1)})),h=[g],v={key:1,class:"wrap"},w=["src","alt"],x=(0,r.Uk)("删除"),_={class:"complete"},k={class:"id"},b={class:"name"},S=(0,r.Uk)("添加");function y(e,t,n,i,s,o){var g=(0,r.up)("el-divider"),y=(0,r.up)("sticky-top"),R=(0,r.up)("el-input"),W=(0,r.up)("el-form-item"),C=(0,r.up)("el-option"),V=(0,r.up)("el-select"),D=(0,r.up)("el-switch"),Z=(0,r.up)("upload-imgs"),I=(0,r.up)("el-button"),U=(0,r.up)("el-form"),E=(0,r.up)("el-col"),T=(0,r.up)("el-row"),$=(0,r.up)("el-table-column"),z=(0,r.up)("el-table"),F=(0,r.up)("el-autocomplete"),M=(0,r.Q2)("permission"),L=(0,r.Q2)("loading");return(0,r.wg)(),(0,r.iD)("div",null,[(0,r.Wm)(y,null,{default:(0,r.w5)((function(){return[(0,r._)("div",l,[(0,r._)("span",null,(0,u.zw)(n.isCreate?"创建主题":"更新主题"),1),(0,r._)("span",{class:"back",onClick:t[0]||(t[0]=function(){return o.back&&o.back.apply(o,arguments)})},c),(0,r.Wm)(g)])]})),_:1}),(0,r._)("div",p,[(0,r._)("div",m,[(0,r.Wm)(T,null,{default:(0,r.w5)((function(){return[(0,r.Wm)(E,{lg:16,md:20,sm:24,xs:24},{default:(0,r.w5)((function(){return[(0,r.Wm)(U,{model:s.form,"status-icon":"",ref:"form","label-width":"100px",onSubmit:t[7]||(t[7]=(0,a.iM)((function(){}),["prevent"]))},{default:(0,r.w5)((function(){return[(0,r.Wm)(W,{label:"标题",prop:"title"},{default:(0,r.w5)((function(){return[(0,r.Wm)(R,{size:"medium",modelValue:s.form.title,"onUpdate:modelValue":t[1]||(t[1]=function(e){return s.form.title=e}),placeholder:"请填写标题"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(W,{label:"名称",prop:"title"},{default:(0,r.w5)((function(){return[(0,r.Wm)(R,{size:"medium",modelValue:s.form.name,"onUpdate:modelValue":t[2]||(t[2]=function(e){return s.form.name=e}),placeholder:"请填写名称"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(W,{label:"主题描述",prop:"description"},{default:(0,r.w5)((function(){return[(0,r.Wm)(R,{size:"medium",modelValue:s.form.description,"onUpdate:modelValue":t[3]||(t[3]=function(e){return s.form.description=e}),placeholder:"请填写主题描述"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(W,{label:"模板名",prop:"tpl_name"},{default:(0,r.w5)((function(){return[(0,r.Wm)(V,{modelValue:s.form.tpl_name,"onUpdate:modelValue":t[4]||(t[4]=function(e){return s.form.tpl_name=e}),placeholder:"请选择模板名"},{default:(0,r.w5)((function(){return[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(s.tpl_options,(function(e){return(0,r.wg)(),(0,r.j4)(C,{key:e,label:e,value:e},null,8,["label","value"])})),128))]})),_:1},8,["modelValue"])]})),_:1}),(0,r.Wm)(W,{label:"是否上线"},{default:(0,r.w5)((function(){return[(0,r.Wm)(D,{size:"medium",modelValue:s.onlined,"onUpdate:modelValue":t[5]||(t[5]=function(e){return s.onlined=e}),"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"上线","inactive-text":"下线"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(W,{label:"标题图",prop:"title_img"},{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{rules:s.rules,"max-num":s.maxNum,ref:"uploadImgEle",value:s.initImgData},null,8,["rules","max-num","value"])]})),_:1}),(0,r.Wm)(W,{label:"入口图",prop:"entrance_img"},{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{rules:s.rules,"max-num":s.maxNum,ref:"uploadEntranceEle",value:s.initEntranceData},null,8,["rules","max-num","value"])]})),_:1}),(0,r.Wm)(W,{label:"外部图",prop:"entrance_img"},{default:(0,r.w5)((function(){return[(0,r.Wm)(Z,{rules:s.rules,"max-num":s.maxNum,ref:"uploadInternalEle",value:s.initInternalData},null,8,["rules","max-num","value"])]})),_:1}),(0,r.Wm)(W,{class:"submit"},{default:(0,r.w5)((function(){return[(0,r.wy)((0,r.Wm)(I,{type:"primary",onClick:t[6]||(t[6]=function(e){return o.submitForm("form")})},{default:(0,r.w5)((function(){return[d]})),_:1},512),[[M,{permission:["创建主题","更新主题"],type:"disabled"}]])]})),_:1})]})),_:1},8,["model"])]})),_:1})]})),_:1})]),n.isCreate?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",f,h)),n.isCreate?(0,r.kq)("",!0):((0,r.wg)(),(0,r.iD)("div",v,[(0,r.Wm)(T,null,{default:(0,r.w5)((function(){return[(0,r.wy)((0,r.Wm)(z,{stripe:"",data:s.tableData},{default:(0,r.w5)((function(){return[(0,r.Wm)($,{prop:"id",fixed:"left",label:"id",width:"100"}),(0,r.Wm)($,{prop:"img",label:"主图",width:"200"},{default:(0,r.w5)((function(e){return[(0,r._)("img",{class:"display_img",src:e.row.img,alt:e.row.img},null,8,w)]})),_:1}),(0,r.Wm)($,{prop:"title",label:"标题",width:"150"}),(0,r.Wm)($,{prop:"subtitle",label:"副标题","min-width":"300"}),(0,r.Wm)($,{fixed:"right",width:"150",label:"操作"},{default:(0,r.w5)((function(e){return[(0,r.wy)((0,r.Wm)(I,{onClick:(0,a.iM)((function(t){return o.handleDelete(e.row)}),["prevent"]),type:"danger",size:"mini",plain:""},{default:(0,r.w5)((function(){return[x]})),_:2},1032,["onClick"]),[[M,{permission:["删除主题下的spu"],type:"disabled"}]])]})),_:1})]})),_:1},8,["data"]),[[L,s.loading]]),(0,r._)("div",_,[(0,r.Wm)(F,{onFocus:o.loadSpuSuggestions,"popper-class":"my-autocomplete",class:"inline-input",modelValue:s.spuState,"onUpdate:modelValue":t[8]||(t[8]=function(e){return s.spuState=e}),"fetch-suggestions":o.querySpuSearch,placeholder:"添加SPU",onSelect:o.handleSpuSelect},{default:(0,r.w5)((function(e){var t=e.item;return[(0,r._)("span",k,(0,u.zw)(t.id),1),(0,r._)("span",b,(0,u.zw)(t.title),1)]})),_:1},8,["onFocus","modelValue","fetch-suggestions","onSelect"]),(0,r.wy)((0,r.Wm)(I,{class:"add",onClick:(0,a.iM)(o.addThemeSpu,["prevent"]),type:"primary",plain:"",size:"medium"},{default:(0,r.w5)((function(){return[S]})),_:1},8,["onClick"]),[[M,{permission:["添加主题下的spu"],type:"disabled"}]])])]})),_:1})]))])])}var R=n(95082),W=n(48534),C=(n(57327),n(41539),n(35666),n(81901)),V=n(5892),D={components:{UploadImgs:V["default"]},props:{isCreate:{type:Boolean,default:!1},themeId:{type:String,default:null}},data:function(){return{form:{title:"",name:"",tpl_name:"",description:"",online:1,title_img:null,entrance_img:null,internal_top_img:null},rules:{minWidth:10,minHeight:10,maxSize:5},initImgData:[],initEntranceData:[],initInternalData:[],maxNum:1,tableData:[],loading:!1,spuState:"",spuId:null,spuSuggestions:[],onlined:!0,tpl_options:["type-1","type-2","type-3","type-4"]}},watch:{onlined:function(e){this.form.online=e?1:0}},mounted:function(){var e=this;return(0,W.Z)(regeneratorRuntime.mark((function t(){var n,r,u,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isCreate){t.next=14;break}return t.next=3,C["default"].getTheme(e.themeId);case 3:return n=t.sent,e.form=n,1==e.form.online?e.onlined=!0:e.onlined=!1,r=[{id:n.id,display:n.title_img}],e.initImgData=r,u=[{id:n.id,display:n.entrance_img}],e.initEntranceData=u,a=[{id:n.id,display:n.internal_top_img}],e.initInternalData=a,t.next=14,e.getSpus(n.id);case 14:case"end":return t.stop()}}),t)})))()},methods:{submitForm:function(e){var t=this;return(0,W.Z)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.getValue();case 2:if(e.prev=2,n=(0,R.Z)({},t.form),!t.isCreate){e.next=10;break}return e.next=7,C["default"].addTheme(n);case 7:r=e.sent,e.next=13;break;case 10:return e.next=12,C["default"].editTheme(t.themeId,n);case 12:r=e.sent;case 13:r.code<window.MAX_SUCCESS_CODE&&(t.$message.success("".concat(r.message)),t.$confirm("是否返回上一页","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,W.Z)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.$emit("editClose");case 1:case"end":return e.stop()}}),e)}))))),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](2),console.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[2,16]])})))()},addThemeSpu:function(){var e=this;return(0,W.Z)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n={theme_id:e.form.id,spu_id:e.spuId},t.prev=1,t.next=4,C["default"].addThemeSpu(n);case 4:r=t.sent,r.code<window.MAX_SUCCESS_CODE&&(e.$message.success("".concat(r.message)),e.getSpus(e.form.id),e.spuId=null,e.spuState=""),t.next=11;break;case 8:t.prev=8,t.t0=t["catch"](1),console.error(t.t0);case 11:case"end":return t.stop()}}),t,null,[[1,8]])})))()},getSpus:function(e){var t=this;return(0,W.Z)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,C["default"].getSpus(e);case 2:r=n.sent,t.tableData=r;case 4:case"end":return n.stop()}}),n)})))()},loadSpuSuggestions:function(){var e=this;return(0,W.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.spuSuggestions.length>0)){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,e.isCreate){t.next=8;break}return t.next=6,C["default"].getSpuList(e.form.id);case 6:e.spuSuggestions=t.sent,0===e.spuSuggestions.length&&e.$message.error("未找到SPU，请先添加SPU");case 8:t.next=14;break;case 10:t.prev=10,t.t0=t["catch"](2),e.$message.error("获取SPU信息失败"),console.error(t.t0);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})))()},querySpuSearch:function(e,t){var n=this.spuSuggestions,r=e?n.filter(this.createSpuFilter(e)):n;t(r)},createSpuFilter:function(e){return function(t){return 0===t.title.toLowerCase().indexOf(e.toLowerCase())}},handleSpuSelect:function(e){this.spuState=e.title,this.spuId=e.id},getValue:function(){var e=this;return(0,W.Z)(regeneratorRuntime.mark((function t(){var n,r,u;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.uploadImgEle.getValue();case 2:return n=t.sent,n&&n.length>0&&(e.form.title_img=n[0].display),t.next=6,e.$refs.uploadEntranceEle.getValue();case 6:return r=t.sent,r&&r.length>0&&(e.form.entrance_img=r[0].display),t.next=10,e.$refs.uploadInternalEle.getValue();case 10:u=t.sent,u&&u.length>0&&(e.form.internal_top_img=u[0].display);case 12:case"end":return t.stop()}}),t)})))()},handleDelete:function(e){var t=this;return(0,W.Z)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,C["default"].deleteSpu(e.tid);case 3:if(r=n.sent,!(r.code<window.MAX_SUCCESS_CODE)){n.next=8;break}return t.$message.success("".concat(r.message)),n.next=8,t.getSpus(t.form.id);case 8:n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),console.error(n.t0);case 13:case"end":return n.stop()}}),n,null,[[0,10]])})))()},resetForm:function(e){this.$refs[e].resetFields()},back:function(){this.$emit("editClose")}}},Z=n(83744);const I=(0,Z.Z)(D,[["render",y],["__scopeId","data-v-31445a1c"]]);var U=I}}]);
//# sourceMappingURL=2589.8dac4427.js.map