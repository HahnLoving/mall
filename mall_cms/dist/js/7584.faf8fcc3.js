"use strict";(self["webpackChunklin_cms_vue"]=self["webpackChunklin_cms_vue"]||[]).push([[7584,370,3602,7386],{63602:function(e,t,n){n.r(t);var r=n(48534),a=n(13087),i=n(62833),o=(n(35666),n(12109)),u=function(){function e(){(0,a.Z)(this,e)}return(0,i.Z)(e,null,[{key:"addCategory",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.post)("v1/category",t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCategory",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("v1/category/".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"editCategory",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.put)("v1/category/".concat(t),n);case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"deleteCategory",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o._delete)("v1/category/".concat(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCategories",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(){var t,n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:0,n=i.length>1&&void 0!==i[1]?i[1]:10,r=i.length>2&&void 0!==i[2]?i[2]:1,e.next=5,(0,o.get)("v1/category/page",{page:t,count:n,root:r});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getSubCategories",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(){var t,n,r,a,i=arguments;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:0,n=i.length>1&&void 0!==i[1]?i[1]:10,r=i.length>2&&void 0!==i[2]?i[2]:1,e.next=5,(0,o.get)("v1/category/sub-page",{page:t,count:n,id:r});case 5:return a=e.sent,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getList",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,o.get)("v1/category/list");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()}]),e}();t["default"]=u},42042:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});n(68309),n(82526),n(41817);var r=n(66252),a=n(56612),i=n(58061),o={style:{"margin-top":"-25px"}},u={class:"dialog-title"},l={slot:"footer",class:"dialog-footer",style:{"padding-left":"5px"}},s=(0,r.Uk)("确 定");function c(e,t,n,c,d,m){var p=(0,r.up)("el-input"),g=(0,r.up)("el-form-item"),f=(0,r.up)("el-switch"),h=(0,r.up)("upload-imgs"),v=(0,r.up)("el-form"),w=(0,r.up)("el-button"),y=(0,r.Q2)("permission");return(0,r.wg)(),(0,r.iD)(r.HY,null,[(0,r._)("div",o,[(0,r._)("div",u,[(0,r._)("span",null,(0,a.zw)(n.isCreate?"创建分类":"更新分类"),1)]),(0,r.Wm)(v,{model:d.form,"status-icon":"",ref:"form","label-width":"100px",onSubmit:t[4]||(t[4]=(0,i.iM)((function(){}),["prevent"]))},{default:(0,r.w5)((function(){return[(0,r.Wm)(g,{label:"名称",prop:"name"},{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{size:"medium",modelValue:d.form.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return d.form.name=e}),placeholder:"请填写分类名"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(g,{label:"排序",prop:"index"},{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{size:"medium",modelValue:d.form.index,"onUpdate:modelValue":t[1]||(t[1]=function(e){return d.form.index=e}),placeholder:"请填写分类排序"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(g,{label:"显示上线",prop:"online"},{default:(0,r.w5)((function(){return[(0,r.Wm)(f,{modelValue:d.display,"onUpdate:modelValue":t[2]||(t[2]=function(e){return d.display=e}),"active-color":"#13ce66","inactive-color":"#ff4949","active-text":"上线","inactive-text":"下线"},null,8,["modelValue"])]})),_:1}),(0,r.Wm)(g,{label:"图片",prop:"img"},{default:(0,r.w5)((function(){return[(0,r.Wm)(h,{ref:"uploadEle","max-num":d.maxNum,value:d.initData},null,8,["max-num","value"])]})),_:1}),(0,r.Wm)(g,{label:"描述",prop:"description"},{default:(0,r.w5)((function(){return[(0,r.Wm)(p,{size:"medium",modelValue:d.form.description,"onUpdate:modelValue":t[3]||(t[3]=function(e){return d.form.description=e}),type:"textarea",rows:1,placeholder:"请填写描述"},null,8,["modelValue"])]})),_:1})]})),_:1},8,["model"])]),(0,r._)("div",l,[(0,r.wy)((0,r.Wm)(w,{type:"primary",onClick:m.submitForm},{default:(0,r.w5)((function(){return[s]})),_:1},8,["onClick"]),[[y,{permission:"更新分类",type:"disabled"}]])])],64)}var d=n(95082),m=n(48534),p=(n(35666),n(9653),n(63602)),g=n(5892),f={components:{UploadImgs:g["default"]},props:{dialogFormVisible:{type:Boolean,default:!1},isCreate:{type:Boolean,default:!1},categoryId:{type:Number,default:0},isSub:{type:Boolean,default:!1}},computed:{visible:{get:function(){return this.dialogFormVisible},set:function(){}}},data:function(){return{display:!0,initData:[],maxNum:1,form:{name:"",is_root:0,parent_id:null,description:"",online:1,index:null}}},watch:{display:function(e){this.form.online=e?1:0}},mounted:function(){var e=this;return(0,m.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isCreate){t.next=7;break}return t.next=3,p["default"].getCategory(e.categoryId);case 3:n=t.sent,e.form=n,e.display=1===n.online,e.initData=[{display:n.img}];case 7:e.isSub?(e.form.parent_id=e.$route.params.id,e.form.is_root=0):(e.form.parent_id=null,e.form.is_root=1);case 8:case"end":return t.stop()}}),t)})))()},methods:{submitForm:function(){var e=this;return(0,m.Z)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getValue();case 2:if(n=(0,d.Z)({},e.form),!e.isCreate){t.next=9;break}return t.next=6,p["default"].addCategory(n);case 6:r=t.sent,t.next=12;break;case 9:return t.next=11,p["default"].editCategory(e.categoryId,n);case 11:r=t.sent;case 12:r.code<window.MAX_SUCCESS_CODE&&(e.$message.success("".concat(r.message)),e.$emit("dialogClose"));case 13:case"end":return t.stop()}}),t)})))()},getValue:function(){var e=this;return(0,m.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.uploadEle.getValue();case 2:n=t.sent,n&&n.length>0&&(e.form.img=n[0].display);case 4:case"end":return t.stop()}}),t)})))()},resetForm:function(e){this.$refs[e].resetFields()},handleClose:function(e){e(),this.$emit("dialogClose")}}},h=n(83744);const v=(0,h.Z)(f,[["render",c],["__scopeId","data-v-eada8af0"]]);var w=v},15342:function(e,t,n){n.r(t),n.d(t,{default:function(){return k}});var r=n(66252),a=n(58061),i=n(56612),o=function(e){return(0,r.dD)("data-v-61629204"),e=e(),(0,r.Cn)(),e},u={class:"container"},l={class:"header"},s=o((function(){return(0,r._)("div",{class:"title"},"分类列表",-1)})),c=(0,r.Uk)("创建分类"),d=(0,r.Uk)("子分类"),m=(0,r.Uk)("编辑"),p=(0,r.Uk)("删除"),g={class:"pagination"},f={key:0};function h(e,t,n,o,h,v){var w=(0,r.up)("el-button"),y=(0,r.up)("el-table-column"),b=(0,r.up)("el-image"),C=(0,r.up)("el-table"),x=(0,r.up)("el-pagination"),k=(0,r.up)("category-edit"),_=(0,r.up)("el-dialog"),V=(0,r.Q2)("permission"),R=(0,r.Q2)("loading");return(0,r.wg)(),(0,r.iD)("div",u,[(0,r._)("div",l,[s,(0,r.wy)((0,r.Wm)(w,{style:{"margin-left":"30px"},onClick:(0,a.iM)(v.handleAdd,["prevent"]),type:"primary",plain:"",size:"medium"},{default:(0,r.w5)((function(){return[c]})),_:1},8,["onClick"]),[[V,{permission:"创建分类",type:"disabled"}]])]),(0,r.wy)((0,r.Wm)(C,{stripe:"",data:h.tableData},{default:(0,r.w5)((function(){return[(0,r.Wm)(y,{prop:"id",label:"id",width:"100"}),(0,r.Wm)(y,{prop:"img",label:"图片",width:"200"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(b,{src:e.row.img,"preview-src-list":h.imgSrcList,style:{"max-height":"50px","max-width":"100px"}},null,8,["src","preview-src-list"])]})),_:1}),(0,r.Wm)(y,{prop:"name",label:"名称",width:"150"}),(0,r.Wm)(y,{prop:"index",label:"排序",width:"150"}),(0,r.Wm)(y,{prop:"online",label:"状态",width:"100"},{default:(0,r.w5)((function(t){return[(0,r.Uk)((0,i.zw)(t.row.online|e.onlineFormat),1)]})),_:1}),(0,r.Wm)(y,{prop:"description",label:"描述","min-width":"200","show-overflow-tooltip":!0}),(0,r.Wm)(y,{fixed:"right",width:"220",label:"操作"},{default:(0,r.w5)((function(e){return[(0,r.Wm)(w,{onClick:(0,a.iM)((function(t){return v.handleSubList(e.row)}),["prevent"]),type:"primary",plain:"",size:"mini"},{default:(0,r.w5)((function(){return[d]})),_:2},1032,["onClick"]),(0,r.Wm)(w,{onClick:(0,a.iM)((function(t){return v.handleEdit(e.row)}),["prevent"]),type:"primary",plain:"",size:"mini"},{default:(0,r.w5)((function(){return[m]})),_:2},1032,["onClick"]),(0,r.wy)((0,r.Wm)(w,{onClick:(0,a.iM)((function(t){return v.handleDelete(e.row)}),["prevent"]),type:"danger",plain:"",size:"mini"},{default:(0,r.w5)((function(){return[p]})),_:2},1032,["onClick"]),[[V,{permission:"删除分类",type:"disabled"}]])]})),_:1})]})),_:1},8,["data"]),[[R,e.loading]]),(0,r._)("div",g,[h.refreshPagination?((0,r.wg)(),(0,r.j4)(x,{key:0,onCurrentChange:v.handleCurrentChange,background:!0,"page-size":h.pageCount,"current-page":h.currentPage,layout:"prev, pager, next, jumper",total:h.totalNums},null,8,["onCurrentChange","page-size","current-page","total"])):(0,r.kq)("",!0)]),h.dialogFormVisible?((0,r.wg)(),(0,r.iD)("div",f,[(0,r.Wm)(_,{"append-to-body":!0,"before-close":e.handleClose,visible:e.visible,modelValue:h.dialogFormVisible,"onUpdate:modelValue":t[0]||(t[0]=function(e){return h.dialogFormVisible=e})},{default:(0,r.w5)((function(){return[h.dialogFormVisible?((0,r.wg)(),(0,r.j4)(k,{key:0,isCreate:h.isCreate,dialogFormVisible:h.dialogFormVisible,categoryId:h.categoryId,onDialogClose:v.dialogClose},null,8,["isCreate","dialogFormVisible","categoryId","onDialogClose"])):(0,r.kq)("",!0)]})),_:1},8,["before-close","visible","modelValue"])])):(0,r.kq)("",!0)])}var v=n(48534),w=(n(41539),n(54747),n(68309),n(35666),n(63602)),y=n(42042),b={components:{CategoryEdit:y["default"]},data:function(){return{display:!0,tableData:[],categoryId:0,imgSrcList:[],totalNums:0,currentPage:1,pageCount:10,refreshPagination:!0,dialogFormVisible:!1,isCreate:!1,root:1,form:{name:"",is_root:0,parent_id:null,description:"",online:1,index:null}}},created:function(){var e=this;return(0,v.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!0,e.getCategories(),e.loading=!1;case 3:case"end":return t.stop()}}),t)})))()},filters:{onlineFormat:function(e){return 1===e?"显示":"不显示"}},watch:{display:function(e){this.form.online=e?1:0}},methods:{getCategories:function(){var e=this;return(0,v.Z)(regeneratorRuntime.mark((function t(){var n,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.currentPage-1,r=e.pageCount,t.next=4,w["default"].getCategories(n,r,e.root);case 4:a=t.sent,e.tableData=a.items,e.totalNums=a.total,e.initImgSrcList();case 8:case"end":return t.stop()}}),t)})))()},handleCurrentChange:function(e){var t=this;return(0,v.Z)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.imgSrcList=[],t.currentPage=e,t.loading=!0,t.getCategories(),t.loading=!1;case 5:case"end":return n.stop()}}),n)})))()},initImgSrcList:function(){var e=this;this.tableData.forEach((function(t){t.img&&e.imgSrcList.push(t.img)}))},handleAdd:function(){this.dialogFormVisible=!0,this.isCreate=!0},handleEdit:function(e){this.categoryId=e.id,this.isCreate=!1,this.dialogFormVisible=!0},handleDelete:function(e){var t,n=this;this.$confirm("此操作将永久删除该分类，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((0,v.Z)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.prev=0,n.loading=!0,r.next=4,w["default"].deleteCategory(e.id);case 4:t=r.sent,r.next=11;break;case 7:r.prev=7,r.t0=r["catch"](0),n.loading=!1,console.error(r.t0);case 11:t.code<window.MAX_SUCCESS_CODE?(n.loading=!1,n.totalNums%n.pageCount===1&&1!==n.currentPage&&n.currentPage--,n.getCategories(),n.$message({type:"success",message:"".concat(t.message)})):(n.loading=!1,n.$message.error("".concat(t.message)));case 12:case"end":return r.stop()}}),r,null,[[0,7]])}))))},handleSubList:function(e){this.$router.push({path:"/sub-category/".concat(e.id,"/list"),query:{categoryName:e.name}})},dialogClose:function(){this.dialogFormVisible=!1,this.loading=!0,this.getCategories(),this.loading=!1}}},C=n(83744);const x=(0,C.Z)(b,[["render",h],["__scopeId","data-v-61629204"]]);var k=x}}]);
//# sourceMappingURL=7584.faf8fcc3.js.map